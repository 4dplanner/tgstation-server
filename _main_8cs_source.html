<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>tgstation-server: TGS.Installer.UI/Main.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="tgs.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tgstation-server
   </div>
   <div id="projectbrief">The /tg/station 13 server suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_8553559476c620dfe64ac0bcf2b909e0.html">TGS.Installer.UI</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Main.cs</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_main_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">using</span> Microsoft.Deployment.WindowsInstaller;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> <a class="code" href="_t_g_s_8_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a>;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Collections.Generic;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Diagnostics;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.IO;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Threading;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Threading.Tasks;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Windows.Forms;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_s.html">TGS</a>.<a class="code" href="namespace_t_g_s_1_1_interface.html">Interface</a>;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_s.html">TGS</a>.<a class="code" href="namespace_t_g_s_1_1_interface.html">Interface</a>.<a class="code" href="namespace_t_g_s_1_1_interface_1_1_components.html">Components</a>;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_s.html">TGS</a>.<a class="code" href="namespace_t_g_s_1_1_server.html">Server</a>;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno"><a class="line" href="namespace_t_g_s_1_1_installer_1_1_u_i.html">   13</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_t_g_s.html">TGS</a>.<a class="code" href="class_installer.html">Installer</a>.UI</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;{</div><div class="line"><a name="l00015"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html">   15</a></span>&#160;    <span class="keyword">partial class </span><a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html">Main</a> : <a class="code" href="class_form.html">Form</a></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    {</div><div class="line"><a name="l00017"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a296d0585b5cdf852482be0e46682f709">   17</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> DefaultInstallDir = <span class="stringliteral">&quot;TG Station Server&quot;</span>;  <span class="comment">//keep this in sync with the msi installer</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#ab6b87ba8fae7b84bc33ded501c96cd72">   19</a></span>&#160;        <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#ab6b87ba8fae7b84bc33ded501c96cd72">tempDir</a>;</div><div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a0420f3fc6ff49506491a7b452a7ae420">   20</a></span>&#160;        <span class="keywordtype">bool</span> installing = <span class="keyword">false</span>;</div><div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a796bd6a67d3ca600cfaa5768002244e6">   21</a></span>&#160;        <span class="keywordtype">bool</span> cancelled = <span class="keyword">false</span>;</div><div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a794d0c468dac1662fe2a22015be2b6c2">   22</a></span>&#160;        <span class="keywordtype">bool</span> pathIsDefault = <span class="keyword">true</span>;</div><div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#abd421bac43bd0ebb5ad56096754cc1ff">   26</a></span>&#160;        <span class="keywordtype">bool</span> attemptNetSettingsMigration = <span class="keyword">false</span>;</div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#ab83d845d07bcbe3fa28c9f478e5dabbd">   30</a></span>&#160;        <span class="keywordtype">bool</span> isUnderV2 = <span class="keyword">false</span>;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a26d94ac37e48303729806419d96c6e98">   33</a></span>&#160;        <a class="code" href="interface_t_g_s_1_1_interface_1_1_i_server_interface.html">IServerInterface</a> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a26d94ac37e48303729806419d96c6e98">Interface</a>;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a284feb2bd1d111844cab7b9177a64fcc">   38</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a284feb2bd1d111844cab7b9177a64fcc">Main</a>()</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        {</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            InitializeComponent();</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;            SetupTempDir();</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            CheckForExistingVersion();</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;            PathTextBox.Text = Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.ProgramFilesX86), DefaultInstallDir);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        }</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a955862c9b625d07a812fc77fda419aed">   46</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a955862c9b625d07a812fc77fda419aed">SetupTempDir</a>()</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            tempDir = Path.Combine(Path.GetTempPath(), <span class="stringliteral">&quot;TGS3InstallerTempDir&quot;</span>);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                <span class="keywordflow">if</span> (File.Exists(tempDir))</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                    File.Delete(tempDir);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Directory.Exists(tempDir))</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                    Directory.Delete(tempDir, <span class="keyword">true</span>);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            }</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            <span class="keywordflow">catch</span> { }</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;            <span class="keywordflow">if</span> (File.Exists(tempDir) || Directory.Exists(tempDir))</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            {</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                tempDir = Path.GetTempFileName();</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                File.Delete(tempDir);  <span class="comment">//we want a dir not a file</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            }</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                Directory.CreateDirectory(tempDir);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            }</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <span class="keywordflow">catch</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                tempDir = null;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        }</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a4f1c68505e66e595f9101800b7f73afa">   72</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a4f1c68505e66e595f9101800b7f73afa">CleanTempDir</a>() {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            <span class="keywordflow">if</span>(tempDir != null)</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                    Directory.Delete(tempDir, <span class="keyword">true</span>);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                }</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                <span class="keywordflow">catch</span> { }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#ab6781b4ecdab49b32c2733186498d2fc">   81</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#ab6781b4ecdab49b32c2733186498d2fc">CheckForExistingVersion</a>() {</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            Interface = <span class="keyword">new</span> <a class="code" href="class_t_g_s_1_1_interface_1_1_server_interface.html">ServerInterface</a>();</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            var verifiedConnection = Interface.<a class="code" href="interface_t_g_s_1_1_interface_1_1_i_server_interface.html#af1dc3f018b2c8a794059eed8a905566b">ConnectionStatus</a>().HasFlag(<a class="code" href="namespace_t_g_s_1_1_interface.html#a6aba89d82a2fad3044034cdca1060c4f">ConnectivityLevel</a>.Administrator);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            {</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                VersionLabel.Text = Interface.GetServiceComponent&lt;<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_s_service.html">ITGSService</a>&gt;().Version();</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                var splits = VersionLabel.Text.Split(<span class="charliteral">&#39; &#39;</span>);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                var realVersion = <span class="keyword">new</span> Version(splits[splits.Length - 1].Substring(1));</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                var isV0 = realVersion &lt; <span class="keyword">new</span> Version(3, 1, 0, 0);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                <span class="keywordflow">if</span> (isV0) <span class="comment">//OH GOD!!!!</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                    MessageBox.Show(<span class="stringliteral">&quot;Upgrading from version 3.0 may trigger a bug that can delete /config and /data. IT IS STRONGLY RECCOMMENDED THAT YOU BACKUP THESE FOLDERS BEFORE UPDATING!&quot;</span>, <span class="stringliteral">&quot;Warning&quot;</span>);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                isUnderV2 = isV0 || realVersion &lt; <span class="keyword">new</span> Version(3, 2, 0, 0);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <span class="keywordflow">if</span> (isUnderV2)</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                    <span class="comment">//Friendly reminger</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    MessageBox.Show(<span class="stringliteral">&quot;Upgrading to service version 3.2 will break the 3.1 DMAPI. It is recommended you update your game to the 3.2 API before updating the servive to avoid having to trigger hard restarts.&quot;</span>, <span class="stringliteral">&quot;Note&quot;</span>);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                attemptNetSettingsMigration = realVersion &lt; <span class="keyword">new</span> Version(3, 2, 1, 0);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keywordflow">catch</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                <span class="keywordflow">if</span> (verifiedConnection)</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                    VersionLabel.Text = <span class="stringliteral">&quot;&lt; v3.0.85.0 (Missing ITGService.Version())&quot;</span>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#ab9c5c4424df241c854d7f7b712dbf74e">  105</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#ab9c5c4424df241c854d7f7b712dbf74e">ConfirmDangerousUpgrade</a>()</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <span class="keywordflow">return</span> MessageBox.Show(<span class="stringliteral">&quot;Unable connect to service! Existing DreamDaemon instances will be terminated. Continue?&quot;</span>, <span class="stringliteral">&quot;Warning&quot;</span>, MessageBoxButtons.YesNo) == DialogResult.Yes;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a9323f3432004b2da5f7370b642f86128">  110</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a9323f3432004b2da5f7370b642f86128">TellServiceWereComingForThem</a>()</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            var connectionVerified = Interface.<a class="code" href="interface_t_g_s_1_1_interface_1_1_i_server_interface.html#af1dc3f018b2c8a794059eed8a905566b">ConnectionStatus</a>().HasFlag(<a class="code" href="namespace_t_g_s_1_1_interface.html#a6aba89d82a2fad3044034cdca1060c4f">ConnectivityLevel</a>.Administrator);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                Interface.GetServiceComponent&lt;<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_s_service.html">ITGSService</a>&gt;().PrepareForUpdate();</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                Thread.Sleep(3000); <span class="comment">//chat messages</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <span class="keywordflow">catch</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                <span class="keywordflow">return</span> ConfirmDangerousUpgrade();</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a83a6ceb6ba724fc9b7254a532ed9994f">  125</a></span>&#160;        <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a83a6ceb6ba724fc9b7254a532ed9994f">Main_FormClosing</a>(<span class="keywordtype">object</span> sender, FormClosingEventArgs e)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            e.Cancel = installing;  <span class="comment">//not allowed, nununu</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        }</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a5ff9f14c4e0132d0a29c4cb95aad370a">  130</a></span>&#160;        <span class="keyword">enum</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a5ff9f14c4e0132d0a29c4cb95aad370a">PKillType</a></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            Killed,</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            Aborted,</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            NoneFound,</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#aa29103ac58d82699a4ff461fd5224c36">  137</a></span>&#160;        <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a5ff9f14c4e0132d0a29c4cb95aad370a">PKillType</a> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#aa29103ac58d82699a4ff461fd5224c36">PromptKillProcesses</a>(<span class="keywordtype">string</span> name)</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            var processes = <span class="keyword">new</span> List&lt;Process&gt;(Process.GetProcessesByName(name));</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            processes.RemoveAll(x =&gt; x.HasExited);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="keywordflow">if</span>(processes.Count &gt; 0)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            {</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                <span class="keywordflow">if</span> (MessageBox.Show(String.Format(<span class="stringliteral">&quot;Found {1} running instance{2} of {0}.exe! Shall I terminate {3}?&quot;</span>, name, processes.Count, processes.Count &gt; 1 ? <span class="stringliteral">&quot;s&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, processes.Count &gt; 1 ? <span class="stringliteral">&quot;them&quot;</span> : <span class="stringliteral">&quot;it&quot;</span>), <span class="stringliteral">&quot;Warning&quot;</span>, MessageBoxButtons.YesNo) != DialogResult.Yes)</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a5ff9f14c4e0132d0a29c4cb95aad370a">PKillType</a>.Aborted;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                <span class="keywordflow">foreach</span> (var P <span class="keywordflow">in</span> processes)</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                    <span class="keywordflow">if</span> (!P.HasExited)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                    {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                        P.Kill();</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                        P.WaitForExit();</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                    }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                    P.Dispose();</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a5ff9f14c4e0132d0a29c4cb95aad370a">PKillType</a>.Killed;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            }</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a5ff9f14c4e0132d0a29c4cb95aad370a">PKillType</a>.NoneFound;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a6c6d2146d7237bf09aebadb8eebb0a9d">  162</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a6c6d2146d7237bf09aebadb8eebb0a9d">AttemptMigrationOfNetSettings</a>()</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <span class="keywordflow">if</span> (!attemptNetSettingsMigration)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            var sc = <span class="keyword">new</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server_config.html">ServerConfig</a>();</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                sc.PythonPath = Interface.GetServiceComponent&lt;<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_s_service.html">ITGSService</a>&gt;().PythonPath();</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            }</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="keywordflow">catch</span> { }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                sc.RemoteAccessPort = Interface.GetServiceComponent&lt;<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_s_service.html">ITGSService</a>&gt;().RemoteAccessPort();</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="keywordflow">catch</span> { }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> Interface.GetServiceComponent&lt;<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_landing.html">ITGLanding</a>&gt;().<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_landing.html#a680f28d669b71238d4c98f1494144d36">ListInstances</a>())</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                    sc.InstancePaths.Add(I.Path);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            <span class="keywordflow">catch</span> { }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <span class="keywordflow">if</span> (sc.InstancePaths.Count == 0 &amp;&amp; isUnderV2)</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                <span class="comment">//add the default ip as a last resort</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                sc.InstancePaths.Add(<span class="stringliteral">&quot;C:\\TGSTATION-SERVER-3&quot;</span>); <span class="comment">//normalized</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            sc.Save(<a class="code" href="class_t_g_s_1_1_server_1_1_server.html">Server</a>.<a class="code" href="class_t_g_s_1_1_server_1_1_server.html#ac4176ac33c52820ff6179dba92f1b092">Server</a>.MigrationConfigDirectory);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        }</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#aa4b9c0e14a5bb5b8aaf7d22d45cc1a20">  192</a></span>&#160;        async <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#aa4b9c0e14a5bb5b8aaf7d22d45cc1a20">DoInstall</a>()</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="keywordtype">string</span> logfile = null;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                    var res = PromptKillProcesses(<span class="stringliteral">&quot;TGS.CommandLine&quot;</span>);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                    <span class="keywordflow">if</span> (res == <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a5ff9f14c4e0132d0a29c4cb95aad370a">PKillType</a>.Aborted)</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a5ff9f14c4e0132d0a29c4cb95aad370a">PKillType</a>.Killed)</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                    res = PromptKillProcesses(<span class="stringliteral">&quot;TGS.ControlPanel&quot;</span>);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                    <span class="keywordflow">if</span> (res == <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a5ff9f14c4e0132d0a29c4cb95aad370a">PKillType</a>.Aborted)</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a5ff9f14c4e0132d0a29c4cb95aad370a">PKillType</a>.Killed)</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                </div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                <span class="keywordflow">if</span> (!TellServiceWereComingForThem())</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                var args = <span class="keyword">new</span> List&lt;string&gt;();</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                <span class="keywordflow">if</span> (!pathIsDefault)</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                    args.Add(String.Format(<span class="stringliteral">&quot;INSTALLFOLDER=\&quot;{0}\&quot;&quot;</span>, PathTextBox.Text));</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                <span class="keywordflow">if</span> (StartShortcutsCheckbox.Checked)</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                    args.Add(<span class="stringliteral">&quot;INSTALLSHORTCUTSTART=1&quot;</span>);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                <span class="keywordflow">if</span> (DeskShortcutsCheckbox.Checked)</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                    args.Add(<span class="stringliteral">&quot;INSTALLSHORTCUTDESK=1&quot;</span>);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                args.Add(<span class="stringliteral">&quot;REBOOT=R&quot;</span>);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                SelectPathButton.Enabled = <span class="keyword">false</span>;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                PathTextBox.Enabled = <span class="keyword">false</span>;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                DeskShortcutsCheckbox.Enabled = <span class="keyword">false</span>;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                StartShortcutsCheckbox.Enabled = <span class="keyword">false</span>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                InstallButton.Enabled = <span class="keyword">false</span>;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                ShowLogCheckbox.Enabled = <span class="keyword">false</span>;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                InstallButton.Text = <span class="stringliteral">&quot;Installing...&quot;</span>;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                AttemptMigrationOfNetSettings();</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                var msipath = Path.Combine(tempDir, <span class="stringliteral">&quot;TGS.Installer.msi&quot;</span>);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                File.WriteAllBytes(msipath, Properties.Resources.TGSInstaller);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                File.WriteAllBytes(Path.Combine(tempDir, <span class="stringliteral">&quot;cab1.cab&quot;</span>), Properties.Resources.cab1);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                ProgressBar.Style = ProgressBarStyle.Marquee;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                InstallCancelButton.Enabled = <span class="keyword">true</span>;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                <span class="keywordflow">if</span> (ShowLogCheckbox.Checked)</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                    logfile = Path.Combine(tempDir, <span class="stringliteral">&quot;tgsinstall.log&quot;</span>);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                    Microsoft.Deployment.WindowsInstaller.Installer.EnableLog(InstallLogModes.Verbose | InstallLogModes.PropertyDump, logfile);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                var cl = String.Join(<span class="stringliteral">&quot; &quot;</span>, args);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                Microsoft.Deployment.WindowsInstaller.Installer.SetInternalUI(InstallUIOptions.Silent);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                Microsoft.Deployment.WindowsInstaller.Installer.SetExternalUI(OnUIUpdate, InstallLogModes.Progress);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                await Task.Factory.StartNew(() =&gt; Microsoft.Deployment.WindowsInstaller.Installer.InstallProduct(msipath, cl));</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                <span class="keywordflow">if</span> (cancelled)</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                    MessageBox.Show(<span class="stringliteral">&quot;Operation cancelled!&quot;</span>);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <span class="keywordflow">catch</span> (Exception ex)</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                MessageBox.Show(<span class="stringliteral">&quot;Error: &quot;</span> + ex.ToString());</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            <span class="keywordflow">finally</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                InstallCancelButton.Enabled = <span class="keyword">false</span>;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                ShowLogCheckbox.Enabled = <span class="keyword">true</span>;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                SelectPathButton.Enabled = <span class="keyword">true</span>;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                PathTextBox.Enabled = <span class="keyword">true</span>;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                DeskShortcutsCheckbox.Enabled = <span class="keyword">true</span>;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                StartShortcutsCheckbox.Enabled = <span class="keyword">true</span>;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                ProgressBar.Style = ProgressBarStyle.Blocks;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                InstallButton.Enabled = <span class="keyword">true</span>;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                InstallButton.Text = <span class="stringliteral">&quot;Install&quot;</span>;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                installing = <span class="keyword">false</span>;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                cancelled = <span class="keyword">false</span>;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                <span class="keywordflow">if</span> (ShowLogCheckbox.Checked &amp;&amp; logfile != null)</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                    {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                        Process.Start(logfile).WaitForInputIdle();</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                    }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                    <span class="keywordflow">catch</span> { }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            }</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            MessageBox.Show(<span class="stringliteral">&quot;Success!&quot;</span>);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            Application.Exit();</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        }</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a0f9dc5f7ce940e62a1e5b0247758a6b3">  288</a></span>&#160;        MessageResult <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a0f9dc5f7ce940e62a1e5b0247758a6b3">OnUIUpdate</a>(InstallMessage messageType, <span class="keywordtype">string</span> message, MessageButtons buttons, MessageIcon icon, MessageDefaultButton defaultButton)</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            <span class="keywordflow">if</span> (cancelled &amp;&amp; installing)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                installing = <span class="keyword">false</span>;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                <span class="keywordflow">return</span> MessageResult.Cancel;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            }</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="keywordflow">return</span> MessageResult.OK;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a0b28294a88847f6a9d50605cdfc17904">  298</a></span>&#160;        <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a0b28294a88847f6a9d50605cdfc17904">InstallButton_Click</a>(<span class="keywordtype">object</span> sender, EventArgs e)</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            DoInstall();</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#aaaa1150baa8df38e62e9f4ac1eb46cf2">  303</a></span>&#160;        <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#aaaa1150baa8df38e62e9f4ac1eb46cf2">SelectPathButton_Click</a>(<span class="keywordtype">object</span> sender, EventArgs e)</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        {</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            var fbd = <span class="keyword">new</span> FolderBrowserDialog()</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                Description = <span class="stringliteral">&quot;Select where you would like to install the service executables. This isn&#39;t where an actual server instance is created.&quot;</span>,</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                ShowNewFolderButton = <span class="keyword">true</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            };</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="keywordflow">if</span> (fbd.ShowDialog() != DialogResult.OK)</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            pathIsDefault = <span class="keyword">false</span>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            PathTextBox.Text = fbd.SelectedPath + Path.DirectorySeparatorChar + DefaultInstallDir;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a578ee980df73f4fbe3a79b2a477c0a1b">  316</a></span>&#160;        <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a578ee980df73f4fbe3a79b2a477c0a1b">CancelButton_Click</a>(<span class="keywordtype">object</span> sender, EventArgs e)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            cancelled = <span class="keyword">true</span>;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            InstallCancelButton.Enabled = <span class="keyword">false</span>;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;}</div><div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_a284feb2bd1d111844cab7b9177a64fcc"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a284feb2bd1d111844cab7b9177a64fcc">TGS.Installer.UI.Main.Main</a></div><div class="ttdeci">Main()</div><div class="ttdoc">Construct an installer form </div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00038">Main.cs:38</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_interface_1_1_server_interface_html"><div class="ttname"><a href="class_t_g_s_1_1_interface_1_1_server_interface.html">TGS.Interface.ServerInterface</a></div><div class="ttdef"><b>Definition:</b> <a href="_server_interface_8cs_source.html#l00082">ServerInterface.cs:82</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_landing_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_landing.html">TGS.Interface.Components.ITGLanding</a></div><div class="ttdoc">Used for general authentication and listing ITGInstances </div><div class="ttdef"><b>Definition:</b> <a href="_landing_8cs_source.html#l00010">Landing.cs:10</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_a4f1c68505e66e595f9101800b7f73afa"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a4f1c68505e66e595f9101800b7f73afa">TGS.Installer.UI.Main.CleanTempDir</a></div><div class="ttdeci">void CleanTempDir()</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00072">Main.cs:72</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html">TGS.Installer.UI.Main</a></div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00015">Main.cs:15</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_html"><div class="ttname"><a href="namespace_t_g_s_1_1_interface.html">TGS.Interface</a></div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00006">ChatSetupInfo.cs:6</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_a26d94ac37e48303729806419d96c6e98"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a26d94ac37e48303729806419d96c6e98">TGS.Installer.UI.Main.Interface</a></div><div class="ttdeci">IServerInterface Interface</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00033">Main.cs:33</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_a5ff9f14c4e0132d0a29c4cb95aad370a"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a5ff9f14c4e0132d0a29c4cb95aad370a">TGS.Installer.UI.Main.PKillType</a></div><div class="ttdeci">PKillType</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00130">Main.cs:130</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_aa29103ac58d82699a4ff461fd5224c36"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#aa29103ac58d82699a4ff461fd5224c36">TGS.Installer.UI.Main.PromptKillProcesses</a></div><div class="ttdeci">PKillType PromptKillProcesses(string name)</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00137">Main.cs:137</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_i_server_interface_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_i_server_interface.html">TGS.Interface.IServerInterface</a></div><div class="ttdoc">Main  for communicating the ITGSService </div><div class="ttdef"><b>Definition:</b> <a href="_server_interface_8cs_source.html#l00017">ServerInterface.cs:17</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_landing_html_a680f28d669b71238d4c98f1494144d36"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_landing.html#a680f28d669b71238d4c98f1494144d36">TGS.Interface.Components.ITGLanding.ListInstances</a></div><div class="ttdeci">IList&lt; InstanceMetadata &gt; ListInstances()</div><div class="ttdoc">List instances that the caller can access </div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_i_server_interface_html_af1dc3f018b2c8a794059eed8a905566b"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_i_server_interface.html#af1dc3f018b2c8a794059eed8a905566b">TGS.Interface.IServerInterface.ConnectionStatus</a></div><div class="ttdeci">ConnectivityLevel ConnectionStatus()</div><div class="ttdoc">Used to test if the ITGSService is avaiable on the target machine. Note that state can change at any ...</div></div>
<div class="ttc" id="namespace_t_g_s_1_1_server_html"><div class="ttname"><a href="namespace_t_g_s_1_1_server.html">TGS.Server</a></div></div>
<div class="ttc" id="namespace_t_g_s_html"><div class="ttname"><a href="namespace_t_g_s.html">TGS</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_a578ee980df73f4fbe3a79b2a477c0a1b"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a578ee980df73f4fbe3a79b2a477c0a1b">TGS.Installer.UI.Main.CancelButton_Click</a></div><div class="ttdeci">void CancelButton_Click(object sender, EventArgs e)</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00316">Main.cs:316</a></div></div>
<div class="ttc" id="class_form_html"><div class="ttname"><a href="class_form.html">Form</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_ab6b87ba8fae7b84bc33ded501c96cd72"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#ab6b87ba8fae7b84bc33ded501c96cd72">TGS.Installer.UI.Main.tempDir</a></div><div class="ttdeci">string tempDir</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00019">Main.cs:19</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_a83a6ceb6ba724fc9b7254a532ed9994f"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a83a6ceb6ba724fc9b7254a532ed9994f">TGS.Installer.UI.Main.Main_FormClosing</a></div><div class="ttdeci">void Main_FormClosing(object sender, FormClosingEventArgs e)</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00125">Main.cs:125</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_ab9c5c4424df241c854d7f7b712dbf74e"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#ab9c5c4424df241c854d7f7b712dbf74e">TGS.Installer.UI.Main.ConfirmDangerousUpgrade</a></div><div class="ttdeci">bool ConfirmDangerousUpgrade()</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00105">Main.cs:105</a></div></div>
<div class="ttc" id="_t_g_s_8_command_line_2_program_8cs_html_a81a223a02c34d82b47199f08308847f2"><div class="ttname"><a href="_t_g_s_8_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a></div><div class="ttdeci">﻿using System</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_command_line_2_program_8cs_source.html#l00001">Program.cs:1</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_a955862c9b625d07a812fc77fda419aed"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a955862c9b625d07a812fc77fda419aed">TGS.Installer.UI.Main.SetupTempDir</a></div><div class="ttdeci">void SetupTempDir()</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00046">Main.cs:46</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_s_service_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_s_service.html">TGS.Interface.Components.ITGSService</a></div><div class="ttdoc">Interface for managing the service </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_service_8cs_source.html#l00010">Service.cs:10</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_a0b28294a88847f6a9d50605cdfc17904"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a0b28294a88847f6a9d50605cdfc17904">TGS.Installer.UI.Main.InstallButton_Click</a></div><div class="ttdeci">void InstallButton_Click(object sender, EventArgs e)</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00298">Main.cs:298</a></div></div>
<div class="ttc" id="class_installer_html"><div class="ttname"><a href="class_installer.html">Installer</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_ab6781b4ecdab49b32c2733186498d2fc"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#ab6781b4ecdab49b32c2733186498d2fc">TGS.Installer.UI.Main.CheckForExistingVersion</a></div><div class="ttdeci">void CheckForExistingVersion()</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00081">Main.cs:81</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_aaaa1150baa8df38e62e9f4ac1eb46cf2"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#aaaa1150baa8df38e62e9f4ac1eb46cf2">TGS.Installer.UI.Main.SelectPathButton_Click</a></div><div class="ttdeci">void SelectPathButton_Click(object sender, EventArgs e)</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00303">Main.cs:303</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_a9323f3432004b2da5f7370b642f86128"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a9323f3432004b2da5f7370b642f86128">TGS.Installer.UI.Main.TellServiceWereComingForThem</a></div><div class="ttdeci">bool TellServiceWereComingForThem()</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00110">Main.cs:110</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_a6c6d2146d7237bf09aebadb8eebb0a9d"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a6c6d2146d7237bf09aebadb8eebb0a9d">TGS.Installer.UI.Main.AttemptMigrationOfNetSettings</a></div><div class="ttdeci">void AttemptMigrationOfNetSettings()</div><div class="ttdoc">Migrate to the new ServerConfig since the Server.Server won&amp;#39;t know about it until it&amp;#39;s upgraded ...</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00162">Main.cs:162</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_aa4b9c0e14a5bb5b8aaf7d22d45cc1a20"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#aa4b9c0e14a5bb5b8aaf7d22d45cc1a20">TGS.Installer.UI.Main.DoInstall</a></div><div class="ttdeci">async void DoInstall()</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00192">Main.cs:192</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_config_html"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server_config.html">TGS.Server.ServerConfig</a></div><div class="ttdoc">Class for storing server wide settings </div><div class="ttdef"><b>Definition:</b> <a href="_server_config_8cs_source.html#l00010">ServerConfig.cs:10</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html">TGS.Server.Server</a></div><div class="ttdoc">The windows service the application runs as </div><div class="ttdef"><b>Definition:</b> <a href="_server_8cs_source.html#l00018">Server.cs:18</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_installer_1_1_u_i_1_1_main_html_a0f9dc5f7ce940e62a1e5b0247758a6b3"><div class="ttname"><a href="class_t_g_s_1_1_installer_1_1_u_i_1_1_main.html#a0f9dc5f7ce940e62a1e5b0247758a6b3">TGS.Installer.UI.Main.OnUIUpdate</a></div><div class="ttdeci">MessageResult OnUIUpdate(InstallMessage messageType, string message, MessageButtons buttons, MessageIcon icon, MessageDefaultButton defaultButton)</div><div class="ttdef"><b>Definition:</b> <a href="_main_8cs_source.html#l00288">Main.cs:288</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_1_1_components_html"><div class="ttname"><a href="namespace_t_g_s_1_1_interface_1_1_components.html">TGS.Interface.Components</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_administration_8cs_source.html#l00003">Administration.cs:3</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_html_a6aba89d82a2fad3044034cdca1060c4f"><div class="ttname"><a href="namespace_t_g_s_1_1_interface.html#a6aba89d82a2fad3044034cdca1060c4f">TGS.Interface.ConnectivityLevel</a></div><div class="ttdeci">ConnectivityLevel</div><div class="ttdoc">Description of the connectivity level to an Components.ITGInstance or the Components.ITGSService </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00009">Enumerations.cs:9</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_ac4176ac33c52820ff6179dba92f1b092"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#ac4176ac33c52820ff6179dba92f1b092">TGS.Server.Server.Server</a></div><div class="ttdeci">Server(string[] args, ILogger logger)</div><div class="ttdoc">Construct a Server </div><div class="ttdef"><b>Definition:</b> <a href="_server_8cs_source.html#l00090">Server.cs:90</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
