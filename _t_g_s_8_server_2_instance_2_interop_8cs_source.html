<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>tgstation-server: TGS.Server/Instance/Interop.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="tgs.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tgstation-server
   </div>
   <div id="projectbrief">The /tg/station 13 server suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d416ca425b5524beda4d68f02698bdb3.html">TGS.Server</a></li><li class="navelem"><a class="el" href="dir_247dc62efdba86a5141239c39fc82c17.html">Instance</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Interop.cs</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_t_g_s_8_server_2_instance_2_interop_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">using</span> Newtonsoft.Json;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> Newtonsoft.Json.Linq;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> <a class="code" href="_t_g_s_8_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a>;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Collections.Generic;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Net;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Net.Sockets;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Text;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Threading;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Web.Security;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_s.html">TGS</a>.<a class="code" href="namespace_t_g_s_1_1_server.html">Server</a>.<a class="code" href="namespace_t_g_s_1_1_server_1_1_chat_commands.html">ChatCommands</a>;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_s.html">TGS</a>.<a class="code" href="namespace_t_g_s_1_1_interface.html">Interface</a>;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_s.html">TGS</a>.<a class="code" href="namespace_t_g_s_1_1_interface.html">Interface</a>.<a class="code" href="namespace_t_g_s_1_1_interface_1_1_components.html">Components</a>;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_t_g_s.html">TGS</a>.Server</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;{</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <span class="comment">//handles talking between the world and us</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    sealed <span class="keyword">partial class </span>Instance : <a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_interop.html">ITGInterop</a></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    {</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a935cbfa1c54a330b8afd2ff1a2709cca">   20</a></span>&#160;        <span class="keywordtype">object</span> topicLock = <span class="keyword">new</span> object();</div><div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a9f3221023ca082a6adb52ee387ba664d">   21</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> CommsKeyLen = 64;</div><div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a1cf44712e4c4bc40aeafe001be3e8685">   22</a></span>&#160;        <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a1cf44712e4c4bc40aeafe001be3e8685">serviceCommsKey</a>; <span class="comment">//regenerated every DD restart</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        <span class="comment">//range of supported api versions</span></div><div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#aa7b4d6c5e07fec11ef97d10df717a57f">   25</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> AllowedMajorAPIVersion = 2;</div><div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#aadbc57076386211c5940d4283ff28cd0">   26</a></span>&#160;        Version <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#aadbc57076386211c5940d4283ff28cd0">GameAPIVersion</a>;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#ab2352e546e76af17815f6df592c29648">   28</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> SPInstanceName = <span class="stringliteral">&quot;server_instance&quot;</span>;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <span class="comment">//See code/modules/server_tools/server_tools.dm for command switch</span></div><div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a5a0fb0d9226f92194581b6cdf4620313">   31</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> SCHardReboot = <span class="stringliteral">&quot;hard_reboot&quot;</span>;  <span class="comment">//requests that dreamdaemon restarts when the round ends</span></div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a7a166c03452b09f8c70d8d8ca1b578f6">   32</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> SCGracefulShutdown = <span class="stringliteral">&quot;graceful_shutdown&quot;</span>;  <span class="comment">//requests that dreamdaemon stops when the round ends</span></div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#aec7ff08a627279457e1587fdbe413a55">   33</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> SCWorldAnnounce = <span class="stringliteral">&quot;world_announce&quot;</span>;    <span class="comment">//sends param &#39;message&#39; to the world</span></div><div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a0529b34e0af1ac55bbfa5467b32c7943">   34</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> SCListCustomCommands = <span class="stringliteral">&quot;list_custom_commands&quot;</span>; <span class="comment">//Get a list of commands supported by the server</span></div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#ad9b09a2561149aa853596e6f0ad71a2e">   35</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> SCAPICompat = <span class="stringliteral">&quot;api_compat&quot;</span>;    <span class="comment">//Tells the server we understand each other</span></div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a027fd008d970e0ab2bbcf0c6600b2f43">   36</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> SCPlayerCount = <span class="stringliteral">&quot;client_count&quot;</span>;    <span class="comment">//Gets the number of connected client</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a308536fcdae3d6137c06ef240fed600b">   41</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> SRetSuccess = <span class="stringliteral">&quot;SUCCESS&quot;</span>;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#aba675a0e6a86b635cb2036aea2678fbe">   43</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> SRKillProcess = <span class="stringliteral">&quot;killme&quot;</span>;</div><div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a2290e48ea565b2ac1e78eb73da732afe">   44</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> SRIRCBroadcast = <span class="stringliteral">&quot;irc&quot;</span>;</div><div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a62c596891b48f1f82fe5a52f21830972">   45</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> SRIRCAdminChannelMessage = <span class="stringliteral">&quot;send2irc&quot;</span>;</div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a9985e98395e0edf86bf718872d6d3331">   46</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> SRWorldReboot = <span class="stringliteral">&quot;worldreboot&quot;</span>;</div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a1573187e7d948ee500474b9a58f86ec7">   47</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> SRAPIVersion = <span class="stringliteral">&quot;api_ver&quot;</span>;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#adcab46a53b916a68958ba7c905067970">   49</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> CCPHelpText = <span class="stringliteral">&quot;help_text&quot;</span>;</div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a7e8a4c40bb04d8ea1a85730515cea88a">   50</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> CCPAdminOnly = <span class="stringliteral">&quot;admin_only&quot;</span>;</div><div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a1b20fbb6ba614fc58abc9468625c84f7">   51</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> CCPRequiredParameters = <span class="stringliteral">&quot;required_parameters&quot;</span>;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#ac6267c88a28d1fdc4987103c97b401c7">   56</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> BridgeDLLName = <span class="stringliteral">&quot;TGDreamDaemonBridge.dll&quot;</span>;</div><div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a51da4f509e8fbd0f85ef097c9a58e8aa">   60</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> DreamDaemonBridgeNamespace = <span class="stringliteral">&quot;Bridge&quot;</span>;</div><div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#ac855a51c22d3290a2e6d77b397c916e3">   64</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> DreamDaemonBridgeType = <span class="stringliteral">&quot;DreamDaemonBridge&quot;</span>;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#aa08b6bc42a06ba7088caabb6d98c6cd6">   66</a></span>&#160;        List&lt;Command&gt; <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#aa08b6bc42a06ba7088caabb6d98c6cd6">ServerChatCommands</a>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a88e2637eca30898a76015c9014e91ca5">   68</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a88e2637eca30898a76015c9014e91ca5">LoadServerChatCommands</a>()</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        {</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="keywordflow">if</span> (DaemonStatus() != <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Online)</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            var json = SendCommand(SCListCustomCommands);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            <span class="keywordflow">if</span> (String.IsNullOrWhiteSpace(json))</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            List&lt;Command&gt; tmp = <span class="keyword">new</span> List&lt;Command&gt;();</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            {</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> JsonConvert.DeserializeObject&lt;IDictionary&lt;string, object&gt;&gt;(json))</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                    var innerDick = ((JObject)I.Value).ToObject&lt;IDictionary&lt;string, object&gt;&gt;();</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                    var helpText = (string)innerDick[CCPHelpText];</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                    var adminOnly = ((long)innerDick[CCPAdminOnly]) == 1;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                    var requiredParams = (int)((<span class="keywordtype">long</span>)innerDick[CCPRequiredParameters]);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                    tmp.Add(<span class="keyword">new</span> <a class="code" href="class_t_g_s_1_1_server_1_1_chat_commands_1_1_server_chat_command.html">ServerChatCommand</a>(I.Key, helpText, adminOnly, requiredParams));</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                }</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                ServerChatCommands = tmp;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="keywordflow">catch</span> { }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="comment">//raw command string sent here via world.ExportService</span></div><div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a76b67e720a6d10892adcbc460af2a62f">   92</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a76b67e720a6d10892adcbc460af2a62f">HandleCommand</a>(<span class="keywordtype">string</span> cmd)</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            var splits = <span class="keyword">new</span> List&lt;string&gt;(cmd.Split(<span class="charliteral">&#39; &#39;</span>));</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            cmd = splits[0];</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            splits.RemoveAt(0);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keywordtype">bool</span> APIValid;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            lock (topicLock)</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                APIValid = CheckAPIVersionConstraints();</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <span class="keywordflow">if</span> (!APIValid &amp;&amp; cmd != SRAPIVersion)</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                <span class="keywordflow">return</span>; <span class="comment">//SPEAK THE LANGUAGE!!!</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <span class="keywordflow">switch</span> (cmd)</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            {</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                <span class="keywordflow">case</span> SRIRCBroadcast:</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                    SendMessage(<span class="stringliteral">&quot;GAME: &quot;</span> + String.Join(<span class="stringliteral">&quot; &quot;</span>, splits), <a class="code" href="namespace_t_g_s_1_1_server.html#ac244e362b52b9feac67ac6c2ca27f522">MessageType</a>.GameInfo);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                <span class="keywordflow">case</span> SRKillProcess:</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    KillMe();</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                <span class="keywordflow">case</span> SRIRCAdminChannelMessage:</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                    SendMessage(<span class="stringliteral">&quot;RELAY: &quot;</span> + String.Join(<span class="stringliteral">&quot; &quot;</span>, splits), <a class="code" href="namespace_t_g_s_1_1_server.html#ac244e362b52b9feac67ac6c2ca27f522">MessageType</a>.AdminInfo);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                <span class="keywordflow">case</span> SRWorldReboot:</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                    WriteInfo(<span class="stringliteral">&quot;World Rebooted&quot;</span>, <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.WorldReboot);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                    WriteCurrentDDLog(<span class="stringliteral">&quot;World rebooted&quot;</span>);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                    ServerChatCommands = null;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                    ChatConnectivityCheck();</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                    lock (CompilerLock)</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                    {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                        <span class="keywordflow">if</span> (UpdateStaged)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                            UpdateStaged = <span class="keyword">false</span>;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                            lock (topicLock)</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                            {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                                GameAPIVersion = null;  <span class="comment">//needs updating</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                            }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                            WriteInfo(<span class="stringliteral">&quot;Staged update applied&quot;</span>, <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.ServerUpdateApplied);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                        }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                    }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                <span class="keywordflow">case</span> SRAPIVersion:</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                    lock (topicLock)</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                    {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                        <span class="keywordflow">try</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                        {</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                            GameAPIVersion = <span class="keyword">new</span> Version(splits[0]);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                            <span class="keywordflow">if</span> (!CheckAPIVersionConstraints())</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception();</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                        }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                        <span class="keywordflow">catch</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                        {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                            WriteWarning(String.Format(<span class="stringliteral">&quot;API version of the game ({0}) is incompatible with the current supported API versions (3.{2}.x.x). Interop disabled.&quot;</span>, splits.Count &gt; 1 ? splits[1] : <span class="stringliteral">&quot;NULL&quot;</span>, AllowedMajorAPIVersion), <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.APIVersionMismatch);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                            GameAPIVersion = null;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                        }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                    }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                    <span class="comment">//This needs to be done asyncronously otherwise DD won&#39;t be able to process it, because it&#39;s waiting for THIS THREAD to return</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                    ThreadPool.QueueUserWorkItem(_ =&gt; SendCommand(SCAPICompat));</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            }</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a50ef3869e320d3d7c43859268da2a03a">  158</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a50ef3869e320d3d7c43859268da2a03a">SendCommand</a>(<span class="keywordtype">string</span> cmd)</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        {</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                <span class="keywordflow">if</span> (currentStatus != <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Online)</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error: Server Offline!&quot;</span>;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                <span class="keywordflow">return</span> SendTopic(String.Format(<span class="stringliteral">&quot;serviceCommsKey={0};command={1}&quot;</span>, serviceCommsKey, cmd), currentPort);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a9c3a5860e58497bfb14facc8fcdacd79">  168</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a9c3a5860e58497bfb14facc8fcdacd79">PlayerCount</a>()</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                <span class="keywordflow">return</span> Convert.ToInt32(SendCommand(SCPlayerCount));</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <span class="keywordflow">catch</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment">//requires topiclock</span></div><div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a0682d849b31d91c475f93ae3960de0a6">  181</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a0682d849b31d91c475f93ae3960de0a6">CheckAPIVersionConstraints</a>()</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            <span class="comment">//major will never change for all of TGS3</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <span class="comment">//we treat minor as major, build as minor, and revision as patch</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <span class="keywordflow">return</span> !(GameAPIVersion == null || GameAPIVersion.Minor != AllowedMajorAPIVersion);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="comment">//Fuckery to diddle byond with the right packet to accept our girth</span></div><div class="line"><a name="l00189"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a6262dc7ff76dd0905edc9ef526f6ef6d">  189</a></span>&#160;        <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a6262dc7ff76dd0905edc9ef526f6ef6d">SendTopic</a>(<span class="keywordtype">string</span> topicdata, ushort port)</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="comment">//santize the escape characters in accordance with http://www.byond.com/docs/ref/info.html#/proc/params2list</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            lock (topicLock) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                <span class="keywordflow">if</span> (!CheckAPIVersionConstraints())</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Incompatible API!&quot;</span>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                StringBuilder stringPacket = <span class="keyword">new</span> StringBuilder();</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                stringPacket.Append((<span class="keywordtype">char</span>)<span class="stringliteral">&#39;\x00&#39;</span>, 8);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                stringPacket.Append(<span class="charliteral">&#39;?&#39;</span> + topicdata);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                stringPacket.Append((<span class="keywordtype">char</span>)<span class="stringliteral">&#39;\x00&#39;</span>);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                <span class="keywordtype">string</span> fullString = stringPacket.ToString();</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                var packet = Encoding.ASCII.GetBytes(fullString);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                packet[1] = 0x83;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                var FinalLength = packet.Length - 4;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                <span class="keywordflow">if</span> (FinalLength &gt; UInt16.MaxValue)</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error: Topic too long&quot;</span>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                var lengthBytes = BitConverter.GetBytes((ushort)FinalLength);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                packet[2] = lengthBytes[1]; <span class="comment">//fucking endianess</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                packet[3] = lengthBytes[0];</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                var returnedString = <span class="stringliteral">&quot;NULL&quot;</span>;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                var returnedData = <span class="keyword">new</span> byte[UInt16.MaxValue];</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                <span class="keyword">using</span> (var topicSender = <span class="keyword">new</span> Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp) { SendTimeout = 5000, ReceiveTimeout = 5000 })</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                    {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                        topicSender.Connect(IPAddress.Loopback, port);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                        topicSender.Send(packet);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                        <span class="keywordflow">try</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                        {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                            topicSender.Receive(returnedData);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                            var raw_string = Encoding.ASCII.GetString(returnedData).TrimEnd(<span class="keyword">new</span> <span class="keywordtype">char</span>[] { (char)0 }).Trim();</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                            <span class="keywordflow">if</span> (raw_string.Length &gt; 6)</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                                returnedString = raw_string.Substring(5, raw_string.Length - 5).Trim();</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                        }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                        <span class="keywordflow">catch</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                        {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                            returnedString = <span class="stringliteral">&quot;Topic recieve error!&quot;</span>;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                        }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                        <span class="keywordflow">finally</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                        {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                            topicSender.Shutdown(SocketShutdown.Both);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                        }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                    }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                    <span class="keywordflow">catch</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                    {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Topic delivery failed!&quot;</span>;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                    }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                    </div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                <span class="keywordflow">return</span> returnedString;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        }</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="comment">//Every time we make a new DD process we generate a new comms key for security</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="comment">//It&#39;s in world.params[&#39;server_service&#39;]</span></div><div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a79fe7f8f358836c364eb1721bac471fe">  247</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a79fe7f8f358836c364eb1721bac471fe">GenCommsKey</a>()</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            var charsToRemove = <span class="keyword">new</span> <span class="keywordtype">string</span>[] { <span class="stringliteral">&quot;!&quot;</span>, <span class="stringliteral">&quot;@&quot;</span>, <span class="stringliteral">&quot;#&quot;</span>, <span class="stringliteral">&quot;$&quot;</span>, <span class="stringliteral">&quot;%&quot;</span>, <span class="stringliteral">&quot;^&quot;</span>, <span class="stringliteral">&quot;&amp;&quot;</span>, <span class="stringliteral">&quot;*&quot;</span>, <span class="stringliteral">&quot;(&quot;</span>, <span class="stringliteral">&quot;)&quot;</span>, <span class="stringliteral">&quot;_&quot;</span>, <span class="stringliteral">&quot;-&quot;</span>, <span class="stringliteral">&quot;+&quot;</span>, <span class="stringliteral">&quot;=&quot;</span>, <span class="stringliteral">&quot;[&quot;</span>, <span class="stringliteral">&quot;{&quot;</span>, <span class="stringliteral">&quot;]&quot;</span>, <span class="stringliteral">&quot;}&quot;</span>, <span class="stringliteral">&quot;;&quot;</span>, <span class="stringliteral">&quot;:&quot;</span>, <span class="stringliteral">&quot;&lt;&quot;</span>, <span class="stringliteral">&quot;&gt;&quot;</span>, <span class="stringliteral">&quot;|&quot;</span>, <span class="stringliteral">&quot;.&quot;</span>, <span class="stringliteral">&quot;/&quot;</span>, <span class="stringliteral">&quot;?&quot;</span> };</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            serviceCommsKey = String.Empty;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="keywordflow">do</span> {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                var tmp = Membership.GeneratePassword(CommsKeyLen, 0);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                <span class="keywordflow">foreach</span> (var c <span class="keywordflow">in</span> charsToRemove)</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                    tmp = tmp.Replace(c, String.Empty);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                serviceCommsKey += tmp;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            } <span class="keywordflow">while</span> (serviceCommsKey.Length &lt; CommsKeyLen);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            serviceCommsKey = serviceCommsKey.Substring(0, CommsKeyLen);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            WriteInfo(<span class="stringliteral">&quot;Service Comms Key set to: &quot;</span> + serviceCommsKey, <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.CommsKeySet);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a4fa17ef8a6d8e1349152c24d18a5abb5">  262</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a4fa17ef8a6d8e1349152c24d18a5abb5">InteropMessage</a>(<span class="keywordtype">string</span> command)</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                HandleCommand(command);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            }</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            <span class="keywordflow">catch</span>(Exception e)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                WriteWarning(String.Format(<span class="stringliteral">&quot;Handle command for \&quot;{0}\&quot; failed: {1}&quot;</span>, command, e.ToString()), <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.InteropCallException);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div><div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a6262dc7ff76dd0905edc9ef526f6ef6d"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a6262dc7ff76dd0905edc9ef526f6ef6d">TGS.Server.Instance.SendTopic</a></div><div class="ttdeci">string SendTopic(string topicdata, ushort port)</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_interop_8cs_source.html#l00189">Interop.cs:189</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a79fe7f8f358836c364eb1721bac471fe"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a79fe7f8f358836c364eb1721bac471fe">TGS.Server.Instance.GenCommsKey</a></div><div class="ttdeci">void GenCommsKey()</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_interop_8cs_source.html#l00247">Interop.cs:247</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a50ef3869e320d3d7c43859268da2a03a"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a50ef3869e320d3d7c43859268da2a03a">TGS.Server.Instance.SendCommand</a></div><div class="ttdeci">string SendCommand(string cmd)</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_interop_8cs_source.html#l00158">Interop.cs:158</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a9c3a5860e58497bfb14facc8fcdacd79"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a9c3a5860e58497bfb14facc8fcdacd79">TGS.Server.Instance.PlayerCount</a></div><div class="ttdeci">int PlayerCount()</div><div class="ttdoc">Returns the number of connected players. Requires game to use API version &gt;= 3.1.0.1 </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_interop_8cs_source.html#l00168">Interop.cs:168</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a76b67e720a6d10892adcbc460af2a62f"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a76b67e720a6d10892adcbc460af2a62f">TGS.Server.Instance.HandleCommand</a></div><div class="ttdeci">void HandleCommand(string cmd)</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_interop_8cs_source.html#l00092">Interop.cs:92</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_html"><div class="ttname"><a href="namespace_t_g_s_1_1_interface.html">TGS.Interface</a></div><div class="ttdef"><b>Definition:</b> <a href="_authentication_header_applicator_8cs_source.html#l00009">AuthenticationHeaderApplicator.cs:9</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_server_html"><div class="ttname"><a href="namespace_t_g_s_1_1_server.html">TGS.Server</a></div></div>
<div class="ttc" id="namespace_t_g_s_html"><div class="ttname"><a href="namespace_t_g_s.html">TGS</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_chat_commands_1_1_server_chat_command_html"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_chat_commands_1_1_server_chat_command.html">TGS.Server.ChatCommands.ServerChatCommand</a></div><div class="ttdoc">ChatCommands generated by DreamDaemon via the API </div><div class="ttdef"><b>Definition:</b> <a href="_server_chat_command_8cs_source.html#l00009">ServerChatCommand.cs:9</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_server_1_1_chat_commands_html"><div class="ttname"><a href="namespace_t_g_s_1_1_server_1_1_chat_commands.html">TGS.Server.ChatCommands</a></div><div class="ttdef"><b>Definition:</b> <a href="_byond_command_8cs_source.html#l00004">ByondCommand.cs:4</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_html_a769cbe24216f6ab7cb0cdf2b39177175"><div class="ttname"><a href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">TGS.Interface.DreamDaemonStatus</a></div><div class="ttdeci">DreamDaemonStatus</div><div class="ttdoc">The status of the DD instance </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00144">Enumerations.cs:144</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a1cf44712e4c4bc40aeafe001be3e8685"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a1cf44712e4c4bc40aeafe001be3e8685">TGS.Server.Instance.serviceCommsKey</a></div><div class="ttdeci">string serviceCommsKey</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_interop_8cs_source.html#l00022">Interop.cs:22</a></div></div>
<div class="ttc" id="_t_g_s_8_command_line_2_program_8cs_html_a81a223a02c34d82b47199f08308847f2"><div class="ttname"><a href="_t_g_s_8_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a></div><div class="ttdeci">﻿using System</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_command_line_2_program_8cs_source.html#l00001">Program.cs:1</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_interop_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_interop.html">TGS.Interface.Components.ITGInterop</a></div><div class="ttdoc">Used by DreamDaemon to access the interop API with call()(). Restrictions are in place so that only a...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_interop_8cs_source.html#l00009">Interop.cs:9</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_aa08b6bc42a06ba7088caabb6d98c6cd6"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#aa08b6bc42a06ba7088caabb6d98c6cd6">TGS.Server.Instance.ServerChatCommands</a></div><div class="ttdeci">List&lt; Command &gt; ServerChatCommands</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_interop_8cs_source.html#l00066">Interop.cs:66</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_server_html_a4682739b9567dc9e4e5c327c253ce311"><div class="ttname"><a href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">TGS.Server.EventID</a></div><div class="ttdeci">EventID</div><div class="ttdoc">Various events and their IDs in no particular order. Found in the Windows event log. These key incremented by 100 and are guaranteed to never be reused in the future. In the windows event viewer, these IDs will be offset by the Instance.LoggingID to distinguish events between instances. Each event ID may be information, a warning, or error and will be documented accordingly. Warnings will occur due to user, data, or network errors. Errors will occur due to filesystem errors or hard faults </div><div class="ttdef"><b>Definition:</b> <a href="_event_i_d_8cs_source.html#l00008">EventID.cs:8</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_server_html_ac244e362b52b9feac67ac6c2ca27f522"><div class="ttname"><a href="namespace_t_g_s_1_1_server.html#ac244e362b52b9feac67ac6c2ca27f522">TGS.Server.MessageType</a></div><div class="ttdeci">MessageType</div><div class="ttdoc">Type of chat message, these may be OR&amp;#39;d together </div><div class="ttdef"><b>Definition:</b> <a href="_message_type_8cs_source.html#l00008">MessageType.cs:8</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_aadbc57076386211c5940d4283ff28cd0"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#aadbc57076386211c5940d4283ff28cd0">TGS.Server.Instance.GameAPIVersion</a></div><div class="ttdeci">Version GameAPIVersion</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_interop_8cs_source.html#l00026">Interop.cs:26</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a0682d849b31d91c475f93ae3960de0a6"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a0682d849b31d91c475f93ae3960de0a6">TGS.Server.Instance.CheckAPIVersionConstraints</a></div><div class="ttdeci">bool CheckAPIVersionConstraints()</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_interop_8cs_source.html#l00181">Interop.cs:181</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a88e2637eca30898a76015c9014e91ca5"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a88e2637eca30898a76015c9014e91ca5">TGS.Server.Instance.LoadServerChatCommands</a></div><div class="ttdeci">void LoadServerChatCommands()</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_interop_8cs_source.html#l00068">Interop.cs:68</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_1_1_components_html"><div class="ttname"><a href="namespace_t_g_s_1_1_interface_1_1_components.html">TGS.Interface.Components</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_administration_8cs_source.html#l00003">Administration.cs:3</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a4fa17ef8a6d8e1349152c24d18a5abb5"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a4fa17ef8a6d8e1349152c24d18a5abb5">TGS.Server.Instance.InteropMessage</a></div><div class="ttdeci">bool InteropMessage(string command)</div><div class="ttdoc">Called from /world/ExportService(command)  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_interop_8cs_source.html#l00262">Interop.cs:262</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
