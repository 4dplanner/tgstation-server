<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>tgstation-server: TGServerService/ServerInstance/DreamDaemon.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="tgs.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tgstation-server
   &#160;<span id="projectnumber">3.1.6.3</span>
   </div>
   <div id="projectbrief">The /tg/station 13 server suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_f220d0611c2e3262469750905b70ffc9.html">TGServerService</a></li><li class="navelem"><a class="el" href="dir_7e4cc728347459cda364f4bf32c2446b.html">ServerInstance</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">DreamDaemon.cs</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">using</span> <a class="code" href="_t_g_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a>;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Diagnostics;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.IO;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Linq;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Reflection;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Threading;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Timers;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_service_interface.html">TGServiceInterface</a>;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_service_interface.html">TGServiceInterface</a>.<a class="code" href="namespace_t_g_service_interface_1_1_components.html">Components</a>;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_t_g_server_service.html">TGServerService</a></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;{</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    <span class="comment">//manages the dd window.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <span class="comment">//It&#39;s not possible to actually click it while starting it in CL mode, so in order to change visibility, security, etc. It restarts the process when the world reboots</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    sealed <span class="keyword">partial class </span>ServerInstance : <a class="code" href="interface_t_g_service_interface_1_1_components_1_1_i_t_g_dream_daemon.html">ITGDreamDaemon</a></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    {</div><div class="line"><a name="l00017"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ad1ddb778169e3f37504360e6850f3b10">   17</a></span>&#160;        <span class="keyword">enum</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad1ddb778169e3f37504360e6850f3b10">ShutdownRequestPhase</a></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        {</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;            None,</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;            Requested,</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;            Pinged,</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        }</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a9fc559e696e31c09e9d88ca4c1571fbc">   27</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a9fc559e696e31c09e9d88ca4c1571fbc">DiagnosticsDir</a> = <span class="stringliteral">&quot;Diagnostics&quot;</span>;</div><div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ad3a9a0f4ee4133a41f3db02bbd87a3a9">   31</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad3a9a0f4ee4133a41f3db02bbd87a3a9">ResourceDiagnosticsDir</a> = DiagnosticsDir + <span class="stringliteral">&quot;/Resources&quot;</span>;</div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a9b032a659fbd00069d0c86e069d2b305">   35</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a9b032a659fbd00069d0c86e069d2b305">DDHangStartTime</a> = 60;</div><div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a157c619b15cfc7da0d7578a84888b803">   39</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a157c619b15cfc7da0d7578a84888b803">DDBadStartTime</a> = 10;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#aa550118aee5bf93064cb25b2171a969b">   44</a></span>&#160;        Process <a class="code" href="class_t_g_server_service_1_1_server_instance.html#aa550118aee5bf93064cb25b2171a969b">Proc</a>;</div><div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a6fccb58474c98b606c222bf343f3a4dc">   48</a></span>&#160;        PerformanceCounter <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a6fccb58474c98b606c222bf343f3a4dc">pcpu</a>;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#aac9358eb96d27250fb77c78695e90128">   53</a></span>&#160;        <span class="keywordtype">object</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#aac9358eb96d27250fb77c78695e90128">watchdogLock</a> = <span class="keyword">new</span> object();</div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#af349ace5ef95d437564deefa68138422">   57</a></span>&#160;        Thread <a class="code" href="class_t_g_server_service_1_1_server_instance.html#af349ace5ef95d437564deefa68138422">DDWatchdog</a>;</div><div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ac30b2fd293b49f890f3a1e32646c6d64">   61</a></span>&#160;        <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ac30b2fd293b49f890f3a1e32646c6d64">currentStatus</a>;</div><div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a20d86baac5dc500fc0fda143655e83e8">   65</a></span>&#160;        <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a20d86baac5dc500fc0fda143655e83e8">CurrentDDLog</a>;</div><div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a4e943244934b9768a821aa6ec722ac18">   69</a></span>&#160;        ushort <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a4e943244934b9768a821aa6ec722ac18">currentPort</a> = 0;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ad5410eb07e2ceac73e7e024919ba3449">   74</a></span>&#160;        <span class="keywordtype">object</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad5410eb07e2ceac73e7e024919ba3449">restartLock</a> = <span class="keyword">new</span> object();</div><div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a4380a85aaa8cdaf5d13a0d90435355d6">   78</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a4380a85aaa8cdaf5d13a0d90435355d6">RestartInProgress</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a8b0e420f5bfb3ddaaae675c4c05dc1c1">   82</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a8b0e420f5bfb3ddaaae675c4c05dc1c1">ReattachInsteadOfRestart</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a76df7e1dbf0a616318dc38a5b74096d2">   87</a></span>&#160;        <a class="code" href="namespace_t_g_service_interface.html#a82f76b01f699bef8336537255d268118">DreamDaemonSecurity</a> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a76df7e1dbf0a616318dc38a5b74096d2">StartingSecurity</a>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a0fcdc82f293c4cd7da11738f2c1e2656">   92</a></span>&#160;        <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad1ddb778169e3f37504360e6850f3b10">ShutdownRequestPhase</a> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a0fcdc82f293c4cd7da11738f2c1e2656">AwaitingShutdown</a>;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a8fa16abc1470f3a09b8c5da998ad03a9">   97</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a8fa16abc1470f3a09b8c5da998ad03a9">InitDreamDaemon</a>()</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            Directory.CreateDirectory(DiagnosticsDir);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            Directory.CreateDirectory(ResourceDiagnosticsDir);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            var Reattach = Properties.Settings.Default.ReattachToDD;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keywordflow">if</span> (Reattach)</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                    Proc = Process.GetProcessById(Properties.Settings.Default.ReattachPID);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                    <span class="keywordflow">if</span> (Proc == null)</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;GetProcessById returned null!&quot;</span>);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_service.html">Service</a>.<a class="code" href="class_t_g_server_service_1_1_service.html#ac90d464e7982312e0a43f1d710bd83a9">WriteInfo</a>(<span class="stringliteral">&quot;Reattached to running DD process!&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.DDReattachSuccess);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                    ThreadPool.QueueUserWorkItem(_ =&gt;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                    {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                        Thread.Sleep(5000);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                        <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">SendMessage</a>(<span class="stringliteral">&quot;DD: Update complete. Watch dog reactivated...&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    });</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    <span class="comment">//start wd </span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                    lock (restartLock)</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                    {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                        RestartInProgress = <span class="keyword">true</span>;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                        ReattachInsteadOfRestart = <span class="keyword">true</span>;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                    }</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                    currentPort = Properties.Settings.Default.ReattachPort;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a5bc2c5cf72086f7be5ab0360a8b97105">serviceCommsKey</a> = Properties.Settings.Default.ReattachCommsKey;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                    {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                        <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a070d3f5a7292c22e7cd0a807a8f73e4a">GameAPIVersion</a> = <span class="keyword">new</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a2e13a465e1c065c58defc0d891822ee5">Version</a>(Properties.Settings.Default.ReattachAPIVersion);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                    }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                    <span class="keywordflow">catch</span> { }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                    currentStatus = <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Online;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                    DDWatchdog = <span class="keyword">new</span> Thread(<span class="keyword">new</span> ThreadStart(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#ab76e4c626e2b38e75781aaad0b7809a9">Watchdog</a>));</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                    DDWatchdog.Start();</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_service.html">Service</a>.<a class="code" href="class_t_g_server_service_1_1_service.html#a103b806b056a42886318a9f0422a865c">WriteError</a>(String.Format(<span class="stringliteral">&quot;Failed to reattach to DreamDaemon! PID: {0}. Exception: {1}&quot;</span>, Properties.Settings.Default.ReattachPID, e.ToString()), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.DDReattachFail);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                <span class="keywordflow">finally</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                {</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                    Properties.Settings.Default.ReattachToDD = <span class="keyword">false</span>;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                    Properties.Settings.Default.Save();</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="keywordflow">if</span> (Proc == null)</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                Proc = <span class="keyword">new</span> Process();</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            Proc.StartInfo.FileName = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a63d04056dea64487e7eaed6b26b57e3a">ByondDirectory</a> + <span class="stringliteral">&quot;/bin/dreamdaemon.exe&quot;</span>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            Proc.StartInfo.UseShellExecute = <span class="keyword">false</span>;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keywordflow">if</span> (Reattach)</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <span class="comment">//autostart the server</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            <span class="keywordflow">if</span> (Properties.Settings.Default.DDAutoStart)</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                <span class="comment">//break this off so we don&#39;t hold up starting the service</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                ThreadPool.QueueUserWorkItem( _ =&gt; { <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a8f8c222dd4a2d21957b968b26eff08a3">Start</a>(); });</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        }</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a901e893be86572cf6a8d539e83de4b2c">  160</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a901e893be86572cf6a8d539e83de4b2c">DisposeDreamDaemon</a>()</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            var Detach = Properties.Settings.Default.ReattachToDD;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordtype">bool</span> RenameLog = <span class="keyword">false</span>;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="class_t_g_server_service_1_1_server_instance.html#ab39a3abd504c56e0d217a7ad475506e4">DaemonStatus</a>() == <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Online)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                <span class="keywordflow">if</span> (!Detach)</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a989bcee76648cec9c7e52a5d33217e90">WorldAnnounce</a>(<span class="stringliteral">&quot;Server service stopped&quot;</span>);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                    Thread.Sleep(1000);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                }</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                    RenameLog = CurrentDDLog != null;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">SendMessage</a>(<span class="stringliteral">&quot;DD: Detaching watch dog for update!&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ac66b59d813dcc51bf26bd90f3b812e8d">WriteCurrentDDLog</a>(<span class="stringliteral">&quot;Service updating! Splitting diagnostics...&quot;</span>);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Detach)</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                Properties.Settings.Default.ReattachToDD = <span class="keyword">false</span>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad8b0bbbe0957e9d732666bec0ec06698">Stop</a>();</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <span class="keywordflow">if</span>(pcpu != null)</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                pcpu.Dispose();</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            <span class="keywordflow">if</span> (RenameLog)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                    File.Move(Path.Combine(ResourceDiagnosticsDir, CurrentDDLog), Path.Combine(ResourceDiagnosticsDir, <span class="stringliteral">&quot;SU-&quot;</span> + CurrentDDLog));</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <span class="keywordflow">catch</span> { }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ab39a3abd504c56e0d217a7ad475506e4">  192</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ab39a3abd504c56e0d217a7ad475506e4">DaemonStatus</a>()</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ac30b2fd293b49f890f3a1e32646c6d64">currentStatus</a>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a2e6fa52a6bc2f17eedd4c5d62f13063f">  201</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a2e6fa52a6bc2f17eedd4c5d62f13063f">RequestRestart</a>()</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_server_instance.html#aaa392248d5913143b6537352190e75e6">SendCommand</a>(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a66f4c90ad2f16211acff4bffd38b63c7">SCHardReboot</a>);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a14fda24298442826a3f5ec506f94c4b3">  207</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a14fda24298442826a3f5ec506f94c4b3">RequestStop</a>()</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                <span class="keywordflow">if</span> (currentStatus != <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Online || AwaitingShutdown != <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad1ddb778169e3f37504360e6850f3b10">ShutdownRequestPhase</a>.None)</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                AwaitingShutdown = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad1ddb778169e3f37504360e6850f3b10">ShutdownRequestPhase</a>.Pinged;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_server_instance.html#aaa392248d5913143b6537352190e75e6">SendCommand</a>(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a5d2da9246c06fca12ffb4cb7a6aef5d8">SCGracefulShutdown</a>);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ad8b0bbbe0957e9d732666bec0ec06698">  219</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad8b0bbbe0957e9d732666bec0ec06698">Stop</a>()</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            Thread t;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                t = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#af349ace5ef95d437564deefa68138422">DDWatchdog</a>;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                DDWatchdog = null;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="keywordflow">if</span> (t != null &amp;&amp; t.IsAlive)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                t.Abort();</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                t.Join();</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            }</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Server not running&quot;</span>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a62a876e7b45a0668c0a545d6c168ab54">  238</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a62a876e7b45a0668c0a545d6c168ab54">SetPort</a>(ushort new_port)</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                Properties.Settings.Default.ServerPort = new_port;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a2e6fa52a6bc2f17eedd4c5d62f13063f">RequestRestart</a>();</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        }</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="comment">//handle a kill request from the server</span></div><div class="line"><a name="l00248"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a8bdb55d2113035b09f1697072e14c873">  248</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a8bdb55d2113035b09f1697072e14c873">KillMe</a>()</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordtype">bool</span> DoRestart;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                DoRestart = AwaitingShutdown == <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad1ddb778169e3f37504360e6850f3b10">ShutdownRequestPhase</a>.None;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                <span class="keywordflow">if</span> (!DoRestart)</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                    AwaitingShutdown = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad1ddb778169e3f37504360e6850f3b10">ShutdownRequestPhase</a>.Pinged;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            }</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            <span class="comment">//Do this is a seperate thread or we&#39;ll kill this thread in the middle of rebooting</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <span class="keywordflow">if</span> (DoRestart)</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                ThreadPool.QueueUserWorkItem(_ =&gt; { <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ac58aa725d4b3a81cf979ab657a02cdb8">Restart</a>(); });</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                ThreadPool.QueueUserWorkItem(_ =&gt; { <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad8b0bbbe0957e9d732666bec0ec06698">Stop</a>(); });</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ac58aa725d4b3a81cf979ab657a02cdb8">  265</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ac58aa725d4b3a81cf979ab657a02cdb8">Restart</a>()</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="class_t_g_server_service_1_1_server_instance.html#ab39a3abd504c56e0d217a7ad475506e4">DaemonStatus</a>() == <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Offline)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a8f8c222dd4a2d21957b968b26eff08a3">Start</a>();</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            lock(restartLock)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                <span class="keywordflow">if</span> (RestartInProgress)</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Restart already in progress&quot;</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                RestartInProgress = <span class="keyword">true</span>;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">SendMessage</a>(<span class="stringliteral">&quot;DD: Hard restart triggered&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad8b0bbbe0957e9d732666bec0ec06698">Stop</a>();</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            var res = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a8f8c222dd4a2d21957b968b26eff08a3">Start</a>();</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <span class="keywordflow">if</span>(res != null)</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                lock(restartLock)</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                {</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                    RestartInProgress = <span class="keyword">false</span>;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ac66b59d813dcc51bf26bd90f3b812e8d">  290</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ac66b59d813dcc51bf26bd90f3b812e8d">WriteCurrentDDLog</a>(<span class="keywordtype">string</span> message)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                <span class="keywordflow">if</span> (currentStatus != <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Online || CurrentDDLog == null)</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                File.AppendAllText(Path.Combine(ResourceDiagnosticsDir, CurrentDDLog), String.Format(<span class="stringliteral">&quot;[{0}]: {1}\n&quot;</span>, DateTime.Now.ToLongTimeString(), message));</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ab76e4c626e2b38e75781aaad0b7809a9">  303</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ab76e4c626e2b38e75781aaad0b7809a9">Watchdog</a>()</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        {</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                lock (restartLock)</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                    <span class="keywordflow">if</span> (!RestartInProgress)</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                    {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                        <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">SendMessage</a>(<span class="stringliteral">&quot;DD: Server started, watchdog active...&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                        <a class="code" href="class_t_g_server_service_1_1_service.html">Service</a>.<a class="code" href="class_t_g_server_service_1_1_service.html#ac90d464e7982312e0a43f1d710bd83a9">WriteInfo</a>(<span class="stringliteral">&quot;Watchdog started&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.DDWatchdogStarted);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                    }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                    {</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                        RestartInProgress = <span class="keyword">false</span>;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                        <span class="keywordflow">if</span> (!ReattachInsteadOfRestart)</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                            <a class="code" href="class_t_g_server_service_1_1_service.html">Service</a>.<a class="code" href="class_t_g_server_service_1_1_service.html#ac90d464e7982312e0a43f1d710bd83a9">WriteInfo</a>(<span class="stringliteral">&quot;Watchdog restarted&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.DDWatchdogRestarted);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                            ReattachInsteadOfRestart = <span class="keyword">false</span>;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                    }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                }</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                var retries = 0;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                var MemTrackTimer = <span class="keyword">new</span> <a class="code" href="namespace_system.html">System</a>.Timers.Timer</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                    AutoReset = <span class="keyword">true</span>,</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                    Interval = 5000 <span class="comment">//every 5 seconds</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                };</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                MemTrackTimer.Elapsed += <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ac23c0fcef71fc61e9429f04482c5035b">MemTrackTimer_Elapsed</a>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                {</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                    var starttime = DateTime.Now;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    lock (watchdogLock)</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                    {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                        <span class="keywordflow">if</span> (AwaitingShutdown == <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad1ddb778169e3f37504360e6850f3b10">ShutdownRequestPhase</a>.Requested)</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                            <a class="code" href="class_t_g_server_service_1_1_server_instance.html#aaa392248d5913143b6537352190e75e6">SendCommand</a>(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a5d2da9246c06fca12ffb4cb7a6aef5d8">SCGracefulShutdown</a>);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                    }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                    <span class="comment">//all good to go, let&#39;s start monitoring</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                    var Now = DateTime.Now;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                    lock (watchdogLock)</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                    {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                        CurrentDDLog = String.Format(<span class="stringliteral">&quot;{0} {1} Diagnostics.txt&quot;</span>, Now.ToLongDateString(), Now.ToLongTimeString()).Replace(<span class="charliteral">&#39;:&#39;</span>, <span class="charliteral">&#39;-&#39;</span>);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                        <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ac66b59d813dcc51bf26bd90f3b812e8d">WriteCurrentDDLog</a>(<span class="stringliteral">&quot;Starting monitoring...&quot;</span>);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                    }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                    pcpu = <span class="keyword">new</span> PerformanceCounter(<span class="stringliteral">&quot;Process&quot;</span>, <span class="stringliteral">&quot;% Processor Time&quot;</span>, Proc.ProcessName, <span class="keyword">true</span>);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                    MemTrackTimer.Start();</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                    {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                        Proc.WaitForExit();</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                    }</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                    <span class="keywordflow">finally</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                    {</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                        lock (watchdogLock) <span class="comment">//synchronize</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                        {</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                            MemTrackTimer.Stop();</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                            pcpu.Dispose();</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                        }</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                    }</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ac66b59d813dcc51bf26bd90f3b812e8d">WriteCurrentDDLog</a>(<span class="stringliteral">&quot;Crash detected!&quot;</span>);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                    lock (watchdogLock)</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                    {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                        currentStatus = <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.HardRebooting;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                        currentPort = 0;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                        Proc.Close();</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                        <span class="keywordflow">if</span> (AwaitingShutdown == <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad1ddb778169e3f37504360e6850f3b10">ShutdownRequestPhase</a>.Pinged)</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                        var BadStart = (DateTime.Now - starttime).TotalSeconds &lt; DDBadStartTime;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                        <span class="keywordflow">if</span> (BadStart)</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                        {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                            ++retries;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                            var sleep_time = (int)Math.Min(Math.Pow(2, retries), 3600); <span class="comment">//max of one hour</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                            <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">SendMessage</a>(String.Format(<span class="stringliteral">&quot;DD: Watchdog server startup failed! Retrying in {0} seconds...&quot;</span>, sleep_time), <a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                            Thread.Sleep(sleep_time * 1000);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                        }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                        {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                            retries = 0;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                            var msg = <span class="stringliteral">&quot;DD: DreamDaemon crashed! Watchdog rebooting DD...&quot;</span>;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                            <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">SendMessage</a>(msg, <a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                            <a class="code" href="class_t_g_server_service_1_1_service.html">Service</a>.<a class="code" href="class_t_g_server_service_1_1_service.html#ae3c4dfb35fce33f3462633036bc5af14">WriteWarning</a>(msg, <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.DDWatchdogRebootingServer);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                        }</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                    }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                    var res = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#af1472fb1f361d0c3bece7d4632edc339">StartImpl</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                    <span class="keywordflow">if</span> (res != null)</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Hard restart failed: &quot;</span> + res);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                }</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            <span class="keywordflow">catch</span> (ThreadAbortException)</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                <span class="comment">//No Mr bond, I expect you to die</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                    <span class="keywordflow">if</span> (!Properties.Settings.Default.ReattachToDD)</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                    {</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                        Proc.Kill();</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                        Proc.WaitForExit();</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                    }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                    {</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                        Properties.Settings.Default.ReattachPID = Proc.Id;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                        Properties.Settings.Default.ReattachPort = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a4e943244934b9768a821aa6ec722ac18">currentPort</a>;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                        Properties.Settings.Default.ReattachCommsKey = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a5bc2c5cf72086f7be5ab0360a8b97105">serviceCommsKey</a>;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                        lock (restartLock)</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                        {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                            RestartInProgress = <span class="keyword">true</span>;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                        }</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                    }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                    Proc.Close();</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                <span class="keywordflow">catch</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                { }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            }</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            {</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">SendMessage</a>(<span class="stringliteral">&quot;DD: Watchdog thread crashed!&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_service.html">Service</a>.<a class="code" href="class_t_g_server_service_1_1_service.html#a103b806b056a42886318a9f0422a865c">WriteError</a>(<span class="stringliteral">&quot;Watch dog thread crashed: &quot;</span> + e.ToString(), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.DDWatchdogCrash);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            }</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <span class="keywordflow">finally</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                lock (watchdogLock)</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                    currentStatus = <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Offline;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                    currentPort = 0;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                    AwaitingShutdown = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad1ddb778169e3f37504360e6850f3b10">ShutdownRequestPhase</a>.None;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                    lock (restartLock)</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                    {</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                        <span class="keywordflow">if</span> (!RestartInProgress)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                        {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                            <span class="keywordflow">if</span> (!Properties.Settings.Default.ReattachToDD)</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                                <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">SendMessage</a>(<span class="stringliteral">&quot;DD: Server stopped, watchdog exiting...&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                            <a class="code" href="class_t_g_server_service_1_1_service.html">Service</a>.<a class="code" href="class_t_g_server_service_1_1_service.html#ac90d464e7982312e0a43f1d710bd83a9">WriteInfo</a>(<span class="stringliteral">&quot;Watch dog exited&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.DDWatchdogExit);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                        }</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                            <a class="code" href="class_t_g_server_service_1_1_service.html">Service</a>.<a class="code" href="class_t_g_server_service_1_1_service.html#ac90d464e7982312e0a43f1d710bd83a9">WriteInfo</a>(<span class="stringliteral">&quot;Watch dog restarting...&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.DDWatchdogRestart);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                    }</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                }</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            }</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ac23c0fcef71fc61e9429f04482c5035b">  452</a></span>&#160;        <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ac23c0fcef71fc61e9429f04482c5035b">MemTrackTimer_Elapsed</a>(<span class="keywordtype">object</span> sender, ElapsedEventArgs e)</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        {</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            ulong megamem;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            <span class="keywordtype">float</span> cputime;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                cputime = pcpu.NextValue();</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                <span class="keyword">using</span> (var pcm = <span class="keyword">new</span> PerformanceCounter(<span class="stringliteral">&quot;Process&quot;</span>, <span class="stringliteral">&quot;Working Set - Private&quot;</span>, Proc.ProcessName, <span class="keyword">true</span>))</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                    megamem = Convert.ToUInt64(pcm.NextValue()) / 1024;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            }</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            var PercentCpuTime = (int)Math.Round((Decimal)cputime);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ac66b59d813dcc51bf26bd90f3b812e8d">WriteCurrentDDLog</a>(String.Format(<span class="stringliteral">&quot;CPU: {1}% Memory: {0}MB&quot;</span>, megamem, PercentCpuTime.ToString(<span class="stringliteral">&quot;D3&quot;</span>)));</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a8873c339ff5b486413e175ac87310be6">  467</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a8873c339ff5b486413e175ac87310be6">CanStart</a>()</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae64d03735cb348d0d162e493bf9b3f68">GetVersion</a>(<a class="code" href="namespace_t_g_service_interface.html#a7610968e566eeb321fee2adba3fbf107">ByondVersion</a>.Installed) == null)</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Byond is not installed!&quot;</span>;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            var DMB = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a6dc8ecb836197d4e0a889d8b8944237a">GameDirLive</a> + <span class="stringliteral">&quot;/&quot;</span> + Properties.Settings.Default.ProjectName + <span class="stringliteral">&quot;.dmb&quot;</span>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            <span class="keywordflow">if</span> (!File.Exists(DMB))</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;Unable to find {0}!&quot;</span>, DMB);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        }</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a8f8c222dd4a2d21957b968b26eff08a3">  478</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a8f8c222dd4a2d21957b968b26eff08a3">Start</a>()</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        {</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a31b1bd6a8c38575bffb5442fbd75a677">CurrentStatus</a>() == <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Staged)</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                <span class="comment">//IMPORTANT: SLEEP FOR A MOMENT OR WONDOWS WON&#39;T RELEASE THE FUCKING BYOND DLL HANDLES!!!! REEEEEEE</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                Thread.Sleep(3000);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a28e22392a22a56807a3c3a6a3a366860">ApplyStagedUpdate</a>();</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            }</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            {</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                <span class="keywordflow">if</span> (currentStatus != <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Offline)</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Server already running&quot;</span>;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                var res = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a8873c339ff5b486413e175ac87310be6">CanStart</a>();</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                <span class="keywordflow">if</span> (res != null)</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                    <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                currentPort = 0;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                currentStatus = <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.HardRebooting;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            }</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#af1472fb1f361d0c3bece7d4632edc339">StartImpl</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        }</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        </div><div class="line"><a name="l00504"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ae430434d3ffdbdaba867da778283b28b">  504</a></span>&#160;        <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae430434d3ffdbdaba867da778283b28b">SecurityWord</a>(<span class="keywordtype">bool</span> starting = <span class="keyword">false</span>)</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            var level = starting ? StartingSecurity : (<a class="code" href="namespace_t_g_service_interface.html#a82f76b01f699bef8336537255d268118">DreamDaemonSecurity</a>)Properties.Settings.Default.ServerSecurity;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            switch (level)</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            {</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_service_interface.html#a82f76b01f699bef8336537255d268118">DreamDaemonSecurity</a>.Safe:</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;safe&quot;</span>;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_service_interface.html#a82f76b01f699bef8336537255d268118">DreamDaemonSecurity</a>.Trusted:</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;trusted&quot;</span>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_service_interface.html#a82f76b01f699bef8336537255d268118">DreamDaemonSecurity</a>.Ultrasafe:</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;ultrasafe&quot;</span>;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                <span class="keywordflow">default</span>:</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                    <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(String.Format(<span class="stringliteral">&quot;Bad DreamDaemon security level: {0}&quot;</span>, level));</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            }</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a4b4771257ed71f5145b495f85a0553da">  524</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a4b4771257ed71f5145b495f85a0553da">UpdateInterfaceDll</a>(<span class="keywordtype">bool</span> overwrite)</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        {</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            var FileExists = File.Exists(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a1ab16aa5c7a41006e221acf710131efe">InterfaceDLLName</a>);</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <span class="keywordflow">if</span> (FileExists &amp;&amp; !overwrite)</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            <span class="comment">//Copy the interface dll to the static dir</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            var InterfacePath = Assembly.GetAssembly(typeof(<a class="code" href="class_t_g_service_interface_1_1_dream_daemon_bridge.html">DreamDaemonBridge</a>)).Location;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                <span class="keywordflow">if</span> (FileExists)</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                    var Old = File.ReadAllBytes(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a1ab16aa5c7a41006e221acf710131efe">InterfaceDLLName</a>);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                    var New = File.ReadAllBytes(InterfacePath);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                    <span class="keywordflow">if</span> (Old.SequenceEqual(New))</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                        <span class="keywordflow">return</span>; <span class="comment">//no need</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                }</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                File.Copy(InterfacePath, <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a1ab16aa5c7a41006e221acf710131efe">InterfaceDLLName</a>, overwrite);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_service.html">Service</a>.<a class="code" href="class_t_g_server_service_1_1_service.html#ac90d464e7982312e0a43f1d710bd83a9">WriteInfo</a>(<span class="stringliteral">&quot;Updated interface DLL&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.InterfaceDLLUpdated);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            }</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            <span class="keywordflow">catch</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                {</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                    <span class="comment">//ok the things being stupid and hasn&#39;t released the dll yet, try ONCE more</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                    Thread.Sleep(1000);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                    File.Copy(InterfacePath, <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a1ab16aa5c7a41006e221acf710131efe">InterfaceDLLName</a>, overwrite);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                }</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                    <span class="comment">//intentionally using the fi</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_service.html">Service</a>.<a class="code" href="class_t_g_server_service_1_1_service.html#a103b806b056a42886318a9f0422a865c">WriteError</a>(<span class="stringliteral">&quot;Failed to update interface DLL! Error: &quot;</span> + e.ToString(), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.InterfaceDLLUpdateFail);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            }</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        }</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#af1472fb1f361d0c3bece7d4632edc339">  564</a></span>&#160;        <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#af1472fb1f361d0c3bece7d4632edc339">StartImpl</a>(<span class="keywordtype">bool</span> watchdog)</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        {</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            {</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                lock (watchdogLock)</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                    var res = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a8873c339ff5b486413e175ac87310be6">CanStart</a>();</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                    <span class="keywordflow">if</span> (res != null)</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                        <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                    var Config = Properties.Settings.Default;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                    var DMB = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a6dc8ecb836197d4e0a889d8b8944237a">GameDirLive</a> + <span class="stringliteral">&quot;/&quot;</span> + Config.ProjectName + <span class="stringliteral">&quot;.dmb&quot;</span>;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a235f24c0d390a379749a478dc5993550">GenCommsKey</a>();</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                    StartingSecurity = (<a class="code" href="namespace_t_g_service_interface.html#a82f76b01f699bef8336537255d268118">DreamDaemonSecurity</a>)Config.ServerSecurity;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                    Proc.StartInfo.Arguments = String.Format(<span class="stringliteral">&quot;{0} -port {1} {5}-close -verbose -params \&quot;server_service={3}&amp;server_service_version={4}\&quot; -{2} -public&quot;</span>, DMB, Config.ServerPort, <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae430434d3ffdbdaba867da778283b28b">SecurityWord</a>(), <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a5bc2c5cf72086f7be5ab0360a8b97105">serviceCommsKey</a>, <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a2e13a465e1c065c58defc0d891822ee5">Version</a>(), Config.Webclient ? <span class="stringliteral">&quot;-webclient &quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a4b4771257ed71f5145b495f85a0553da">UpdateInterfaceDll</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                    lock (<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a8875aeb516888e8ed1007c14302076a1">topicLock</a>)</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                    {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                        <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a070d3f5a7292c22e7cd0a807a8f73e4a">GameAPIVersion</a> = null;  <span class="comment">//needs updating</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                    }</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                    Proc.Start();</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                    Proc.PriorityClass = ProcessPriorityClass.AboveNormal;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                    <span class="keywordflow">if</span> (!Proc.WaitForInputIdle(DDHangStartTime * 1000))</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                    {</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                        Proc.Kill();</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                        Proc.WaitForExit();</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                        Proc.Close();</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                        currentStatus = <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Offline;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                        currentPort = 0;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                        <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;Server start is taking more than {0}s! Aborting!&quot;</span>, DDHangStartTime);</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                    }</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                    currentPort = Config.ServerPort;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                    currentStatus = <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Online;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                    <span class="keywordflow">if</span> (!watchdog)</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                    {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                        DDWatchdog = <span class="keyword">new</span> Thread(<span class="keyword">new</span> ThreadStart(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#ab76e4c626e2b38e75781aaad0b7809a9">Watchdog</a>));</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                        DDWatchdog.Start();</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                    }</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                    <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            }</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                currentStatus = <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Offline;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                <span class="keywordflow">return</span> e.ToString();</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            }</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        }</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#acd87ce466519d0288fdf460eebb4c1d3">  615</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="namespace_t_g_service_interface.html#a82f76b01f699bef8336537255d268118">DreamDaemonSecurity</a> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#acd87ce466519d0288fdf460eebb4c1d3">SecurityLevel</a>()</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                <span class="keywordflow">return</span> (<a class="code" href="namespace_t_g_service_interface.html#a82f76b01f699bef8336537255d268118">DreamDaemonSecurity</a>)Properties.Settings.Default.ServerSecurity;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            }</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        }</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00624"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a9922a66137753d8a21b965fff7469989">  624</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a9922a66137753d8a21b965fff7469989">SetSecurityLevel</a>(<a class="code" href="namespace_t_g_service_interface.html#a82f76b01f699bef8336537255d268118">DreamDaemonSecurity</a> level)</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        {</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            var Config = Properties.Settings.Default;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            var secInt = (int)level;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="keywordtype">bool</span> needReboot;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            {</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                needReboot = Config.ServerSecurity != secInt;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                Config.ServerSecurity = secInt;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            }</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <span class="keywordflow">if</span> (needReboot)</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a2e6fa52a6bc2f17eedd4c5d62f13063f">RequestRestart</a>();</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ab39a3abd504c56e0d217a7ad475506e4">DaemonStatus</a>() != <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Online;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        }</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a97edeb7df9c8724e8ff55cb5438afba6">  640</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a97edeb7df9c8724e8ff55cb5438afba6">Autostart</a>()</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            <span class="keywordflow">return</span> Properties.Settings.Default.DDAutoStart;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        }</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#aae63ea891af8539587b0d5829a9cb4f6">  646</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#aae63ea891af8539587b0d5829a9cb4f6">SetAutostart</a>(<span class="keywordtype">bool</span> on)</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        {</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            Properties.Settings.Default.DDAutoStart = on;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a819f1dd33b77bd47f3796ff462cf7c68">  652</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a819f1dd33b77bd47f3796ff462cf7c68">StatusString</a>(<span class="keywordtype">bool</span> includeMetaInfo)</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        {</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">string</span> visSecStr = <span class="stringliteral">&quot; (Sec: {0})&quot;</span>;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <span class="keywordtype">string</span> res;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;            var ds = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ab39a3abd504c56e0d217a7ad475506e4">DaemonStatus</a>();</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <span class="keywordflow">switch</span> (ds)</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            {</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Offline:</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                    res = <span class="stringliteral">&quot;OFFLINE&quot;</span>;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.HardRebooting:</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                    res = <span class="stringliteral">&quot;REBOOTING&quot;</span>;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Online:</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                    res = <span class="stringliteral">&quot;ONLINE&quot;</span>;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                    <span class="keywordflow">if</span> (includeMetaInfo)</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                    {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                        <span class="keywordtype">string</span> secandvis;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                        lock (watchdogLock)</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                        {</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                            secandvis = String.Format(visSecStr, <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae430434d3ffdbdaba867da778283b28b">SecurityWord</a>(<span class="keyword">true</span>));</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                        }</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                        res += secandvis;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                    }</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                <span class="keywordflow">default</span>:</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                    res = <span class="stringliteral">&quot;NULL AND ERRORS&quot;</span>;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            }</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            <span class="keywordflow">if</span> (includeMetaInfo &amp;&amp; ds != <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Online)</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                res += String.Format(visSecStr, <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae430434d3ffdbdaba867da778283b28b">SecurityWord</a>());</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        }</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00687"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a58391828790e7bb5f4f6bce1ee94ba8a">  687</a></span>&#160;        <span class="keyword">public</span> ushort <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a58391828790e7bb5f4f6bce1ee94ba8a">Port</a>()</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        {</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;            <span class="keywordflow">return</span> Properties.Settings.Default.ServerPort;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        }</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a63f7a4713145730f329e375b30213862">  693</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a63f7a4713145730f329e375b30213862">ShutdownInProgress</a>()</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        {</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                <span class="keywordflow">return</span> AwaitingShutdown != <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ad1ddb778169e3f37504360e6850f3b10">ShutdownRequestPhase</a>.None;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            }</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        }</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div><div class="line"><a name="l00702"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a989bcee76648cec9c7e52a5d33217e90">  702</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a989bcee76648cec9c7e52a5d33217e90">WorldAnnounce</a>(<span class="keywordtype">string</span> message)</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        {</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            var res = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#aaa392248d5913143b6537352190e75e6">SendCommand</a>(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a14ef61af60718ccb273ad10c9639d2aa">SCWorldAnnounce</a> + <span class="stringliteral">&quot;;message=&quot;</span> + <a class="code" href="class_t_g_server_service_1_1_program.html">Program</a>.<a class="code" href="class_t_g_server_service_1_1_program.html#a7c301d450202a1f0ef212beabb74de5b">SanitizeTopicString</a>(message));</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            <span class="keywordflow">if</span> (res == <span class="stringliteral">&quot;SUCCESS&quot;</span>)</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        }</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a8a57165f218c76860f040311e44a9f48">  711</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a8a57165f218c76860f040311e44a9f48">Webclient</a>()</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        {</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <span class="keywordflow">return</span> Properties.Settings.Default.Webclient;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        }</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ac71b088f4e5df4f6925e522759e4093d">  717</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ac71b088f4e5df4f6925e522759e4093d">SetWebclient</a>(<span class="keywordtype">bool</span> on)</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        {</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            var Config = Properties.Settings.Default;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            lock (watchdogLock) {</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                var diff = on != Config.Webclient;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                <span class="keywordflow">if</span> (diff)</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                {</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                    Config.Webclient = on;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a2e6fa52a6bc2f17eedd4c5d62f13063f">RequestRestart</a>();</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                }</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            }</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        }</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    }</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;}</div><div class="ttc" id="namespace_t_g_service_interface_1_1_components_html"><div class="ttname"><a href="namespace_t_g_service_interface_1_1_components.html">TGServiceInterface.Components</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_g_service_interface_2_components_2_administration_8cs_source.html#l00003">Administration.cs:3</a></div></div>
<div class="ttc" id="namespace_t_g_server_service_html_a77ffb8da5e77d0173c9a1a3b8ba0b110"><div class="ttname"><a href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">TGServerService.MessageType</a></div><div class="ttdeci">MessageType</div><div class="ttdoc">Type of chat message, these may be OR&amp;#39;d together </div><div class="ttdef"><b>Definition:</b> <a href="_message_type_8cs_source.html#l00008">MessageType.cs:8</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ab39a3abd504c56e0d217a7ad475506e4"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ab39a3abd504c56e0d217a7ad475506e4">TGServerService.ServerInstance.DaemonStatus</a></div><div class="ttdeci">DreamDaemonStatus DaemonStatus()</div><div class="ttdoc">Gets the status of DreamDaemon  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00192">DreamDaemon.cs:192</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_af1472fb1f361d0c3bece7d4632edc339"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#af1472fb1f361d0c3bece7d4632edc339">TGServerService.ServerInstance.StartImpl</a></div><div class="ttdeci">string StartImpl(bool watchdog)</div><div class="ttdoc">Clears the current GameAPIVersion, calls UpdateInterfaceDll(bool) with a  parameter, and attempts to start the DreamDaemon Proc </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00564">DreamDaemon.cs:564</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_aac9358eb96d27250fb77c78695e90128"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#aac9358eb96d27250fb77c78695e90128">TGServerService.ServerInstance.watchdogLock</a></div><div class="ttdeci">object watchdogLock</div><div class="ttdoc">Used for multithreading safety </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00053">DreamDaemon.cs:53</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ac58aa725d4b3a81cf979ab657a02cdb8"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ac58aa725d4b3a81cf979ab657a02cdb8">TGServerService.ServerInstance.Restart</a></div><div class="ttdeci">string Restart()</div><div class="ttdoc">Immediately kills and restarts the server  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00265">DreamDaemon.cs:265</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a9fc559e696e31c09e9d88ca4c1571fbc"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a9fc559e696e31c09e9d88ca4c1571fbc">TGServerService.ServerInstance.DiagnosticsDir</a></div><div class="ttdeci">const string DiagnosticsDir</div><div class="ttdoc">Directory for storing DreamDaemon diagnostic files </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00027">DreamDaemon.cs:27</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a63d04056dea64487e7eaed6b26b57e3a"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a63d04056dea64487e7eaed6b26b57e3a">TGServerService.ServerInstance.ByondDirectory</a></div><div class="ttdeci">const string ByondDirectory</div><div class="ttdoc">The instance directory to store the BYOND installation </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00018">Byond.cs:18</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a0fcdc82f293c4cd7da11738f2c1e2656"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a0fcdc82f293c4cd7da11738f2c1e2656">TGServerService.ServerInstance.AwaitingShutdown</a></div><div class="ttdeci">ShutdownRequestPhase AwaitingShutdown</div><div class="ttdoc">Indicator of progress on a RequestRestart or RequestStop operation </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00092">DreamDaemon.cs:92</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_ac90d464e7982312e0a43f1d710bd83a9"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#ac90d464e7982312e0a43f1d710bd83a9">TGServerService.Service.WriteInfo</a></div><div class="ttdeci">static void WriteInfo(string message, EventID id)</div><div class="ttdoc">Writes information to Windows the event log </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00040">Service.cs:40</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a4b4771257ed71f5145b495f85a0553da"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a4b4771257ed71f5145b495f85a0553da">TGServerService.ServerInstance.UpdateInterfaceDll</a></div><div class="ttdeci">void UpdateInterfaceDll(bool overwrite)</div><div class="ttdoc">Copies InterfaceDLLName from the program directory to the the ServerInstance directory ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00524">DreamDaemon.cs:524</a></div></div>
<div class="ttc" id="namespace_t_g_server_service_html_a98d8f6303b894422167c743e15185398"><div class="ttname"><a href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">TGServerService.EventID</a></div><div class="ttdeci">EventID</div><div class="ttdoc">Various events and their IDs in no particular order. Found in the Windows event log. These incremented by 100 and are guaranteed to never be reused in the future. Each event ID may be information, a warning, or error and will be documented accordingly. Warnings will occur due to user, data, or network errors. Errors will occur due to filesystem errors or hard faults </div><div class="ttdef"><b>Definition:</b> <a href="_event_i_d_8cs_source.html#l00008">EventID.cs:8</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html">TGServerService.Service</a></div><div class="ttdoc">The windows service the application runs as </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00015">Service.cs:15</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a157c619b15cfc7da0d7578a84888b803"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a157c619b15cfc7da0d7578a84888b803">TGServerService.ServerInstance.DDBadStartTime</a></div><div class="ttdeci">const int DDBadStartTime</div><div class="ttdoc">If DreamDaemon crashes before this time it is considered a bad startup </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00039">DreamDaemon.cs:39</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a4380a85aaa8cdaf5d13a0d90435355d6"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a4380a85aaa8cdaf5d13a0d90435355d6">TGServerService.ServerInstance.RestartInProgress</a></div><div class="ttdeci">bool RestartInProgress</div><div class="ttdoc">Used to indicate if an intentional restart is in progress on the watchdog. Requires restartLock to ac...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00078">DreamDaemon.cs:78</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a4e943244934b9768a821aa6ec722ac18"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a4e943244934b9768a821aa6ec722ac18">TGServerService.ServerInstance.currentPort</a></div><div class="ttdeci">ushort currentPort</div><div class="ttdoc">Current port DreamDaemon is running on </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00069">DreamDaemon.cs:69</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a2e13a465e1c065c58defc0d891822ee5"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a2e13a465e1c065c58defc0d891822ee5">TGServerService.ServerInstance.Version</a></div><div class="ttdeci">string Version()</div><div class="ttdoc">Retrieve&amp;#39;s the service&amp;#39;s version  </div><div class="ttdef"><b>Definition:</b> <a href="_server_instance_8cs_source.html#l00045">ServerInstance.cs:45</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ac30b2fd293b49f890f3a1e32646c6d64"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ac30b2fd293b49f890f3a1e32646c6d64">TGServerService.ServerInstance.currentStatus</a></div><div class="ttdeci">DreamDaemonStatus currentStatus</div><div class="ttdoc">The DreamDaemonStatus of Proc </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00061">DreamDaemon.cs:61</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a8a57165f218c76860f040311e44a9f48"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a8a57165f218c76860f040311e44a9f48">TGServerService.ServerInstance.Webclient</a></div><div class="ttdeci">bool Webclient()</div><div class="ttdoc">Check if the BYOND webclient is currently enabled for the server  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00711">DreamDaemon.cs:711</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a235f24c0d390a379749a478dc5993550"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a235f24c0d390a379749a478dc5993550">TGServerService.ServerInstance.GenCommsKey</a></div><div class="ttdeci">void GenCommsKey()</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_interop_8cs_source.html#l00222">Interop.cs:222</a></div></div>
<div class="ttc" id="namespace_t_g_service_interface_html_a7610968e566eeb321fee2adba3fbf107"><div class="ttname"><a href="namespace_t_g_service_interface.html#a7610968e566eeb321fee2adba3fbf107">TGServiceInterface.ByondVersion</a></div><div class="ttdeci">ByondVersion</div><div class="ttdoc">Type of byond version </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00036">Enumerations.cs:36</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a28e22392a22a56807a3c3a6a3a366860"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a28e22392a22a56807a3c3a6a3a366860">TGServerService.ServerInstance.ApplyStagedUpdate</a></div><div class="ttdeci">bool ApplyStagedUpdate()</div><div class="ttdoc">Attempts to move the staged update from StagingDirectory to ByondDirectory. Sets lastError on failure...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00312">Byond.cs:312</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a2e6fa52a6bc2f17eedd4c5d62f13063f"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a2e6fa52a6bc2f17eedd4c5d62f13063f">TGServerService.ServerInstance.RequestRestart</a></div><div class="ttdeci">void RequestRestart()</div><div class="ttdoc">Restart the server after the currently running world reboots. Has no effect if the server isn&amp;#39;t runni...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00201">DreamDaemon.cs:201</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ac66b59d813dcc51bf26bd90f3b812e8d"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ac66b59d813dcc51bf26bd90f3b812e8d">TGServerService.ServerInstance.WriteCurrentDDLog</a></div><div class="ttdeci">void WriteCurrentDDLog(string message)</div><div class="ttdoc">Write a message  to the CurrentDDLog. A timestamp will be prepended to it </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00290">DreamDaemon.cs:290</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_ae3c4dfb35fce33f3462633036bc5af14"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#ae3c4dfb35fce33f3462633036bc5af14">TGServerService.Service.WriteWarning</a></div><div class="ttdeci">static void WriteWarning(string message, EventID id)</div><div class="ttdoc">Writes a warning to the Windows event log </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00058">Service.cs:58</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a989bcee76648cec9c7e52a5d33217e90"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a989bcee76648cec9c7e52a5d33217e90">TGServerService.ServerInstance.WorldAnnounce</a></div><div class="ttdeci">string WorldAnnounce(string message)</div><div class="ttdoc">Sends a message to everyone on the server  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00702">DreamDaemon.cs:702</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a8873c339ff5b486413e175ac87310be6"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a8873c339ff5b486413e175ac87310be6">TGServerService.ServerInstance.CanStart</a></div><div class="ttdeci">string CanStart()</div><div class="ttdoc">Check if a call to Start will fail. Of course, be aware of race conditions with other interfaces  ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00467">DreamDaemon.cs:467</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a66f4c90ad2f16211acff4bffd38b63c7"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a66f4c90ad2f16211acff4bffd38b63c7">TGServerService.ServerInstance.SCHardReboot</a></div><div class="ttdeci">const string SCHardReboot</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_interop_8cs_source.html#l00028">Interop.cs:28</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a20d86baac5dc500fc0fda143655e83e8"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a20d86baac5dc500fc0fda143655e83e8">TGServerService.ServerInstance.CurrentDDLog</a></div><div class="ttdeci">string CurrentDDLog</div><div class="ttdoc">Current logfile in use in ResourceDiagnosticsDir </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00065">DreamDaemon.cs:65</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_aa550118aee5bf93064cb25b2171a969b"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#aa550118aee5bf93064cb25b2171a969b">TGServerService.ServerInstance.Proc</a></div><div class="ttdeci">Process Proc</div><div class="ttdoc">The DreamDaemon process </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00044">DreamDaemon.cs:44</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a1ab16aa5c7a41006e221acf710131efe"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a1ab16aa5c7a41006e221acf710131efe">TGServerService.ServerInstance.InterfaceDLLName</a></div><div class="ttdeci">const string InterfaceDLLName</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_compiler_8cs_source.html#l00038">Compiler.cs:38</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a31b1bd6a8c38575bffb5442fbd75a677"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a31b1bd6a8c38575bffb5442fbd75a677">TGServerService.ServerInstance.CurrentStatus</a></div><div class="ttdeci">ByondStatus CurrentStatus()</div><div class="ttdoc">Gets the current status of any BYOND updates  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00128">Byond.cs:128</a></div></div>
<div class="ttc" id="interface_t_g_service_interface_1_1_components_1_1_i_t_g_dream_daemon_html"><div class="ttname"><a href="interface_t_g_service_interface_1_1_components_1_1_i_t_g_dream_daemon.html">TGServiceInterface.Components.ITGDreamDaemon</a></div><div class="ttdoc">Interface for managing the actual BYOND game server </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_service_interface_2_components_2_dream_daemon_8cs_source.html#l00010">DreamDaemon.cs:10</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a6fccb58474c98b606c222bf343f3a4dc"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a6fccb58474c98b606c222bf343f3a4dc">TGServerService.ServerInstance.pcpu</a></div><div class="ttdeci">PerformanceCounter pcpu</div><div class="ttdoc">CPU performance information for Proc </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00048">DreamDaemon.cs:48</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_acd87ce466519d0288fdf460eebb4c1d3"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#acd87ce466519d0288fdf460eebb4c1d3">TGServerService.ServerInstance.SecurityLevel</a></div><div class="ttdeci">DreamDaemonSecurity SecurityLevel()</div><div class="ttdoc">Get the configured (not necessarily running) security level  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00615">DreamDaemon.cs:615</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a14fda24298442826a3f5ec506f94c4b3"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a14fda24298442826a3f5ec506f94c4b3">TGServerService.ServerInstance.RequestStop</a></div><div class="ttdeci">void RequestStop()</div><div class="ttdoc">Stop the server after the currently running world reboots. Has no effect if the server isn&amp;#39;t running ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00207">DreamDaemon.cs:207</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a901e893be86572cf6a8d539e83de4b2c"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a901e893be86572cf6a8d539e83de4b2c">TGServerService.ServerInstance.DisposeDreamDaemon</a></div><div class="ttdeci">void DisposeDreamDaemon()</div><div class="ttdoc">Either let go of Proc for reattachment or terminate it, depending on Properties.Settings.ReattachToDD </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00160">DreamDaemon.cs:160</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ac23c0fcef71fc61e9429f04482c5035b"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ac23c0fcef71fc61e9429f04482c5035b">TGServerService.ServerInstance.MemTrackTimer_Elapsed</a></div><div class="ttdeci">void MemTrackTimer_Elapsed(object sender, ElapsedEventArgs e)</div><div class="ttdoc">Called every five seconds while DreamDaemon is running to log it&amp;#39;s current state to the DiagnosticsDi...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00452">DreamDaemon.cs:452</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a5bc2c5cf72086f7be5ab0360a8b97105"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a5bc2c5cf72086f7be5ab0360a8b97105">TGServerService.ServerInstance.serviceCommsKey</a></div><div class="ttdeci">string serviceCommsKey</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_interop_8cs_source.html#l00021">Interop.cs:21</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a8fa16abc1470f3a09b8c5da998ad03a9"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a8fa16abc1470f3a09b8c5da998ad03a9">TGServerService.ServerInstance.InitDreamDaemon</a></div><div class="ttdeci">void InitDreamDaemon()</div><div class="ttdoc">Setup or reattach the watchdog, depending on Properties.Settings.ReattachToDD, and create the Diagnos...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00097">DreamDaemon.cs:97</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a76df7e1dbf0a616318dc38a5b74096d2"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a76df7e1dbf0a616318dc38a5b74096d2">TGServerService.ServerInstance.StartingSecurity</a></div><div class="ttdeci">DreamDaemonSecurity StartingSecurity</div><div class="ttdoc">Current DreamDaemonSecurity level of DreamDaemon </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00087">DreamDaemon.cs:87</a></div></div>
<div class="ttc" id="namespace_t_g_service_interface_html_af1c6e932aa16d25cbe05b86e896f3935"><div class="ttname"><a href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">TGServiceInterface.ByondStatus</a></div><div class="ttdeci">ByondStatus</div><div class="ttdoc">The status of a BYOND update job </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00006">Enumerations.cs:6</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ab76e4c626e2b38e75781aaad0b7809a9"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ab76e4c626e2b38e75781aaad0b7809a9">TGServerService.ServerInstance.Watchdog</a></div><div class="ttdeci">void Watchdog()</div><div class="ttdoc">Threaded loop that keeps DreamDaemon from unintentionally stopping </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00303">DreamDaemon.cs:303</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ae64d03735cb348d0d162e493bf9b3f68"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ae64d03735cb348d0d162e493bf9b3f68">TGServerService.ServerInstance.GetVersion</a></div><div class="ttdeci">string GetVersion(ByondVersion type)</div><div class="ttdoc">Get the currently installed version as a string formatted as Major.Minor  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00148">Byond.cs:148</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a8b0e420f5bfb3ddaaae675c4c05dc1c1"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a8b0e420f5bfb3ddaaae675c4c05dc1c1">TGServerService.ServerInstance.ReattachInsteadOfRestart</a></div><div class="ttdeci">bool ReattachInsteadOfRestart</div><div class="ttdoc">Used to indicate if an service restart is in progress on the watchdog. Requires restartLock to access...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00082">DreamDaemon.cs:82</a></div></div>
<div class="ttc" id="_t_g_command_line_2_program_8cs_html_a81a223a02c34d82b47199f08308847f2"><div class="ttname"><a href="_t_g_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a></div><div class="ttdeci">﻿using System</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_command_line_2_program_8cs_source.html#l00001">Program.cs:1</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a6dc8ecb836197d4e0a889d8b8944237a"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a6dc8ecb836197d4e0a889d8b8944237a">TGServerService.ServerInstance.GameDirLive</a></div><div class="ttdeci">const string GameDirLive</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_compiler_8cs_source.html#l00031">Compiler.cs:31</a></div></div>
<div class="ttc" id="namespace_t_g_service_interface_html"><div class="ttname"><a href="namespace_t_g_service_interface.html">TGServiceInterface</a></div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00006">ChatSetupInfo.cs:6</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a9b032a659fbd00069d0c86e069d2b305"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a9b032a659fbd00069d0c86e069d2b305">TGServerService.ServerInstance.DDHangStartTime</a></div><div class="ttdeci">const int DDHangStartTime</div><div class="ttdoc">Time until DD is considered DOA on startup </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00035">DreamDaemon.cs:35</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ad3a9a0f4ee4133a41f3db02bbd87a3a9"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ad3a9a0f4ee4133a41f3db02bbd87a3a9">TGServerService.ServerInstance.ResourceDiagnosticsDir</a></div><div class="ttdeci">const string ResourceDiagnosticsDir</div><div class="ttdoc">Directory for storing DreamDaemon ResourceUsage files </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00031">DreamDaemon.cs:31</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_dream_daemon_bridge_html"><div class="ttname"><a href="class_t_g_service_interface_1_1_dream_daemon_bridge.html">TGServiceInterface.DreamDaemonBridge</a></div><div class="ttdoc">Holds the proc that DD calls to access ITGInterop </div><div class="ttdef"><b>Definition:</b> <a href="_dream_daemon_bridge_8cs_source.html#l00011">DreamDaemonBridge.cs:11</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a8bdb55d2113035b09f1697072e14c873"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a8bdb55d2113035b09f1697072e14c873">TGServerService.ServerInstance.KillMe</a></div><div class="ttdeci">void KillMe()</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00248">DreamDaemon.cs:248</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ad1ddb778169e3f37504360e6850f3b10"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ad1ddb778169e3f37504360e6850f3b10">TGServerService.ServerInstance.ShutdownRequestPhase</a></div><div class="ttdeci">ShutdownRequestPhase</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00017">DreamDaemon.cs:17</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ae6ea9140e5cf33703628ac25700bc556"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">TGServerService.ServerInstance.SendMessage</a></div><div class="ttdeci">void SendMessage(string msg, MessageType mt)</div><div class="ttdoc">Broadcast a message to appropriate channels based on the message type </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_chat_8cs_source.html#l00223">Chat.cs:223</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ad8b0bbbe0957e9d732666bec0ec06698"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ad8b0bbbe0957e9d732666bec0ec06698">TGServerService.ServerInstance.Stop</a></div><div class="ttdeci">string Stop()</div><div class="ttdoc">Immediately kills the server  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00219">DreamDaemon.cs:219</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a070d3f5a7292c22e7cd0a807a8f73e4a"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a070d3f5a7292c22e7cd0a807a8f73e4a">TGServerService.ServerInstance.GameAPIVersion</a></div><div class="ttdeci">Version GameAPIVersion</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_interop_8cs_source.html#l00025">Interop.cs:25</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_af349ace5ef95d437564deefa68138422"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#af349ace5ef95d437564deefa68138422">TGServerService.ServerInstance.DDWatchdog</a></div><div class="ttdeci">Thread DDWatchdog</div><div class="ttdoc">The thread that monitors the status of DreamDaemon </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00057">DreamDaemon.cs:57</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a62a876e7b45a0668c0a545d6c168ab54"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a62a876e7b45a0668c0a545d6c168ab54">TGServerService.ServerInstance.SetPort</a></div><div class="ttdeci">void SetPort(ushort new_port)</div><div class="ttdoc">Set the port to host DD on. Requires reboot to apply. Calls RequestRestart.  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00238">DreamDaemon.cs:238</a></div></div>
<div class="ttc" id="namespace_t_g_service_interface_html_a82f76b01f699bef8336537255d268118"><div class="ttname"><a href="namespace_t_g_service_interface.html#a82f76b01f699bef8336537255d268118">TGServiceInterface.DreamDaemonSecurity</a></div><div class="ttdeci">DreamDaemonSecurity</div><div class="ttdoc">DreamDaemon&amp;#39;s security level </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00133">Enumerations.cs:133</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a8875aeb516888e8ed1007c14302076a1"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a8875aeb516888e8ed1007c14302076a1">TGServerService.ServerInstance.topicLock</a></div><div class="ttdeci">object topicLock</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_interop_8cs_source.html#l00019">Interop.cs:19</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ac71b088f4e5df4f6925e522759e4093d"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ac71b088f4e5df4f6925e522759e4093d">TGServerService.ServerInstance.SetWebclient</a></div><div class="ttdeci">void SetWebclient(bool on)</div><div class="ttdoc">Set the webclient config. Calls RequestRestart  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00717">DreamDaemon.cs:717</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a103b806b056a42886318a9f0422a865c"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a103b806b056a42886318a9f0422a865c">TGServerService.Service.WriteError</a></div><div class="ttdeci">static void WriteError(string message, EventID id)</div><div class="ttdoc">Writes an error to the Windows event log </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00049">Service.cs:49</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a58391828790e7bb5f4f6bce1ee94ba8a"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a58391828790e7bb5f4f6bce1ee94ba8a">TGServerService.ServerInstance.Port</a></div><div class="ttdeci">ushort Port()</div><div class="ttdoc">Get the configured port. Not necessarily the running port if it has since changed  ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00687">DreamDaemon.cs:687</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_program_html_a7c301d450202a1f0ef212beabb74de5b"><div class="ttname"><a href="class_t_g_server_service_1_1_program.html#a7c301d450202a1f0ef212beabb74de5b">TGServerService.Program.SanitizeTopicString</a></div><div class="ttdeci">static string SanitizeTopicString(string input)</div><div class="ttdoc">Properly escapes characters for a BYOND Topic() packet. See http://www.byond.com/docs/ref/info.html#/proc/list2params </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_program_8cs_source.html#l00170">Program.cs:170</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_aae63ea891af8539587b0d5829a9cb4f6"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#aae63ea891af8539587b0d5829a9cb4f6">TGServerService.ServerInstance.SetAutostart</a></div><div class="ttdeci">void SetAutostart(bool on)</div><div class="ttdoc">Set the autostart config  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00646">DreamDaemon.cs:646</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a63f7a4713145730f329e375b30213862"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a63f7a4713145730f329e375b30213862">TGServerService.ServerInstance.ShutdownInProgress</a></div><div class="ttdeci">bool ShutdownInProgress()</div><div class="ttdoc">Checks if a server stop has been requested  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00693">DreamDaemon.cs:693</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a97edeb7df9c8724e8ff55cb5438afba6"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a97edeb7df9c8724e8ff55cb5438afba6">TGServerService.ServerInstance.Autostart</a></div><div class="ttdeci">bool Autostart()</div><div class="ttdoc">Check if the watchdog will start when the service starts  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00640">DreamDaemon.cs:640</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ae430434d3ffdbdaba867da778283b28b"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ae430434d3ffdbdaba867da778283b28b">TGServerService.ServerInstance.SecurityWord</a></div><div class="ttdeci">string SecurityWord(bool starting=false)</div><div class="ttdoc">Translate the configured DreamDaemonSecurity level into a byond command line param ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00504">DreamDaemon.cs:504</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_aaa392248d5913143b6537352190e75e6"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#aaa392248d5913143b6537352190e75e6">TGServerService.ServerInstance.SendCommand</a></div><div class="ttdeci">string SendCommand(string cmd)</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_interop_8cs_source.html#l00131">Interop.cs:131</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a8f8c222dd4a2d21957b968b26eff08a3"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a8f8c222dd4a2d21957b968b26eff08a3">TGServerService.ServerInstance.Start</a></div><div class="ttdeci">string Start()</div><div class="ttdoc">Starts the server if it isn&amp;#39;t running  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00478">DreamDaemon.cs:478</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a9922a66137753d8a21b965fff7469989"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a9922a66137753d8a21b965fff7469989">TGServerService.ServerInstance.SetSecurityLevel</a></div><div class="ttdeci">bool SetSecurityLevel(DreamDaemonSecurity level)</div><div class="ttdoc">Sets the security level of the server. Requires server reboot to apply. Calls RequestRestart. Note that anything higher than Trusted will disable interop from DD  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00624">DreamDaemon.cs:624</a></div></div>
<div class="ttc" id="namespace_t_g_server_service_html"><div class="ttname"><a href="namespace_t_g_server_service.html">TGServerService</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a819f1dd33b77bd47f3796ff462cf7c68"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a819f1dd33b77bd47f3796ff462cf7c68">TGServerService.ServerInstance.StatusString</a></div><div class="ttdeci">string StatusString(bool includeMetaInfo)</div><div class="ttdoc">Returns a human readable string of the current server status  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00652">DreamDaemon.cs:652</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a14ef61af60718ccb273ad10c9639d2aa"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a14ef61af60718ccb273ad10c9639d2aa">TGServerService.ServerInstance.SCWorldAnnounce</a></div><div class="ttdeci">const string SCWorldAnnounce</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_interop_8cs_source.html#l00030">Interop.cs:30</a></div></div>
<div class="ttc" id="namespace_t_g_service_interface_html_a8d0a8727304bcbf3c0b9967701e533e9"><div class="ttname"><a href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">TGServiceInterface.DreamDaemonStatus</a></div><div class="ttdeci">DreamDaemonStatus</div><div class="ttdoc">The status of the DD instance </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00114">Enumerations.cs:114</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ad5410eb07e2ceac73e7e024919ba3449"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ad5410eb07e2ceac73e7e024919ba3449">TGServerService.ServerInstance.restartLock</a></div><div class="ttdeci">object restartLock</div><div class="ttdoc">Used for multithreading safety </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00074">DreamDaemon.cs:74</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a5d2da9246c06fca12ffb4cb7a6aef5d8"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a5d2da9246c06fca12ffb4cb7a6aef5d8">TGServerService.ServerInstance.SCGracefulShutdown</a></div><div class="ttdeci">const string SCGracefulShutdown</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_interop_8cs_source.html#l00029">Interop.cs:29</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_program_html"><div class="ttname"><a href="class_t_g_server_service_1_1_program.html">TGServerService.Program</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_program_8cs_source.html#l00007">Program.cs:7</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
