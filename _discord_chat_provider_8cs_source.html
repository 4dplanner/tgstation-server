<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>tgstation-server: TGServerService/ChatProviders/DiscordChatProvider.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="tgs.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tgstation-server
   &#160;<span id="projectnumber">3.1.5.1</span>
   </div>
   <div id="projectbrief">The /tg/station 13 server suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_f220d0611c2e3262469750905b70ffc9.html">TGServerService</a></li><li class="navelem"><a class="el" href="dir_9412b3c8e581b4647d692201d06f4fef.html">ChatProviders</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">DiscordChatProvider.cs</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_discord_chat_provider_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_discord.html">Discord</a>;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_discord.html">Discord</a>.WebSocket;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> <a class="code" href="_t_g_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a>;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Collections.Generic;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Threading;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Threading.Tasks;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_service_interface.html">TGServiceInterface</a>;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_t_g_server_service.html">TGServerService</a>.ChatProviders</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;{</div><div class="line"><a name="l00014"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html">   14</a></span>&#160;    sealed <span class="keyword">class </span><a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html">DiscordChatProvider</a> : <a class="code" href="interface_t_g_server_service_1_1_chat_providers_1_1_i_chat_provider.html">IChatProvider</a></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    {</div><div class="line"><a name="l00017"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a6bda06c124017932c9117701491326e2">   17</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">event</span> <a class="code" href="namespace_t_g_server_service_1_1_chat_providers.html#ad45a8eb27f10ef48d2473cc64840656b">OnChatMessage</a> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a6bda06c124017932c9117701491326e2">OnChatMessage</a>;</div><div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a7aa4ba708d86d72f6706cfb9d31745e0">   21</a></span>&#160;        DiscordSocketClient <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a7aa4ba708d86d72f6706cfb9d31745e0">client</a>;</div><div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#abfec6631c56fcfb614861d1ba8ed7a68">   25</a></span>&#160;        <a class="code" href="class_t_g_service_interface_1_1_discord_setup_info.html">DiscordSetupInfo</a> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#abfec6631c56fcfb614861d1ba8ed7a68">DiscordConfig</a>;</div><div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a6a832fbc601d2d38cbf1c7d53ef0703a">   29</a></span>&#160;        <span class="keywordtype">object</span> DiscordLock = <span class="keyword">new</span> object();</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#ac326cd5eb269a12d00bb3e7e08c2c4b9">   34</a></span>&#160;        IDictionary&lt;ulong, ISocketMessageChannel&gt; SeenPrivateChannels = <span class="keyword">new</span> Dictionary&lt;ulong, ISocketMessageChannel&gt;();</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a67d765bc0e3d7d2300c0821cf9d71331">   40</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a67d765bc0e3d7d2300c0821cf9d71331">DiscordChatProvider</a>(<a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html">ChatSetupInfo</a> info)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            Init(info);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        }</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        </div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a0b05e9bfa4bc5e853f0b9e383440df7e">   46</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html">ChatSetupInfo</a> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a0b05e9bfa4bc5e853f0b9e383440df7e">ProviderInfo</a>()</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            <span class="keywordflow">return</span> DiscordConfig;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        }</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a7ee477ac6b9a9e84f3eb8bc98607d4f4">   55</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a7ee477ac6b9a9e84f3eb8bc98607d4f4">Init</a>(<a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html">ChatSetupInfo</a> info)</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        {</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;            DiscordConfig = <span class="keyword">new</span> <a class="code" href="class_t_g_service_interface_1_1_discord_setup_info.html">DiscordSetupInfo</a>(info);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            client = <span class="keyword">new</span> DiscordSocketClient();</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;            client.MessageReceived += Client_MessageReceived;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        }</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#aa930dcdd822213a764f6a1ca9e11009f">   67</a></span>&#160;        <span class="keyword">private</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#aa930dcdd822213a764f6a1ca9e11009f">CheckAdmin</a>(SocketUser user)</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            <span class="keywordflow">if</span> (!DiscordConfig.<a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html#ab32ea0b5008445696dc9a3a84d04c037">AdminsAreSpecial</a>)</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                <span class="keywordflow">return</span> DiscordConfig.<a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html#a3db52960b8349d5af2d9a62d30e26ee0">AdminList</a>.Contains(user.Id.ToString());</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            <span class="keywordflow">if</span>(user is SocketGuildUser sgu)</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> sgu.Roles)</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                    <span class="keywordflow">if</span> (DiscordConfig.<a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html#a3db52960b8349d5af2d9a62d30e26ee0">AdminList</a>.Contains(I.Id.ToString()))</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        }</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#abcd57d9186faf25ab800932967e79e50">   83</a></span>&#160;        <span class="keyword">private</span> async Task <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#abcd57d9186faf25ab800932967e79e50">Client_MessageReceived</a>(SocketMessage e)</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            await Task.Run(() =&gt;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                <span class="keywordflow">if</span> (e.Author.Id == client.CurrentUser.Id)</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                var pm = e.Channel is IPrivateChannel;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                if (pm &amp;&amp; !SeenPrivateChannels.ContainsKey(e.Channel.Id))</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                    SeenPrivateChannels.Add(e.Channel.Id, e.Channel);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                var formattedMessage = e.Content;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                <span class="keywordflow">foreach</span> (var u <span class="keywordflow">in</span> e.MentionedUsers)</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                    <span class="keywordflow">if</span> (u.Id == client.CurrentUser.Id)</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                    {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                        found = <span class="keyword">true</span>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                        formattedMessage = formattedMessage.Replace(u.Mention, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                        var nicknameMention = u.Mention.Replace(<span class="stringliteral">&quot;!&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                        formattedMessage = formattedMessage.Replace(nicknameMention, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                    }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                <span class="keywordflow">if</span> (!found &amp;&amp; !pm)</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                formattedMessage = formattedMessage.Trim();</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                var cid = e.Channel.Id.ToString();</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                <a class="code" href="namespace_t_g_server_service_1_1_chat_providers.html#ad45a8eb27f10ef48d2473cc64840656b">OnChatMessage</a>(<span class="keyword">this</span>, e.Author.Id.ToString(), cid, formattedMessage, CheckAdmin(e.Author), pm || DiscordConfig.<a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html#ab469e1c4e7ab1aa9047818400cb51bde">AdminChannels</a>.Contains(cid));</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            });</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        }</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a21a85d291fc6248d54501056ab1fb459">  120</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a21a85d291fc6248d54501056ab1fb459">Connect</a>()</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                <span class="keywordflow">if</span> (Connected() || !DiscordConfig.<a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html#af99a3123f9a81487a55c1d03df28c87d">Enabled</a>)</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                lock (DiscordLock)</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                    SeenPrivateChannels.Clear();</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                    client.LoginAsync(TokenType.Bot, DiscordConfig.<a class="code" href="class_t_g_service_interface_1_1_discord_setup_info.html#a4f3852a72fcc9cfa27c04ab21cc73398">BotToken</a>).Wait();</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                    client.StartAsync().Wait();</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                    Thread.Sleep(1000); <span class="comment">//wait for ConnectionState to update</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                <span class="keywordflow">return</span> !Connected() ? <span class="stringliteral">&quot;Connection failed!&quot;</span> : null;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            {</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                <span class="keywordflow">return</span> e.ToString();</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            }</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a3af2654a9779117ab6e9c1219cefc280">  142</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a3af2654a9779117ab6e9c1219cefc280">Connected</a>()</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            lock (DiscordLock)</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                <span class="keywordflow">return</span> client.ConnectionState == ConnectionState.Connected;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#aa7fb426f756977892bf0888d4f54820a">  151</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#aa7fb426f756977892bf0888d4f54820a">Disconnect</a>()</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                <span class="keywordflow">if</span> (!Connected())</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                lock (DiscordLock)</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                    SeenPrivateChannels.Clear();</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                    client.StopAsync().Wait();</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                    client.LogoutAsync().Wait();</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <span class="keywordflow">catch</span> { }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a0369b8ab52897a59a16bf15746fe23c4">  168</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a0369b8ab52897a59a16bf15746fe23c4">Reconnect</a>()</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            Disconnect();</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="keywordflow">return</span> Connect();</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a058bbd07af35440f7ea9208b691d9611">  175</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a058bbd07af35440f7ea9208b691d9611">SendMessage</a>(<span class="keywordtype">string</span> msg, <a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a> mt)</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        {</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <span class="keywordflow">if</span> (!Connected())</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            lock (DiscordLock)</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                var tasks = <span class="keyword">new</span> List&lt;Task&gt;();</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                var Config = Properties.Settings.Default;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> client.Guilds)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                    <span class="keywordflow">foreach</span> (var J <span class="keywordflow">in</span> I.TextChannels)</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                    {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                        var cid = J.Id.ToString();</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                        var wdc = DiscordConfig.<a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html#af27e3e8438c9f4d0f0badb376d008306">WatchdogChannels</a>;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                        <span class="keywordtype">bool</span> SendToThisChannel = (mt.HasFlag(<a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.AdminInfo) &amp;&amp; DiscordConfig.<a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html#ab469e1c4e7ab1aa9047818400cb51bde">AdminChannels</a>.Contains(cid))</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                            || (mt.HasFlag(<a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.DeveloperInfo) &amp;&amp; DiscordConfig.<a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html#a7bc09dd64238edefade920a349f48fb4">DevChannels</a>.Contains(cid))</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                            || (mt.HasFlag(<a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.GameInfo) &amp;&amp; DiscordConfig.<a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html#a9b83aa3d81e74132368a0652d994fc8a">GameChannels</a>.Contains(cid))</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                            || (mt.HasFlag(<a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.WatchdogInfo) &amp;&amp; DiscordConfig.<a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html#af27e3e8438c9f4d0f0badb376d008306">WatchdogChannels</a>.Contains(cid));</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                        <span class="keywordflow">if</span> (SendToThisChannel)</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                            tasks.Add(J.SendMessageAsync(msg));</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                    }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> tasks)</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                    I.Wait();</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a56f889ad117d2e2687e12e6cb8678471">  202</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a56f889ad117d2e2687e12e6cb8678471">SendMessageDirect</a>(<span class="keywordtype">string</span> message, <span class="keywordtype">string</span> channelname)</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        {</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            <span class="keywordflow">if</span> (!Connected())</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Disconnected.&quot;</span>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                lock (DiscordLock)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                    var tasks = <span class="keyword">new</span> List&lt;Task&gt;();</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                    var Config = Properties.Settings.Default;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                    var channel = Convert.ToUInt64(channelname);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                    <span class="keywordflow">if</span> (SeenPrivateChannels.ContainsKey(channel))</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                        SeenPrivateChannels[channel].SendMessageAsync(message).Wait();</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                        <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> client.Guilds)</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                            <span class="keywordflow">foreach</span> (var J <span class="keywordflow">in</span> I.TextChannels)</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                                <span class="keywordflow">if</span> (J.Id == channel)</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                                    J.SendMessageAsync(message).Wait();</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_service.html">Service</a>.<a class="code" href="class_t_g_server_service_1_1_service.html#ac90d464e7982312e0a43f1d710bd83a9">WriteInfo</a>(String.Format(<span class="stringliteral">&quot;Discord Send ({0}): {1}&quot;</span>, channelname, message), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.ChatSend);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                    <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                }</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            }</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                <span class="keywordflow">return</span> e.ToString();</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#aa179a694ed75414077fb2957fb025ca4">  233</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#aa179a694ed75414077fb2957fb025ca4">DisconnectAndDispose</a>()</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        {</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                client.StopAsync().Wait();</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                client.LogoutAsync().Wait();</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordflow">catch</span> (Exception e) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_service.html">Service</a>.<a class="code" href="class_t_g_server_service_1_1_service.html#a103b806b056a42886318a9f0422a865c">WriteError</a>(<span class="stringliteral">&quot;Discord failed DnD: &quot;</span> + e.ToString(), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.ChatDisconnectFail);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            client.Dispose();</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a5b8a50f076acb05f019b50e338ca4c1c">  247</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a5b8a50f076acb05f019b50e338ca4c1c">SetProviderInfo</a>(<a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html">ChatSetupInfo</a> info)</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                lock (DiscordLock)</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                    var odc = DiscordConfig;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                    DiscordConfig = <span class="keyword">new</span> <a class="code" href="class_t_g_service_interface_1_1_discord_setup_info.html">DiscordSetupInfo</a>(info);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                    <span class="keywordflow">if</span> (DiscordConfig.<a class="code" href="class_t_g_service_interface_1_1_discord_setup_info.html#a4f3852a72fcc9cfa27c04ab21cc73398">BotToken</a> != odc.BotToken)</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                    {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                        DisconnectAndDispose();</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                        Init(info);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                    }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                    <span class="keywordflow">if</span> (DiscordConfig.<a class="code" href="class_t_g_service_interface_1_1_chat_setup_info.html#af99a3123f9a81487a55c1d03df28c87d">Enabled</a>)</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                    {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                        <span class="keywordflow">if</span> (!Connected())</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                            <span class="keywordflow">return</span> Reconnect();</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                    }</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                        Disconnect();</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <span class="keywordflow">return</span> e.ToString();</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="preprocessor">        #region IDisposable Support</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="keyword">private</span> <span class="keywordtype">bool</span> disposedValue = <span class="keyword">false</span>;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#af88621a85d75459616d91264cc0c2e9d">  286</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#af88621a85d75459616d91264cc0c2e9d">Dispose</a>(<span class="keywordtype">bool</span> disposing)</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            <span class="keywordflow">if</span> (!disposedValue)</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                <span class="keywordflow">if</span> (disposing)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                    DisconnectAndDispose();</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                    <span class="comment">// TODO: dispose managed state (managed objects).</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                }</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                <span class="comment">// TODO: free unmanaged resources (unmanaged objects) and override a finalizer below.</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                <span class="comment">// TODO: set large fields to null.</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                disposedValue = <span class="keyword">true</span>;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            }</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="comment">// TODO: override a finalizer only if Dispose(bool disposing) above has code to free unmanaged resources.</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="comment">// ~TGDiscordChatProvider() {</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="comment">//   // Do not change this code. Put cleanup code in Dispose(bool disposing) above.</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="comment">//   Dispose(false);</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="comment">// }</span></div><div class="line"><a name="l00311"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a34562db579658525a5f1cc4361b223be">  311</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a34562db579658525a5f1cc4361b223be">Dispose</a>()</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <span class="comment">// Do not change this code. Put cleanup code in Dispose(bool disposing) above.</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            Dispose(<span class="keyword">true</span>);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="comment">// TODO: uncomment the following line if the finalizer is overridden above.</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <span class="comment">// GC.SuppressFinalize(this);</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="preprocessor">        #endregion</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    }</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;}</div><div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_a3af2654a9779117ab6e9c1219cefc280"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a3af2654a9779117ab6e9c1219cefc280">TGServerService.ChatProviders.DiscordChatProvider.Connected</a></div><div class="ttdeci">bool Connected()</div><div class="ttdoc">Checks if the chat provider is connected  </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00142">DiscordChatProvider.cs:142</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html">TGServerService.ChatProviders.DiscordChatProvider</a></div><div class="ttdoc">IChatProvider for Discord: https://discordapp.com/ </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00014">DiscordChatProvider.cs:14</a></div></div>
<div class="ttc" id="namespace_t_g_server_service_html_a77ffb8da5e77d0173c9a1a3b8ba0b110"><div class="ttname"><a href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">TGServerService.MessageType</a></div><div class="ttdeci">MessageType</div><div class="ttdoc">Type of chat message, these may be OR&amp;#39;d together </div><div class="ttdef"><b>Definition:</b> <a href="_message_type_8cs_source.html#l00008">MessageType.cs:8</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_discord_setup_info_html_a4f3852a72fcc9cfa27c04ab21cc73398"><div class="ttname"><a href="class_t_g_service_interface_1_1_discord_setup_info.html#a4f3852a72fcc9cfa27c04ab21cc73398">TGServiceInterface.DiscordSetupInfo.BotToken</a></div><div class="ttdeci">string BotToken</div><div class="ttdoc">The Discord bot token to use. See https://discordapp.com/developers/applications/me for registering b...</div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00330">ChatSetupInfo.cs:330</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_a6bda06c124017932c9117701491326e2"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a6bda06c124017932c9117701491326e2">TGServerService.ChatProviders.DiscordChatProvider.OnChatMessage</a></div><div class="ttdeci">OnChatMessage OnChatMessage</div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00017">DiscordChatProvider.cs:17</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_chat_setup_info_html_a7bc09dd64238edefade920a349f48fb4"><div class="ttname"><a href="class_t_g_service_interface_1_1_chat_setup_info.html#a7bc09dd64238edefade920a349f48fb4">TGServiceInterface.ChatSetupInfo.DevChannels</a></div><div class="ttdeci">IList&lt; string &gt; DevChannels</div><div class="ttdoc">The channels to which repo and compile messages are sent </div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00151">ChatSetupInfo.cs:151</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_a56f889ad117d2e2687e12e6cb8678471"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a56f889ad117d2e2687e12e6cb8678471">TGServerService.ChatProviders.DiscordChatProvider.SendMessageDirect</a></div><div class="ttdeci">string SendMessageDirect(string message, string channelname)</div><div class="ttdoc">Send a message  to a channel   </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00202">DiscordChatProvider.cs:202</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_ac90d464e7982312e0a43f1d710bd83a9"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#ac90d464e7982312e0a43f1d710bd83a9">TGServerService.Service.WriteInfo</a></div><div class="ttdeci">static void WriteInfo(string message, EventID id)</div><div class="ttdoc">Writes information to Windows the event log </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00040">Service.cs:40</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_discord_setup_info_html"><div class="ttname"><a href="class_t_g_service_interface_1_1_discord_setup_info.html">TGServiceInterface.DiscordSetupInfo</a></div><div class="ttdoc">Chat provider for Discord. Admin entires should be user ids in normal mode or group ids in special mo...</div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00297">ChatSetupInfo.cs:297</a></div></div>
<div class="ttc" id="namespace_t_g_server_service_html_a98d8f6303b894422167c743e15185398"><div class="ttname"><a href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">TGServerService.EventID</a></div><div class="ttdeci">EventID</div><div class="ttdoc">Various events and their IDs in no particular order. Found in the Windows event log. These incremented by 100 and are guaranteed to never be reused in the future. Each event ID may be information, a warning, or error and will be documented accordingly. Warnings will occur due to user, data, or network errors. Errors will occur due to filesystem errors or hard faults </div><div class="ttdef"><b>Definition:</b> <a href="_event_i_d_8cs_source.html#l00008">EventID.cs:8</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html">TGServerService.Service</a></div><div class="ttdoc">The windows service the application runs as </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00015">Service.cs:15</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_chat_setup_info_html_ab32ea0b5008445696dc9a3a84d04c037"><div class="ttname"><a href="class_t_g_service_interface_1_1_chat_setup_info.html#ab32ea0b5008445696dc9a3a84d04c037">TGServiceInterface.ChatSetupInfo.AdminsAreSpecial</a></div><div class="ttdeci">bool AdminsAreSpecial</div><div class="ttdoc">If AdminList corresponds to a Provider specific recognization method </div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00131">ChatSetupInfo.cs:131</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_a0b05e9bfa4bc5e853f0b9e383440df7e"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a0b05e9bfa4bc5e853f0b9e383440df7e">TGServerService.ChatProviders.DiscordChatProvider.ProviderInfo</a></div><div class="ttdeci">ChatSetupInfo ProviderInfo()</div><div class="ttdoc">Gets the info of the provider  </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00046">DiscordChatProvider.cs:46</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_chat_setup_info_html_a9b83aa3d81e74132368a0652d994fc8a"><div class="ttname"><a href="class_t_g_service_interface_1_1_chat_setup_info.html#a9b83aa3d81e74132368a0652d994fc8a">TGServiceInterface.ChatSetupInfo.GameChannels</a></div><div class="ttdeci">IList&lt; string &gt; GameChannels</div><div class="ttdoc">The channels to which game messages are sent </div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00175">ChatSetupInfo.cs:175</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_a058bbd07af35440f7ea9208b691d9611"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a058bbd07af35440f7ea9208b691d9611">TGServerService.ChatProviders.DiscordChatProvider.SendMessage</a></div><div class="ttdeci">void SendMessage(string msg, MessageType mt)</div><div class="ttdoc">Broadcast a message  to appropriate channels based on the message type  </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00175">DiscordChatProvider.cs:175</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_chat_setup_info_html_a3db52960b8349d5af2d9a62d30e26ee0"><div class="ttname"><a href="class_t_g_service_interface_1_1_chat_setup_info.html#a3db52960b8349d5af2d9a62d30e26ee0">TGServiceInterface.ChatSetupInfo.AdminList</a></div><div class="ttdeci">IList&lt; string &gt; AdminList</div><div class="ttdoc">The list of admin entries </div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00123">ChatSetupInfo.cs:123</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_a21a85d291fc6248d54501056ab1fb459"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a21a85d291fc6248d54501056ab1fb459">TGServerService.ChatProviders.DiscordChatProvider.Connect</a></div><div class="ttdeci">string Connect()</div><div class="ttdoc">Connects the chat provider if it&amp;#39;s enabled  </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00120">DiscordChatProvider.cs:120</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_chat_setup_info_html_af99a3123f9a81487a55c1d03df28c87d"><div class="ttname"><a href="class_t_g_service_interface_1_1_chat_setup_info.html#af99a3123f9a81487a55c1d03df28c87d">TGServiceInterface.ChatSetupInfo.Enabled</a></div><div class="ttdeci">bool Enabled</div><div class="ttdoc">If this chat provider is enabled </div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00187">ChatSetupInfo.cs:187</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_chat_setup_info_html"><div class="ttname"><a href="class_t_g_service_interface_1_1_chat_setup_info.html">TGServiceInterface.ChatSetupInfo</a></div><div class="ttdoc">For setting up authentication no matter the chat provider </div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00014">ChatSetupInfo.cs:14</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_aa7fb426f756977892bf0888d4f54820a"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#aa7fb426f756977892bf0888d4f54820a">TGServerService.ChatProviders.DiscordChatProvider.Disconnect</a></div><div class="ttdeci">void Disconnect()</div><div class="ttdoc">Disconnects the chat provider  </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00151">DiscordChatProvider.cs:151</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_a7aa4ba708d86d72f6706cfb9d31745e0"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a7aa4ba708d86d72f6706cfb9d31745e0">TGServerService.ChatProviders.DiscordChatProvider.client</a></div><div class="ttdeci">DiscordSocketClient client</div><div class="ttdoc">The Discord API client </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00021">DiscordChatProvider.cs:21</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_a67d765bc0e3d7d2300c0821cf9d71331"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a67d765bc0e3d7d2300c0821cf9d71331">TGServerService.ChatProviders.DiscordChatProvider.DiscordChatProvider</a></div><div class="ttdeci">DiscordChatProvider(ChatSetupInfo info)</div><div class="ttdoc">Construct a DiscordChatProvider </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00040">DiscordChatProvider.cs:40</a></div></div>
<div class="ttc" id="namespace_t_g_server_service_1_1_chat_providers_html_ad45a8eb27f10ef48d2473cc64840656b"><div class="ttname"><a href="namespace_t_g_server_service_1_1_chat_providers.html#ad45a8eb27f10ef48d2473cc64840656b">TGServerService.ChatProviders.OnChatMessage</a></div><div class="ttdeci">delegate void OnChatMessage(IChatProvider ChatProvider, string speaker, string channel, string message, bool isAdmin, bool isAdminChannel)</div><div class="ttdoc">Callback for the chat provider recieving a message  </div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_abcd57d9186faf25ab800932967e79e50"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#abcd57d9186faf25ab800932967e79e50">TGServerService.ChatProviders.DiscordChatProvider.Client_MessageReceived</a></div><div class="ttdeci">async Task Client_MessageReceived(SocketMessage e)</div><div class="ttdoc">Called when a channel the bot is in recieves a message or the bot is PM&amp;#39;d directly ...</div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00083">DiscordChatProvider.cs:83</a></div></div>
<div class="ttc" id="_t_g_command_line_2_program_8cs_html_a81a223a02c34d82b47199f08308847f2"><div class="ttname"><a href="_t_g_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a></div><div class="ttdeci">﻿using System</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_command_line_2_program_8cs_source.html#l00001">Program.cs:1</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_a5b8a50f076acb05f019b50e338ca4c1c"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a5b8a50f076acb05f019b50e338ca4c1c">TGServerService.ChatProviders.DiscordChatProvider.SetProviderInfo</a></div><div class="ttdeci">string SetProviderInfo(ChatSetupInfo info)</div><div class="ttdoc">Sets info  for the provider  </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00247">DiscordChatProvider.cs:247</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_abfec6631c56fcfb614861d1ba8ed7a68"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#abfec6631c56fcfb614861d1ba8ed7a68">TGServerService.ChatProviders.DiscordChatProvider.DiscordConfig</a></div><div class="ttdeci">DiscordSetupInfo DiscordConfig</div><div class="ttdoc">The setup info for the provider </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00025">DiscordChatProvider.cs:25</a></div></div>
<div class="ttc" id="namespace_t_g_service_interface_html"><div class="ttname"><a href="namespace_t_g_service_interface.html">TGServiceInterface</a></div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00006">ChatSetupInfo.cs:6</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_aa930dcdd822213a764f6a1ca9e11009f"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#aa930dcdd822213a764f6a1ca9e11009f">TGServerService.ChatProviders.DiscordChatProvider.CheckAdmin</a></div><div class="ttdeci">bool CheckAdmin(SocketUser user)</div><div class="ttdoc">Checks if a user  is considered a chat admin </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00067">DiscordChatProvider.cs:67</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_chat_setup_info_html_af27e3e8438c9f4d0f0badb376d008306"><div class="ttname"><a href="class_t_g_service_interface_1_1_chat_setup_info.html#af27e3e8438c9f4d0f0badb376d008306">TGServiceInterface.ChatSetupInfo.WatchdogChannels</a></div><div class="ttdeci">IList&lt; string &gt; WatchdogChannels</div><div class="ttdoc">The channels to which watchdog messages are sent </div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00163">ChatSetupInfo.cs:163</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_a0369b8ab52897a59a16bf15746fe23c4"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a0369b8ab52897a59a16bf15746fe23c4">TGServerService.ChatProviders.DiscordChatProvider.Reconnect</a></div><div class="ttdeci">string Reconnect()</div><div class="ttdoc">Forces a reconnection of the chat provider if it&amp;#39;s enabled  </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00168">DiscordChatProvider.cs:168</a></div></div>
<div class="ttc" id="interface_t_g_server_service_1_1_chat_providers_1_1_i_chat_provider_html"><div class="ttname"><a href="interface_t_g_server_service_1_1_chat_providers_1_1_i_chat_provider.html">TGServerService.ChatProviders.IChatProvider</a></div><div class="ttdoc">Interface for a chat provder service </div><div class="ttdef"><b>Definition:</b> <a href="_chat_provider_8cs_source.html#l00020">ChatProvider.cs:20</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_af88621a85d75459616d91264cc0c2e9d"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#af88621a85d75459616d91264cc0c2e9d">TGServerService.ChatProviders.DiscordChatProvider.Dispose</a></div><div class="ttdeci">void Dispose(bool disposing)</div><div class="ttdoc">Implements the IDisposable pattern. Calls DisconnectAndDispose </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00286">DiscordChatProvider.cs:286</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a103b806b056a42886318a9f0422a865c"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a103b806b056a42886318a9f0422a865c">TGServerService.Service.WriteError</a></div><div class="ttdeci">static void WriteError(string message, EventID id)</div><div class="ttdoc">Writes an error to the Windows event log </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00049">Service.cs:49</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_aa179a694ed75414077fb2957fb025ca4"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#aa179a694ed75414077fb2957fb025ca4">TGServerService.ChatProviders.DiscordChatProvider.DisconnectAndDispose</a></div><div class="ttdeci">void DisconnectAndDispose()</div><div class="ttdoc">Shutsdown and disposes client </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00233">DiscordChatProvider.cs:233</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_a34562db579658525a5f1cc4361b223be"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a34562db579658525a5f1cc4361b223be">TGServerService.ChatProviders.DiscordChatProvider.Dispose</a></div><div class="ttdeci">void Dispose()</div><div class="ttdoc">Implements the IDisposable pattern </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00311">DiscordChatProvider.cs:311</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider_html_a7ee477ac6b9a9e84f3eb8bc98607d4f4"><div class="ttname"><a href="class_t_g_server_service_1_1_chat_providers_1_1_discord_chat_provider.html#a7ee477ac6b9a9e84f3eb8bc98607d4f4">TGServerService.ChatProviders.DiscordChatProvider.Init</a></div><div class="ttdeci">void Init(ChatSetupInfo info)</div><div class="ttdoc">Sets up the Discord API client and DiscordConfig </div><div class="ttdef"><b>Definition:</b> <a href="_discord_chat_provider_8cs_source.html#l00055">DiscordChatProvider.cs:55</a></div></div>
<div class="ttc" id="namespace_t_g_server_service_html"><div class="ttname"><a href="namespace_t_g_server_service.html">TGServerService</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_chat_setup_info_html_ab469e1c4e7ab1aa9047818400cb51bde"><div class="ttname"><a href="class_t_g_service_interface_1_1_chat_setup_info.html#ab469e1c4e7ab1aa9047818400cb51bde">TGServiceInterface.ChatSetupInfo.AdminChannels</a></div><div class="ttdeci">IList&lt; string &gt; AdminChannels</div><div class="ttdoc">The channels from which admin commands/messages can be sent/received </div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00139">ChatSetupInfo.cs:139</a></div></div>
<div class="ttc" id="namespace_discord_html"><div class="ttname"><a href="namespace_discord.html">Discord</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
