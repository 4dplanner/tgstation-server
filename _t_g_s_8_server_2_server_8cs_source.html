<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>tgstation-server: TGS.Server/Server.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="tgs.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tgstation-server
   </div>
   <div id="projectbrief">The /tg/station 13 server suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d416ca425b5524beda4d68f02698bdb3.html">TGS.Server</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Server.cs</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_t_g_s_8_server_2_server_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">using</span> <a class="code" href="_t_g_s_8_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a>;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Collections.Generic;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.IO;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Net;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Reflection;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Security.Principal;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.ServiceModel;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_s.html">TGS</a>.<a class="code" href="namespace_t_g_s_1_1_interface.html">Interface</a>;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_s.html">TGS</a>.<a class="code" href="namespace_t_g_s_1_1_interface.html">Interface</a>.<a class="code" href="namespace_t_g_s_1_1_interface_1_1_components.html">Components</a>;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_s.html">TGS</a>.<a class="code" href="namespace_t_g_s_1_1_server.html">Server</a>.<a class="code" href="namespace_t_g_s_1_1_server_1_1_security.html">Security</a>;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_t_g_s.html">TGS</a>.<a class="code" href="class_t_g_s_1_1_interface_1_1_server.html">Server</a></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;{</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    [ServiceBehavior(ConcurrencyMode = ConcurrencyMode.Multiple, InstanceContextMode = InstanceContextMode.Single)]</div><div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html">   18</a></span>&#160;    <span class="keyword">public</span> sealed <span class="keyword">class </span><a class="code" href="class_t_g_s_1_1_server_1_1_server.html">Server</a> : <a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_s_service.html">ITGSService</a>, <a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_connectivity.html">ITGConnectivity</a>, <a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_landing.html">ITGLanding</a>, <a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_instance_manager.html">ITGInstanceManager</a>, <a class="code" href="class_i_disposable.html">IDisposable</a></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    {</div><div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a702eca8419343fd22ea34a63fc24772e">   23</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">const</span> byte LoggingID = 0;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#ad2024354f2377a559194c252eec1611c">   28</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keywordtype">string</span> MigrationConfigDirectory = <span class="stringliteral">&quot;C:\\TGSSettingUpgradeTempDir&quot;</span>;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a822f4126695b19deb476485057021851">   33</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> readonly <span class="keywordtype">string</span> VersionString = String.Format(<span class="stringliteral">&quot;/tg/station 13 Server v{0}&quot;</span>, Assembly.GetExecutingAssembly().GetName().Version);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a1d74616cab26fd2b954f87e6a9b911a6">   38</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="interface_t_g_s_1_1_server_1_1_i_logger.html">ILogger</a> Logger { <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; }</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#adc8b0e2ed7eaa12ae89d661912a01e50">   43</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server_config.html">ServerConfig</a> Config { <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; }</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a584355066ff6bc0e6d0f45918d1d49ec">   48</a></span>&#160;        <span class="keyword">static</span> readonly <span class="keywordtype">string</span> DefaultConfigDirectory = Directory.CreateDirectory(Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData), <span class="stringliteral">&quot;TGS.Server&quot;</span>)).FullName;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        </div><div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#abc583e331c2692b47d83a4af67ddb5b4">   54</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> WindowsImpersonationContext <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#abc583e331c2692b47d83a4af67ddb5b4">BeginImpersonation</a>()</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        {</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            <span class="keywordflow">return</span> WindowsIdentity.Impersonate(OperationContext.Current.ServiceSecurityContext.WindowsIdentity.Token);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a8af19f53ce6ebfba60a09817af26a667">   64</a></span>&#160;        <span class="keyword">static</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a8af19f53ce6ebfba60a09817af26a667">CheckInstanceName</a>(<span class="keywordtype">string</span> instanceName)</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <span class="keywordtype">char</span>[] bannedCharacters = { <span class="charliteral">&#39;;&#39;</span>, <span class="charliteral">&#39;&amp;&#39;</span>, <span class="charliteral">&#39;=&#39;</span>, <span class="charliteral">&#39;%&#39;</span> };</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> bannedCharacters)</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                <span class="keywordflow">if</span> (instanceName.Contains(I.ToString()))</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Instance names may not contain the following characters: &#39;;&#39;, &#39;&amp;&#39;, &#39;=&#39;, or &#39;%&#39;&quot;</span>;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#adc59504b21e321ca8b9ca792a04099c4">   76</a></span>&#160;        ServiceHost <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#adc59504b21e321ca8b9ca792a04099c4">serviceHost</a>;</div><div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#ac9fd7531267a1affc98b5b3d53b38262">   80</a></span>&#160;        IDictionary&lt;string, ServiceHost&gt; <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#ac9fd7531267a1affc98b5b3d53b38262">hosts</a>;</div><div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a6213ea2ae98c0bd5123ad7602e7fb4c0">   84</a></span>&#160;        IList&lt;int&gt; UsedLoggingIDs = <span class="keyword">new</span> List&lt;int&gt;();</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#ac4176ac33c52820ff6179dba92f1b092">   91</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#ac4176ac33c52820ff6179dba92f1b092">Server</a>(<span class="keywordtype">string</span>[] args, <a class="code" href="interface_t_g_s_1_1_server_1_1_i_logger.html">ILogger</a> logger)</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <span class="comment">//tls1.2 meme</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            ServicePointManager.SecurityProtocol |= SecurityProtocolType.Tls12;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            Logger = logger;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            Environment.CurrentDirectory = Directory.CreateDirectory(Path.Combine(Path.GetTempPath(), Assembly.GetExecutingAssembly().GetName().Name)).FullName;  <span class="comment">//MOVE THIS POINTER BECAUSE ONE TIME I ALMOST ACCIDENTALLY NUKED MYSELF BY REFACTORING! http://imgur.com/zvGEpJD.png</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            SetupConfig();</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            ChangePortFromCommandLine(args);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            SetupService();</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            SetupInstances();</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            OnlineAllHosts();</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        }</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#aca3e4b51f2911f5adab680ee1788075e">  115</a></span>&#160;        IEnumerable&lt;IInstanceConfig&gt; <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#aca3e4b51f2911f5adab680ee1788075e">GetInstanceConfigs</a>()</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            var pathsToRemove = <span class="keyword">new</span> List&lt;string&gt;();</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                var IPS = Config.InstancePaths;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> IPS)</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                {</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                    <a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html">IInstanceConfig</a> ic;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    {</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        ic = <a class="code" href="class_t_g_s_1_1_server_1_1_instance_config.html">InstanceConfig</a>.<a class="code" href="class_t_g_s_1_1_server_1_1_instance_config.html#ab2d62660500deb534464b1f71f5cbd77">Load</a>(I);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                    }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                    <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                    {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                        Logger.WriteError(String.Format(<span class="stringliteral">&quot;Unable load instance config at path {0}. Error: {1} Detaching...&quot;</span>, I, e.ToString()), <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.InstanceInitializationFailure, LoggingID);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                        pathsToRemove.Add(I);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                    }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                    yield <span class="keywordflow">return</span> ic;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> pathsToRemove)</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                    IPS.Remove(I);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            }</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#ac85f8ad559e7ad19aa4a35b173b75478">  145</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#ac85f8ad559e7ad19aa4a35b173b75478">ChangePortFromCommandLine</a>(<span class="keywordtype">string</span>[] args)</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <span class="keywordflow">for</span> (var I = 0; I &lt; args.Length - 1; ++I)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                <span class="keywordflow">if</span> (args[I].ToLower() == <span class="stringliteral">&quot;-port&quot;</span>)</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                    {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                        var res = Convert.ToUInt16(args[I + 1]);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                        <span class="keywordflow">if</span> (res == 0)</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Cannot bind to port 0&quot;</span>);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                        Config.RemoteAccessPort = res;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                    }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                    <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                    {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Invalid argument for \&quot;-port\&quot;&quot;</span>, e);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                    }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                    Config.Save(DefaultConfigDirectory);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#ab1a4188b85e8aea3a1ce2f0394007a38">  169</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#ab1a4188b85e8aea3a1ce2f0394007a38">SetupConfig</a>()</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            Directory.CreateDirectory(DefaultConfigDirectory);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                Config = <a class="code" href="class_t_g_s_1_1_server_1_1_server_config.html">ServerConfig</a>.<a class="code" href="class_t_g_s_1_1_server_1_1_server_config.html#a90c7ef7a8c364210e53a88f6ad26ed4d">Load</a>(DefaultConfigDirectory);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="keywordflow">catch</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                    <span class="comment">//assume we&#39;re upgrading</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                    Config = <a class="code" href="class_t_g_s_1_1_server_1_1_server_config.html">ServerConfig</a>.<a class="code" href="class_t_g_s_1_1_server_1_1_server_config.html#a90c7ef7a8c364210e53a88f6ad26ed4d">Load</a>(MigrationConfigDirectory);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                    Config.<a class="code" href="class_t_g_s_1_1_server_1_1_server_config.html#a25367473db0e5b6c8e9e1ba620fa2e85">Save</a>(DefaultConfigDirectory);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                    <a class="code" href="class_t_g_s_1_1_server_1_1_helpers.html">Helpers</a>.<a class="code" href="class_t_g_s_1_1_server_1_1_helpers.html#a5b1d1510ab671f24b98ecafa79f98c00">DeleteDirectory</a>(MigrationConfigDirectory);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                <span class="keywordflow">catch</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                    <span class="comment">//new baby</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                    Config = <span class="keyword">new</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server_config.html">ServerConfig</a>();</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            }</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a7eab4892a65d9abaaca430f036f3b742">  196</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a7eab4892a65d9abaaca430f036f3b742">SetupService</a>()</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        {</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            serviceHost = CreateHost(<span class="keyword">this</span>, <a class="code" href="class_t_g_s_1_1_interface_1_1_definitions.html">Definitions</a>.<a class="code" href="class_t_g_s_1_1_interface_1_1_definitions.html#ab65eb36f9a4b34fb9a1baba47454c3b7">MasterInterfaceName</a>);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            AddEndpoint(serviceHost, typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_connectivity.html">ITGConnectivity</a>));</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            AddEndpoint(serviceHost, typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_instance_manager.html">ITGInstanceManager</a>));</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            AddEndpoint(serviceHost, typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_landing.html">ITGLanding</a>));</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            AddEndpoint(serviceHost, typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_s_service.html">ITGSService</a>));</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            serviceHost.Authorization.ServiceAuthorizationManager = <span class="keyword">new</span> <a class="code" href="class_t_g_s_1_1_server_1_1_security_1_1_root_authorization_manager.html">RootAuthorizationManager</a>(); <span class="comment">//only admins can diddle us</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            serviceHost.Authentication.ServiceAuthenticationManager = <span class="keyword">new</span> <a class="code" href="class_t_g_s_1_1_server_1_1_security_1_1_authentication_header_decoder.html">AuthenticationHeaderDecoder</a>();</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a41adf96032cfab1b226192fe3c3b0924">  210</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a41adf96032cfab1b226192fe3c3b0924">OnlineAllHosts</a>()</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            serviceHost.Open();</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> hosts)</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                I.Value.Open();</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a761439cde270c74bcf338b83806859ca">  223</a></span>&#160;        <span class="keyword">static</span> ServiceHost <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a761439cde270c74bcf338b83806859ca">CreateHost</a>(<span class="keywordtype">object</span> singleton, <span class="keywordtype">string</span> endpointPostfix)</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">new</span> ServiceHost(singleton, <span class="keyword">new</span> Uri[] { <span class="keyword">new</span> Uri(String.Format(<span class="stringliteral">&quot;net.pipe://localhost/{0}&quot;</span>, endpointPostfix)), <span class="keyword">new</span> Uri(String.Format(<span class="stringliteral">&quot;https://localhost:{0}/{1}&quot;</span>, Config.RemoteAccessPort, endpointPostfix)) })</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                CloseTimeout = <span class="keyword">new</span> TimeSpan(0, 0, 5)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            };</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#ac3a300e8fa5845202d3aa47baa49d0e4">  234</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#ac3a300e8fa5845202d3aa47baa49d0e4">SetupInstances</a>()</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        {</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            hosts = <span class="keyword">new</span> Dictionary&lt;string, ServiceHost&gt;();</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            var pathsToRemove = <span class="keyword">new</span> List&lt;string&gt;();</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            var seenNames = <span class="keyword">new</span> List&lt;string&gt;();</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> GetInstanceConfigs())</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                <span class="keywordflow">if</span> (seenNames.Contains(I.Name))</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                    Logger.WriteError(String.Format(<span class="stringliteral">&quot;Instance at {0} has a duplicate name! Detaching...&quot;</span>, I.Directory), <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.InstanceInitializationFailure, LoggingID);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                    pathsToRemove.Add(I.Directory);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                }</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="keywordflow">if</span> (I.Enabled &amp;&amp; SetupInstance(I) == null)</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                    pathsToRemove.Add(I.Directory);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                    seenNames.Add(I.Name);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            }</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> pathsToRemove)</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                Config.InstancePaths.Remove(I);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        }</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a3c766dcb7ff9a155f16833e35cd2d10d">  259</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a3c766dcb7ff9a155f16833e35cd2d10d">UnlockLoggingID</a>(byte ID)</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            lock (UsedLoggingIDs)</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                UsedLoggingIDs.Remove(ID);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            }</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        }</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a7939236efbbddb15e9c3684eff4d69a2">  271</a></span>&#160;        byte <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a7939236efbbddb15e9c3684eff4d69a2">LockLoggingID</a>()</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            lock (UsedLoggingIDs)</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <span class="keywordflow">for</span> (byte I = 1; I &lt; 100; ++I)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                    <span class="keywordflow">if</span> (!UsedLoggingIDs.Contains(I))</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                    {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                        UsedLoggingIDs.Add(I);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                        <span class="keywordflow">return</span> I;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                    }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;All logging IDs in use!&quot;</span>);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        }</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#affd0676a7a18d7aaeb0561d166406cbe">  290</a></span>&#160;        ServiceHost <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#affd0676a7a18d7aaeb0561d166406cbe">SetupInstance</a>(<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html">IInstanceConfig</a> config)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html">Instance</a> instance;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="keywordtype">string</span> instanceName;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                <span class="keywordflow">if</span> (hosts.ContainsKey(config.<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#a19261e44718496c92045414303b4865c">Directory</a>))</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                    var datInstance = ((<a class="code" href="class_t_g_s_1_1_server_1_1_instance.html">Instance</a>)hosts[config.<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#a19261e44718496c92045414303b4865c">Directory</a>].SingletonInstance);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                    Logger.<a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a85d0b54fc049736f16cdf42f24d34058">WriteError</a>(String.Format(<span class="stringliteral">&quot;Unable to start instance at path {0}. Has the same name as instance at path {1}. Detaching...&quot;</span>, config.<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#a19261e44718496c92045414303b4865c">Directory</a>, datInstance.ServerDirectory()), <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.InstanceInitializationFailure, LoggingID);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                    <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                <span class="keywordflow">if</span> (!config.<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#ad5817438b173304f71061db218332211">Enabled</a>)</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                    <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                var ID = LockLoggingID();</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                Logger.WriteInfo(String.Format(<span class="stringliteral">&quot;Instance {0} ({1}) assigned logging ID {2}&quot;</span>, config.<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#a3833c4e4629bced994a5d641f49d1e13">Name</a>, config.<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#a19261e44718496c92045414303b4865c">Directory</a>, ID), <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.InstanceIDAssigned, ID);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                instanceName = config.<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#a3833c4e4629bced994a5d641f49d1e13">Name</a>;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                instance = <span class="keyword">new</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html">Instance</a>(config, ID);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                Logger.WriteError(String.Format(<span class="stringliteral">&quot;Unable to start instance at path {0}. Detaching... Error: {1}&quot;</span>, config.<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#a19261e44718496c92045414303b4865c">Directory</a>, e.ToString()), <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.InstanceInitializationFailure, LoggingID);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            var host = CreateHost(instance, String.Format(<span class="stringliteral">&quot;{0}/{1}&quot;</span>, <a class="code" href="class_t_g_s_1_1_interface_1_1_definitions.html">Definitions</a>.<a class="code" href="class_t_g_s_1_1_interface_1_1_definitions.html#a6a845123fb932417f59a604266391fb3">InstanceInterfaceName</a>, instanceName));</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            hosts.Add(instanceName, host);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            AddEndpoint(host, typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_connectivity.html">ITGConnectivity</a>));</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            AddEndpoint(host, typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_administration.html">ITGAdministration</a>));</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            AddEndpoint(host, typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_byond.html">ITGByond</a>));</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            AddEndpoint(host, typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_chat.html">ITGChat</a>));</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            AddEndpoint(host, typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_compiler.html">ITGCompiler</a>));</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            AddEndpoint(host, typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_config.html">ITGConfig</a>));</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            AddEndpoint(host, typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_dream_daemon.html">ITGDreamDaemon</a>));</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            AddEndpoint(host, typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_instance.html">ITGInstance</a>));</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            AddEndpoint(host, typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_interop.html">ITGInterop</a>));</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            AddEndpoint(host, typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_repository.html">ITGRepository</a>));</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            host.Authorization.ServiceAuthorizationManager = instance;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            host.Authentication.ServiceAuthenticationManager = <span class="keyword">new</span> <a class="code" href="class_t_g_s_1_1_server_1_1_security_1_1_authentication_header_decoder.html">AuthenticationHeaderDecoder</a>();</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keywordflow">return</span> host;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#ae6005800bd27448325d4b80cd0b1ee72">  339</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#ae6005800bd27448325d4b80cd0b1ee72">AddEndpoint</a>(ServiceHost host, Type typetype)</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            var bindingName = typetype.Name;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            host.AddServiceEndpoint(typetype, <span class="keyword">new</span> NetNamedPipeBinding() { SendTimeout = <span class="keyword">new</span> TimeSpan(0, 0, 30), MaxReceivedMessageSize = <a class="code" href="class_t_g_s_1_1_interface_1_1_definitions.html">Definitions</a>.<a class="code" href="class_t_g_s_1_1_interface_1_1_definitions.html#a9cbf8326b94fc958f8a24e42bedfac13">TransferLimitLocal</a> }, bindingName);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            var httpsBinding = <span class="keyword">new</span> BasicHttpsBinding()</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                SendTimeout = <span class="keyword">new</span> TimeSpan(0, 0, 40),</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                MaxReceivedMessageSize = <a class="code" href="class_t_g_s_1_1_interface_1_1_definitions.html">Definitions</a>.<a class="code" href="class_t_g_s_1_1_interface_1_1_definitions.html#ae6060d0444a8adfddeb0ca1a9bc7c5de">TransferLimitRemote</a></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            };</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            var requireAuth = typetype.Name != typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_connectivity.html">ITGConnectivity</a>).Name;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            host.AddServiceEndpoint(typetype, httpsBinding, bindingName);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        }</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#ad953f35dc952e06223e9504941b7c6ee">  355</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#ad953f35dc952e06223e9504941b7c6ee">OnStop</a>()</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                    <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> hosts)</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                        var host = I.Value;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                        var instance = (<a class="code" href="class_t_g_s_1_1_server_1_1_instance.html">Instance</a>)host.SingletonInstance;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                        host.Close();</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                        instance.Dispose();</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                        UnlockLoggingID(instance.LoggingID);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                    }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                }</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                {</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                    Logger.WriteError(e.ToString(), <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.ServiceShutdownFail, LoggingID);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                serviceHost.Close();</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            Config.Save(DefaultConfigDirectory);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        }</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#af9a7216e002c09db6b910b1fe7784ba3">  380</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#af9a7216e002c09db6b910b1fe7784ba3">VerifyConnection</a>() { }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#ad3e7caeecf4413f1c2b4a02f570d4279">  383</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#ad3e7caeecf4413f1c2b4a02f570d4279">PrepareForUpdate</a>()</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> hosts)</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                ((<a class="code" href="class_t_g_s_1_1_server_1_1_instance.html">Instance</a>)I.Value.SingletonInstance).Reattach(<span class="keyword">false</span>);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        }</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#afafc63c95ba75b9dbbfaf03be2ae74ea">  390</a></span>&#160;        <span class="keyword">public</span> ushort <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#afafc63c95ba75b9dbbfaf03be2ae74ea">RemoteAccessPort</a>()</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="keywordflow">return</span> Config.RemoteAccessPort;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        }</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#acb3c6657df1f2a5f204f2d459dadff8f">  396</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#acb3c6657df1f2a5f204f2d459dadff8f">SetRemoteAccessPort</a>(ushort port)</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="keywordflow">if</span> (port == 0)</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Cannot bind to port 0&quot;</span>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            Config.RemoteAccessPort = port;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#aaaeae4807f8701704f383ac852e20550">  405</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#aaaeae4807f8701704f383ac852e20550">Version</a>()</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        {</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            <span class="keywordflow">return</span> VersionString;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        }</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a43a6837709895fc742fed2ce060ec904">  411</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a43a6837709895fc742fed2ce060ec904">SetPythonPath</a>(<span class="keywordtype">string</span> path)</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        {</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            <span class="keywordflow">if</span> (!Directory.Exists(path))</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            Config.PythonPath = Path.GetFullPath(path);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        }</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a3abd1c80b5ff5f2f078f6fe8ee48e27c">  420</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a3abd1c80b5ff5f2f078f6fe8ee48e27c">PythonPath</a>()</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        {</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="keywordflow">return</span> Config.PythonPath;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#ae0937ad473d06d1a1f817a1acc718225">  426</a></span>&#160;        <span class="keyword">public</span> IList&lt;InstanceMetadata&gt; <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#ae0937ad473d06d1a1f817a1acc718225">ListInstances</a>()</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            var result = <span class="keyword">new</span> List&lt;InstanceMetadata&gt;();</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                <span class="keywordflow">foreach</span> (var ic <span class="keywordflow">in</span> GetInstanceConfigs()) </div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                    result.Add(<span class="keyword">new</span> <a class="code" href="class_t_g_s_1_1_interface_1_1_instance_metadata.html">InstanceMetadata</a></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                    {</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                        Name = ic.<a class="code" href="class_t_g_s_1_1_interface_1_1_instance_metadata.html#a16436484e29caf5ef4581cb04615be06">Name</a>,</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                        Path = ic.Directory,</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                        Enabled = ic.Enabled,</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                        LoggingID = (byte)(ic.Enabled ? ((<a class="code" href="class_t_g_s_1_1_server_1_1_instance.html">Instance</a>)hosts[ic.Name].SingletonInstance).LoggingID : 0)</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                    });</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        }</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a1fd633ced6347516d4d115a65addf78a">  442</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a1fd633ced6347516d4d115a65addf78a">CreateInstance</a>(<span class="keywordtype">string</span> Name, <span class="keywordtype">string</span> path)</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            path = <a class="code" href="class_t_g_s_1_1_server_1_1_helpers.html">Helpers</a>.<a class="code" href="class_t_g_s_1_1_server_1_1_helpers.html#a735e80586fa986522b778d7bf5401b90">NormalizePath</a>(path);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            var res = CheckInstanceName(Name);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keywordflow">if</span> (res != null)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <span class="keywordflow">if</span> (File.Exists(path) || Directory.Exists(path))</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Cannot create instance at pre-existing path!&quot;</span>;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                <span class="keywordflow">if</span> (Config.InstancePaths.Contains(path))</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                    <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;Instance at {0} already exists!&quot;</span>, path);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                <span class="keywordflow">foreach</span> (var oic <span class="keywordflow">in</span> GetInstanceConfigs())</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                    <span class="keywordflow">if</span> (Name == oic.Name)</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                        <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;Instance named {0} already exists!&quot;</span>, oic.Name);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                <a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html">IInstanceConfig</a> ic;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                    ic = <span class="keyword">new</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance_config.html">InstanceConfig</a>(path)</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                    {</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                        Name = Name</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                    };</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                    Directory.CreateDirectory(path);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                    ic.<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#a8456c8ae4b83292059709e1d4dcbcce0">Save</a>();</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                    Config.InstancePaths.Add(path);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                }</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                {</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                    <span class="keywordflow">return</span> e.ToString();</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                }</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                <span class="keywordflow">return</span> SetupOneInstance(ic);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a9793fcde0c006c23936f679eaebe4b42">  481</a></span>&#160;        <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a9793fcde0c006c23936f679eaebe4b42">SetupOneInstance</a>(<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html">IInstanceConfig</a> config)</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            <span class="keywordflow">if</span> (!config.<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#ad5817438b173304f71061db218332211">Enabled</a>)</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                var host = SetupInstance(config);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                <span class="keywordflow">if</span> (host != null)</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                    host.Open();</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                    lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                        Config.InstancePaths.Remove(config.<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#a19261e44718496c92045414303b4865c">Directory</a>);</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            }</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Instance set up but an error occurred while starting it: &quot;</span> + e.ToString();</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a2d9003533ba8205130476d8e54c1d4a3">  502</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a2d9003533ba8205130476d8e54c1d4a3">ImportInstance</a>(<span class="keywordtype">string</span> path)</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        {</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            path = <a class="code" href="class_t_g_s_1_1_server_1_1_helpers.html">Helpers</a>.<a class="code" href="class_t_g_s_1_1_server_1_1_helpers.html#a735e80586fa986522b778d7bf5401b90">NormalizePath</a>(path);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            {</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                <span class="keywordflow">if</span> (Config.InstancePaths.Contains(path))</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                    <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;Instance at {0} already exists!&quot;</span>, path);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                <span class="keywordflow">if</span>(!Directory.Exists(path))</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                    <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;There is no instance located at {0}!&quot;</span>, path);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                <a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html">IInstanceConfig</a> ic;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                {</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                    ic = <a class="code" href="class_t_g_s_1_1_server_1_1_instance_config.html">InstanceConfig</a>.<a class="code" href="class_t_g_s_1_1_server_1_1_instance_config.html#ab2d62660500deb534464b1f71f5cbd77">Load</a>(path);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                    <span class="keywordflow">foreach</span>(var oic <span class="keywordflow">in</span> GetInstanceConfigs())</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                        <span class="keywordflow">if</span>(ic.<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#a3833c4e4629bced994a5d641f49d1e13">Name</a> == oic.Name)</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                            <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;Instance named {0} already exists!&quot;</span>, oic.Name);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                    ic.<a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#a8456c8ae4b83292059709e1d4dcbcce0">Save</a>();</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                    Config.InstancePaths.Add(path);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                }</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                {</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                    <span class="keywordflow">return</span> e.ToString();</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                <span class="keywordflow">return</span> SetupOneInstance(ic);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        }</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a979b90ae37e4a7e2db71af80305e98b9">  530</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a979b90ae37e4a7e2db71af80305e98b9">InstanceEnabled</a>(<span class="keywordtype">string</span> Name)</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        {</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            lock(<span class="keyword">this</span>)</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            {</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                <span class="keywordflow">return</span> hosts.ContainsKey(Name);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            }</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        }</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a557f30d15c0440da70d24b8c7478203e">  539</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a557f30d15c0440da70d24b8c7478203e">SetInstanceEnabled</a>(<span class="keywordtype">string</span> Name, <span class="keywordtype">bool</span> enabled)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        {</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <span class="keywordflow">return</span> SetInstanceEnabledImpl(Name, enabled, out <span class="keywordtype">string</span> path);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        }</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a430c4dafe3ad8cde20462b14c0df1aec">  552</a></span>&#160;        <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a430c4dafe3ad8cde20462b14c0df1aec">SetInstanceEnabledImpl</a>(<span class="keywordtype">string</span> Name, <span class="keywordtype">bool</span> enabled, out <span class="keywordtype">string</span> path)</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            path = null;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            {</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                var hostIsOnline = hosts.ContainsKey(Name);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                <span class="keywordflow">if</span> (enabled)</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                    <span class="keywordflow">if</span> (hostIsOnline)</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                        <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                    <span class="keywordflow">foreach</span> (var ic <span class="keywordflow">in</span> GetInstanceConfigs())</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                        <span class="keywordflow">if</span> (ic.Name == Name)</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                        {</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                            path = ic.Directory;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                            ic.Enabled = <span class="keyword">true</span>;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                            ic.Save();</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                            <span class="keywordflow">return</span> SetupOneInstance(ic);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                        }</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                    <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;Instance {0} does not exist!&quot;</span>, Name);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                }</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                    <span class="keywordflow">if</span> (!hostIsOnline)</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                        <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                    var host = hosts[Name];</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                    hosts.Remove(Name);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                    var inst = (<a class="code" href="class_t_g_s_1_1_server_1_1_instance.html">Instance</a>)host.SingletonInstance;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                    host.Close();</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                    path = inst.ServerDirectory();</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                    inst.Offline();</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                    inst.Dispose();</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                    UnlockLoggingID(inst.LoggingID);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                    <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            }</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        }</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#ae6d37254909998b99a6b5611360a96fb">  590</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#ae6d37254909998b99a6b5611360a96fb">RenameInstance</a>(<span class="keywordtype">string</span> name, <span class="keywordtype">string</span> new_name)</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        {</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            <span class="keywordflow">if</span> (name == new_name)</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            var res = CheckInstanceName(new_name);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <span class="keywordflow">if</span> (res != null)</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                <span class="comment">//we have to check em all anyway</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                <a class="code" href="interface_t_g_s_1_1_server_1_1_i_instance_config.html">IInstanceConfig</a> the_droid_were_looking_for = null;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                <span class="keywordflow">foreach</span> (var ic <span class="keywordflow">in</span> GetInstanceConfigs())</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                    <span class="keywordflow">if</span> (ic.Name == name)</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                    {</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                        the_droid_were_looking_for = ic;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                    }</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ic.Name == new_name)</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                        <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;There is already another instance named {0}!&quot;</span>, new_name);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                <span class="keywordflow">if</span> (the_droid_were_looking_for == null)</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                    <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;There is no instance named {0}!&quot;</span>, name);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                var ie = InstanceEnabled(name);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                <span class="keywordflow">if</span>(ie)</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                    SetInstanceEnabled(name, <span class="keyword">false</span>);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                the_droid_were_looking_for.Name = new_name;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                <span class="keywordtype">string</span> result = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                {</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                    the_droid_were_looking_for.Save();</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                    result = null;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                }</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                <span class="keywordflow">catch</span>(Exception e)</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                {</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                    result = <span class="stringliteral">&quot;Could not save instance config! Error: &quot;</span> + e.ToString();</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                }</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                <span class="keywordflow">finally</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                {</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                    <span class="keywordflow">if</span> (ie)</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                    {</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                        var resRestore = SetInstanceEnabled(new_name, <span class="keyword">true</span>);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                        <span class="keywordflow">if</span> (resRestore != null)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                            result = (result + <span class="stringliteral">&quot; &quot;</span> + resRestore).Trim();</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                    }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                }</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            }</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        }</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00639"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#a928e17719ea63a3cbe289d67c5c0d6c0">  639</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#a928e17719ea63a3cbe289d67c5c0d6c0">DetachInstance</a>(<span class="keywordtype">string</span> name)</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        {</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                var res = SetInstanceEnabledImpl(name, <span class="keyword">false</span>, out <span class="keywordtype">string</span> path);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                <span class="keywordflow">if</span> (res != null)</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                    <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                <span class="keywordflow">if</span> (path == null)    <span class="comment">//gotta find it ourselves</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                    <span class="keywordflow">foreach</span> (var ic <span class="keywordflow">in</span> GetInstanceConfigs())</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                        <span class="keywordflow">if</span> (ic.Name == name)</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                        {</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                            path = ic.Directory;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                        }</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                <span class="keywordflow">if</span> (path == null)</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                    <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;No instance named {0} exists!&quot;</span>, name);</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                Config.InstancePaths.Remove(path);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            }</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="preprocessor">        #region IDisposable Support</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="keyword">private</span> <span class="keywordtype">bool</span> disposedValue = <span class="keyword">false</span>;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00670"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#aa1d3d4bbc5df7a10114a49d78ff0bcb4">  670</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#aa1d3d4bbc5df7a10114a49d78ff0bcb4">Dispose</a>(<span class="keywordtype">bool</span> disposing)</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        {</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            <span class="keywordflow">if</span> (!disposedValue)</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            {</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                <span class="keywordflow">if</span> (disposing)</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                {</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                    OnStop();</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                }</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                <span class="comment">// TODO: free unmanaged resources (unmanaged objects) and override a finalizer below.</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                <span class="comment">// TODO: set large fields to null.</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                disposedValue = <span class="keyword">true</span>;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            }</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        }</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="comment">// TODO: override a finalizer only if Dispose(bool disposing) above has code to free unmanaged resources.</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="comment">// ~Server() {</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="comment">//   // Do not change this code. Put cleanup code in Dispose(bool disposing) above.</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="comment">//   Dispose(false);</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="comment">// }</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_server.html#ade99414a470f1128e8ef57a0dd6789a7">  695</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_server.html#ade99414a470f1128e8ef57a0dd6789a7">Dispose</a>()</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            <span class="comment">// Do not change this code. Put cleanup code in Dispose(bool disposing) above.</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            Dispose(<span class="keyword">true</span>);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <span class="comment">// TODO: uncomment the following line if the finalizer is overridden above.</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <span class="comment">// GC.SuppressFinalize(this);</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        }</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="preprocessor">        #endregion</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    }</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;}</div><div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_connectivity_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_connectivity.html">TGS.Interface.Components.ITGConnectivity</a></div><div class="ttdoc">Used for testing connections to the service without authentication </div><div class="ttdef"><b>Definition:</b> <a href="_connectivity_8cs_source.html#l00009">Connectivity.cs:9</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_ae0937ad473d06d1a1f817a1acc718225"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#ae0937ad473d06d1a1f817a1acc718225">TGS.Server.Server.ListInstances</a></div><div class="ttdeci">IList&lt; InstanceMetadata &gt; ListInstances()</div><div class="ttdoc">List instances that the caller can access  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00426">Server.cs:426</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_server_1_1_i_instance_config_html"><div class="ttname"><a href="interface_t_g_s_1_1_server_1_1_i_instance_config.html">TGS.Server.IInstanceConfig</a></div><div class="ttdoc">Configuration settings for a Instance </div><div class="ttdef"><b>Definition:</b> <a href="_instance_config_8cs_source.html#l00010">InstanceConfig.cs:10</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_ade99414a470f1128e8ef57a0dd6789a7"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#ade99414a470f1128e8ef57a0dd6789a7">TGS.Server.Server.Dispose</a></div><div class="ttdeci">void Dispose()</div><div class="ttdoc">Implements the IDisposable pattern </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00695">Server.cs:695</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_interface_1_1_server_html"><div class="ttname"><a href="class_t_g_s_1_1_interface_1_1_server.html">TGS.Interface.Server</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_server_8cs_source.html#l00008">Server.cs:8</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_instance_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_instance.html">TGS.Interface.Components.ITGInstance</a></div><div class="ttdoc">Metadata for a server instance </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_instance_8cs_source.html#l00009">Instance.cs:9</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_config_html_ab2d62660500deb534464b1f71f5cbd77"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance_config.html#ab2d62660500deb534464b1f71f5cbd77">TGS.Server.InstanceConfig.Load</a></div><div class="ttdeci">static IInstanceConfig Load(string path)</div><div class="ttdoc">Loads and migrates an IInstanceConfig from a Instance at path  </div><div class="ttdef"><b>Definition:</b> <a href="_instance_config_8cs_source.html#l00331">InstanceConfig.cs:331</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_aaaeae4807f8701704f383ac852e20550"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#aaaeae4807f8701704f383ac852e20550">TGS.Server.Server.Version</a></div><div class="ttdeci">string Version()</div><div class="ttdoc">Retrieve&amp;#39;s the service&amp;#39;s version  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00405">Server.cs:405</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_interface_1_1_definitions_html_a9cbf8326b94fc958f8a24e42bedfac13"><div class="ttname"><a href="class_t_g_s_1_1_interface_1_1_definitions.html#a9cbf8326b94fc958f8a24e42bedfac13">TGS.Interface.Definitions.TransferLimitLocal</a></div><div class="ttdeci">const long TransferLimitLocal</div><div class="ttdoc">The maximum message size to and from a local server </div><div class="ttdef"><b>Definition:</b> <a href="_definitions_8cs_source.html#l00016">Definitions.cs:16</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_server_1_1_i_instance_config_html_ad5817438b173304f71061db218332211"><div class="ttname"><a href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#ad5817438b173304f71061db218332211">TGS.Server.IInstanceConfig.Enabled</a></div><div class="ttdeci">bool Enabled</div><div class="ttdoc">If the Instance is active </div><div class="ttdef"><b>Definition:</b> <a href="_instance_config_8cs_source.html#l00030">InstanceConfig.cs:30</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_landing_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_landing.html">TGS.Interface.Components.ITGLanding</a></div><div class="ttdoc">Used for general authentication and listing ITGInstances </div><div class="ttdef"><b>Definition:</b> <a href="_landing_8cs_source.html#l00010">Landing.cs:10</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_chat_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_chat.html">TGS.Interface.Components.ITGChat</a></div><div class="ttdoc">Interface for handling chat bot </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_chat_8cs_source.html#l00010">Chat.cs:10</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_ad953f35dc952e06223e9504941b7c6ee"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#ad953f35dc952e06223e9504941b7c6ee">TGS.Server.Server.OnStop</a></div><div class="ttdeci">void OnStop()</div><div class="ttdoc">Shuts down all active ServiceHosts and calls IDisposable.Dispose on it&amp;#39;s Instance ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00355">Server.cs:355</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_server_1_1_i_logger_html"><div class="ttname"><a href="interface_t_g_s_1_1_server_1_1_i_logger.html">TGS.Server.ILogger</a></div><div class="ttdoc">Used for writing logs to a provider </div><div class="ttdef"><b>Definition:</b> <a href="_i_logger_8cs_source.html#l00006">ILogger.cs:6</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a928e17719ea63a3cbe289d67c5c0d6c0"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a928e17719ea63a3cbe289d67c5c0d6c0">TGS.Server.Server.DetachInstance</a></div><div class="ttdeci">string DetachInstance(string name)</div><div class="ttdoc">Disables and unregisters an instance, allowing the folder and data to be manipulated manually  ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00639">Server.cs:639</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a761439cde270c74bcf338b83806859ca"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a761439cde270c74bcf338b83806859ca">TGS.Server.Server.CreateHost</a></div><div class="ttdeci">static ServiceHost CreateHost(object singleton, string endpointPostfix)</div><div class="ttdoc">Creates a ServiceHost for singleton  using the default pipe, CloseTimeout for the ServiceHost...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00223">Server.cs:223</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a8af19f53ce6ebfba60a09817af26a667"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a8af19f53ce6ebfba60a09817af26a667">TGS.Server.Server.CheckInstanceName</a></div><div class="ttdeci">static string CheckInstanceName(string instanceName)</div><div class="ttdoc">Checks an instanceName  for illegal characters </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00064">Server.cs:64</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a430c4dafe3ad8cde20462b14c0df1aec"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a430c4dafe3ad8cde20462b14c0df1aec">TGS.Server.Server.SetInstanceEnabledImpl</a></div><div class="ttdeci">string SetInstanceEnabledImpl(string Name, bool enabled, out string path)</div><div class="ttdoc">Sets a Instance&amp;#39;s enabled status </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00552">Server.cs:552</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_html"><div class="ttname"><a href="namespace_t_g_s_1_1_interface.html">TGS.Interface</a></div><div class="ttdef"><b>Definition:</b> <a href="_authentication_header_applicator_8cs_source.html#l00009">AuthenticationHeaderApplicator.cs:9</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_interface_1_1_definitions_html"><div class="ttname"><a href="class_t_g_s_1_1_interface_1_1_definitions.html">TGS.Interface.Definitions</a></div><div class="ttdoc">Contains constants for the interface </div><div class="ttdef"><b>Definition:</b> <a href="_definitions_8cs_source.html#l00011">Definitions.cs:11</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a85d0b54fc049736f16cdf42f24d34058"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a85d0b54fc049736f16cdf42f24d34058">TGS.Server.Instance.WriteError</a></div><div class="ttdeci">void WriteError(string message, EventID id)</div><div class="ttdoc">Writes an error to the Windows event log </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_instance_8cs_source.html#l00073">Instance.cs:73</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_ae6005800bd27448325d4b80cd0b1ee72"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#ae6005800bd27448325d4b80cd0b1ee72">TGS.Server.Server.AddEndpoint</a></div><div class="ttdeci">void AddEndpoint(ServiceHost host, Type typetype)</div><div class="ttdoc">Adds a WCF endpoint for a component typetype  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00339">Server.cs:339</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a3abd1c80b5ff5f2f078f6fe8ee48e27c"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a3abd1c80b5ff5f2f078f6fe8ee48e27c">TGS.Server.Server.PythonPath</a></div><div class="ttdeci">string PythonPath()</div><div class="ttdoc">Gets the path to the python 2.7 installation  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00420">Server.cs:420</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_ac85f8ad559e7ad19aa4a35b173b75478"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#ac85f8ad559e7ad19aa4a35b173b75478">TGS.Server.Server.ChangePortFromCommandLine</a></div><div class="ttdeci">void ChangePortFromCommandLine(string[] args)</div><div class="ttdoc">Overrides and saves the configured ServerConfig.RemoteAccessPort if requested by command line paramet...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00145">Server.cs:145</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_server_1_1_security_html"><div class="ttname"><a href="namespace_t_g_s_1_1_server_1_1_security.html">TGS.Server.Security</a></div><div class="ttdef"><b>Definition:</b> <a href="_authentication_header_decoder_8cs_source.html#l00010">AuthenticationHeaderDecoder.cs:10</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_dream_daemon_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_dream_daemon.html">TGS.Interface.Components.ITGDreamDaemon</a></div><div class="ttdoc">Interface for managing the actual BYOND game server </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_dream_daemon_8cs_source.html#l00010">DreamDaemon.cs:10</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_ac3a300e8fa5845202d3aa47baa49d0e4"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#ac3a300e8fa5845202d3aa47baa49d0e4">TGS.Server.Server.SetupInstances</a></div><div class="ttdeci">void SetupInstances()</div><div class="ttdoc">Creates ServiceHosts for all Instances as listed in ServerConfig.InstancePaths, detaches bad ones ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00234">Server.cs:234</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_byond_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_byond.html">TGS.Interface.Components.ITGByond</a></div><div class="ttdoc">For managing the BYOND installation the server runs </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_byond_8cs_source.html#l00010">Byond.cs:10</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_security_1_1_root_authorization_manager_html"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_security_1_1_root_authorization_manager.html">TGS.Server.Security.RootAuthorizationManager</a></div><div class="ttdoc">A ServiceAuthorizationManager used to determine only if the caller is an admin </div><div class="ttdef"><b>Definition:</b> <a href="_root_authorization_manager_8cs_source.html#l00013">RootAuthorizationManager.cs:13</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_acb3c6657df1f2a5f204f2d459dadff8f"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#acb3c6657df1f2a5f204f2d459dadff8f">TGS.Server.Server.SetRemoteAccessPort</a></div><div class="ttdeci">string SetRemoteAccessPort(ushort port)</div><div class="ttdoc">Set the port used for remote operation Requires a service restart to take effect  ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00396">Server.cs:396</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_server_html"><div class="ttname"><a href="namespace_t_g_s_1_1_server.html">TGS.Server</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_interface_1_1_instance_metadata_html_a16436484e29caf5ef4581cb04615be06"><div class="ttname"><a href="class_t_g_s_1_1_interface_1_1_instance_metadata.html#a16436484e29caf5ef4581cb04615be06">TGS.Interface.InstanceMetadata.Name</a></div><div class="ttdeci">string Name</div><div class="ttdoc">The name of the Components.ITGInstance </div><div class="ttdef"><b>Definition:</b> <a href="_instance_metadata_8cs_source.html#l00016">InstanceMetadata.cs:16</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_config_html_a90c7ef7a8c364210e53a88f6ad26ed4d"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server_config.html#a90c7ef7a8c364210e53a88f6ad26ed4d">TGS.Server.ServerConfig.Load</a></div><div class="ttdeci">static ServerConfig Load(string directory)</div><div class="ttdoc">Load a ServerConfig from a given directory  </div><div class="ttdef"><b>Definition:</b> <a href="_server_config_8cs_source.html#l00059">ServerConfig.cs:59</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_config_html"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance_config.html">TGS.Server.InstanceConfig</a></div><div class="ttdef"><b>Definition:</b> <a href="_instance_config_8cs_source.html#l00128">InstanceConfig.cs:128</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_interface_1_1_definitions_html_ae6060d0444a8adfddeb0ca1a9bc7c5de"><div class="ttname"><a href="class_t_g_s_1_1_interface_1_1_definitions.html#ae6060d0444a8adfddeb0ca1a9bc7c5de">TGS.Interface.Definitions.TransferLimitRemote</a></div><div class="ttdeci">const long TransferLimitRemote</div><div class="ttdoc">The maximum message size to and from a remote server </div><div class="ttdef"><b>Definition:</b> <a href="_definitions_8cs_source.html#l00021">Definitions.cs:21</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a3c766dcb7ff9a155f16833e35cd2d10d"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a3c766dcb7ff9a155f16833e35cd2d10d">TGS.Server.Server.UnlockLoggingID</a></div><div class="ttdeci">void UnlockLoggingID(byte ID)</div><div class="ttdoc">Unlocks a Instance.LoggingID acquired with LockLoggingID </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00259">Server.cs:259</a></div></div>
<div class="ttc" id="namespace_t_g_s_html"><div class="ttname"><a href="namespace_t_g_s.html">TGS</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_abc583e331c2692b47d83a4af67ddb5b4"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#abc583e331c2692b47d83a4af67ddb5b4">TGS.Server.Server.BeginImpersonation</a></div><div class="ttdeci">static WindowsImpersonationContext BeginImpersonation()</div><div class="ttdoc">Begins user impersonation to allow proper restricted file access </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00054">Server.cs:54</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_server_1_1_i_instance_config_html_a3833c4e4629bced994a5d641f49d1e13"><div class="ttname"><a href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#a3833c4e4629bced994a5d641f49d1e13">TGS.Server.IInstanceConfig.Name</a></div><div class="ttdeci">string Name</div><div class="ttdoc">The name of the Instance </div><div class="ttdef"><b>Definition:</b> <a href="_instance_config_8cs_source.html#l00025">InstanceConfig.cs:25</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_helpers_html_a5b1d1510ab671f24b98ecafa79f98c00"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_helpers.html#a5b1d1510ab671f24b98ecafa79f98c00">TGS.Server.Helpers.DeleteDirectory</a></div><div class="ttdeci">static void DeleteDirectory(string path, bool ContentsOnly=false, IList&lt; string &gt; excludeRoot=null)</div><div class="ttdoc">Recursive directory deleter </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_helpers_8cs_source.html#l00038">Helpers.cs:38</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_helpers_html_a735e80586fa986522b778d7bf5401b90"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_helpers.html#a735e80586fa986522b778d7bf5401b90">TGS.Server.Helpers.NormalizePath</a></div><div class="ttdeci">static string NormalizePath(string path)</div><div class="ttdoc">Normalizes different versions of a path string </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_helpers_8cs_source.html#l00206">Helpers.cs:206</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_ad3e7caeecf4413f1c2b4a02f570d4279"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#ad3e7caeecf4413f1c2b4a02f570d4279">TGS.Server.Server.PrepareForUpdate</a></div><div class="ttdeci">void PrepareForUpdate()</div><div class="ttdoc">Next stop of the service will not close DD and sets a flag for it to reattach once it restarts  ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00383">Server.cs:383</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_compiler_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_compiler.html">TGS.Interface.Components.ITGCompiler</a></div><div class="ttdoc">For managing the Game A/B/Live folders, compiling, and hotswapping them </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_compiler_8cs_source.html#l00009">Compiler.cs:9</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_instance_manager_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_instance_manager.html">TGS.Interface.Components.ITGInstanceManager</a></div><div class="ttdoc">Used for managing ITGInstances </div><div class="ttdef"><b>Definition:</b> <a href="_instance_manager_8cs_source.html#l00009">InstanceManager.cs:9</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_server_1_1_i_instance_config_html_a8456c8ae4b83292059709e1d4dcbcce0"><div class="ttname"><a href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#a8456c8ae4b83292059709e1d4dcbcce0">TGS.Server.IInstanceConfig.Save</a></div><div class="ttdeci">void Save()</div><div class="ttdoc">Saves the IInstanceConfig to it&amp;#39;s Instance Directory </div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_repository_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_repository.html">TGS.Interface.Components.ITGRepository</a></div><div class="ttdoc">Interface for managing the code repository </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_repository_8cs_source.html#l00010">Repository.cs:10</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a7eab4892a65d9abaaca430f036f3b742"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a7eab4892a65d9abaaca430f036f3b742">TGS.Server.Server.SetupService</a></div><div class="ttdeci">void SetupService()</div><div class="ttdoc">Creates the ServiceHost for ITGSService </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00196">Server.cs:196</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_adc59504b21e321ca8b9ca792a04099c4"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#adc59504b21e321ca8b9ca792a04099c4">TGS.Server.Server.serviceHost</a></div><div class="ttdeci">ServiceHost serviceHost</div><div class="ttdoc">The WCF host that contains ITGSService connects to </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00076">Server.cs:76</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_interface_1_1_definitions_html_a6a845123fb932417f59a604266391fb3"><div class="ttname"><a href="class_t_g_s_1_1_interface_1_1_definitions.html#a6a845123fb932417f59a604266391fb3">TGS.Interface.Definitions.InstanceInterfaceName</a></div><div class="ttdeci">const string InstanceInterfaceName</div><div class="ttdoc">Base name of instance URLs </div><div class="ttdef"><b>Definition:</b> <a href="_definitions_8cs_source.html#l00030">Definitions.cs:30</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a979b90ae37e4a7e2db71af80305e98b9"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a979b90ae37e4a7e2db71af80305e98b9">TGS.Server.Server.InstanceEnabled</a></div><div class="ttdeci">bool InstanceEnabled(string Name)</div><div class="ttdoc">Checks if an instance is online  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00530">Server.cs:530</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a2d9003533ba8205130476d8e54c1d4a3"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a2d9003533ba8205130476d8e54c1d4a3">TGS.Server.Server.ImportInstance</a></div><div class="ttdeci">string ImportInstance(string path)</div><div class="ttdoc">Registers an existing server instance  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00502">Server.cs:502</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_config_html_a25367473db0e5b6c8e9e1ba620fa2e85"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server_config.html#a25367473db0e5b6c8e9e1ba620fa2e85">TGS.Server.ServerConfig.Save</a></div><div class="ttdeci">void Save(string directory)</div><div class="ttdoc">Saves the ServerConfig to a target directory  </div><div class="ttdef"><b>Definition:</b> <a href="_server_config_8cs_source.html#l00047">ServerConfig.cs:47</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_config_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_config.html">TGS.Interface.Components.ITGConfig</a></div><div class="ttdoc">For modifying the in game config Most if not all of these will not apply until the next server reboot...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_config_8cs_source.html#l00011">Config.cs:11</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_administration_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_administration.html">TGS.Interface.Components.ITGAdministration</a></div><div class="ttdoc">Manage the group that is used to access the service, can only be used by an administrator ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_administration_8cs_source.html#l00009">Administration.cs:9</a></div></div>
<div class="ttc" id="_t_g_s_8_command_line_2_program_8cs_html_a81a223a02c34d82b47199f08308847f2"><div class="ttname"><a href="_t_g_s_8_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a></div><div class="ttdeci">﻿using System</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_command_line_2_program_8cs_source.html#l00001">Program.cs:1</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_s_service_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_s_service.html">TGS.Interface.Components.ITGSService</a></div><div class="ttdoc">Interface for managing the service </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_service_8cs_source.html#l00010">Service.cs:10</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_security_1_1_authentication_header_decoder_html"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_security_1_1_authentication_header_decoder.html">TGS.Server.Security.AuthenticationHeaderDecoder</a></div><div class="ttdef"><b>Definition:</b> <a href="_authentication_header_decoder_8cs_source.html#l00012">AuthenticationHeaderDecoder.cs:12</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_interop_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_interop.html">TGS.Interface.Components.ITGInterop</a></div><div class="ttdoc">Used by DreamDaemon to access the interop API with call()(). Restrictions are in place so that only a...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_interop_8cs_source.html#l00009">Interop.cs:9</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_server_1_1_i_instance_config_html_a19261e44718496c92045414303b4865c"><div class="ttname"><a href="interface_t_g_s_1_1_server_1_1_i_instance_config.html#a19261e44718496c92045414303b4865c">TGS.Server.IInstanceConfig.Directory</a></div><div class="ttdeci">string Directory</div><div class="ttdoc">The Instance directory this IInstanceConfig is for </div><div class="ttdef"><b>Definition:</b> <a href="_instance_config_8cs_source.html#l00015">InstanceConfig.cs:15</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a9793fcde0c006c23936f679eaebe4b42"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a9793fcde0c006c23936f679eaebe4b42">TGS.Server.Server.SetupOneInstance</a></div><div class="ttdeci">string SetupOneInstance(IInstanceConfig config)</div><div class="ttdoc">Starts and onlines an instance located at config  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00481">Server.cs:481</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a43a6837709895fc742fed2ce060ec904"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a43a6837709895fc742fed2ce060ec904">TGS.Server.Server.SetPythonPath</a></div><div class="ttdeci">bool SetPythonPath(string path)</div><div class="ttdoc">Sets the path to the python 2.7 installation  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00411">Server.cs:411</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_server_html_a4682739b9567dc9e4e5c327c253ce311"><div class="ttname"><a href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">TGS.Server.EventID</a></div><div class="ttdeci">EventID</div><div class="ttdoc">Various events and their IDs in no particular order. Found in the Windows event log. These key incremented by 100 and are guaranteed to never be reused in the future. In the windows event viewer, these IDs will be offset by the Instance.LoggingID to distinguish events between instances. Each event ID may be information, a warning, or error and will be documented accordingly. Warnings will occur due to user, data, or network errors. Errors will occur due to filesystem errors or hard faults </div><div class="ttdef"><b>Definition:</b> <a href="_event_i_d_8cs_source.html#l00008">EventID.cs:8</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_ac9fd7531267a1affc98b5b3d53b38262"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#ac9fd7531267a1affc98b5b3d53b38262">TGS.Server.Server.hosts</a></div><div class="ttdeci">IDictionary&lt; string, ServiceHost &gt; hosts</div><div class="ttdoc">Map of InstanceConfig.Name to the respective ServiceHost hosting the Instance </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00080">Server.cs:80</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_helpers_html"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_helpers.html">TGS.Server.Helpers</a></div><div class="ttdoc">Generic helpers for the Server </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_helpers_8cs_source.html#l00013">Helpers.cs:13</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a1fd633ced6347516d4d115a65addf78a"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a1fd633ced6347516d4d115a65addf78a">TGS.Server.Server.CreateInstance</a></div><div class="ttdeci">string CreateInstance(string Name, string path)</div><div class="ttdoc">Creates a new ITGInstance  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00442">Server.cs:442</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_ae6d37254909998b99a6b5611360a96fb"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#ae6d37254909998b99a6b5611360a96fb">TGS.Server.Server.RenameInstance</a></div><div class="ttdeci">string RenameInstance(string name, string new_name)</div><div class="ttdoc">Renames an instance, this will restart the instance if it is enabled  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00590">Server.cs:590</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_afafc63c95ba75b9dbbfaf03be2ae74ea"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#afafc63c95ba75b9dbbfaf03be2ae74ea">TGS.Server.Server.RemoteAccessPort</a></div><div class="ttdeci">ushort RemoteAccessPort()</div><div class="ttdoc">Get the port used for remote operation  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00390">Server.cs:390</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_aa1d3d4bbc5df7a10114a49d78ff0bcb4"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#aa1d3d4bbc5df7a10114a49d78ff0bcb4">TGS.Server.Server.Dispose</a></div><div class="ttdeci">void Dispose(bool disposing)</div><div class="ttdoc">Implements the IDisposable pattern. Calls OnStop </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00670">Server.cs:670</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html">TGS.Server.Instance</a></div><div class="ttdoc">The class which holds all interface components. There are no safeguards for call race conditions so t...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_administration_8cs_source.html#l00012">Administration.cs:12</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_af9a7216e002c09db6b910b1fe7784ba3"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#af9a7216e002c09db6b910b1fe7784ba3">TGS.Server.Server.VerifyConnection</a></div><div class="ttdeci">void VerifyConnection()</div><div class="ttdoc">Does nothing on the server end, but if the call completes, you can be sure you are connected...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00380">Server.cs:380</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_interface_1_1_definitions_html_ab65eb36f9a4b34fb9a1baba47454c3b7"><div class="ttname"><a href="class_t_g_s_1_1_interface_1_1_definitions.html#ab65eb36f9a4b34fb9a1baba47454c3b7">TGS.Interface.Definitions.MasterInterfaceName</a></div><div class="ttdeci">const string MasterInterfaceName</div><div class="ttdoc">Base name of communication URLs </div><div class="ttdef"><b>Definition:</b> <a href="_definitions_8cs_source.html#l00026">Definitions.cs:26</a></div></div>
<div class="ttc" id="class_i_disposable_html"><div class="ttname"><a href="class_i_disposable.html">IDisposable</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_interface_1_1_instance_metadata_html"><div class="ttname"><a href="class_t_g_s_1_1_interface_1_1_instance_metadata.html">TGS.Interface.InstanceMetadata</a></div><div class="ttdoc">Metadata about an Components.ITGInstance </div><div class="ttdef"><b>Definition:</b> <a href="_instance_metadata_8cs_source.html#l00010">InstanceMetadata.cs:10</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_config_html"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server_config.html">TGS.Server.ServerConfig</a></div><div class="ttdoc">Class for storing server wide settings </div><div class="ttdef"><b>Definition:</b> <a href="_server_config_8cs_source.html#l00010">ServerConfig.cs:10</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html">TGS.Server.Server</a></div><div class="ttdoc">The windows service the application runs as </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00018">Server.cs:18</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_1_1_components_html"><div class="ttname"><a href="namespace_t_g_s_1_1_interface_1_1_components.html">TGS.Interface.Components</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_administration_8cs_source.html#l00003">Administration.cs:3</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_affd0676a7a18d7aaeb0561d166406cbe"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#affd0676a7a18d7aaeb0561d166406cbe">TGS.Server.Server.SetupInstance</a></div><div class="ttdeci">ServiceHost SetupInstance(IInstanceConfig config)</div><div class="ttdoc">Creates and starts a ServiceHost for a Instance at config  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00290">Server.cs:290</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a557f30d15c0440da70d24b8c7478203e"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a557f30d15c0440da70d24b8c7478203e">TGS.Server.Server.SetInstanceEnabled</a></div><div class="ttdeci">string SetInstanceEnabled(string Name, bool enabled)</div><div class="ttdoc">Sets an instance&amp;#39;s enabled status  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00539">Server.cs:539</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a41adf96032cfab1b226192fe3c3b0924"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a41adf96032cfab1b226192fe3c3b0924">TGS.Server.Server.OnlineAllHosts</a></div><div class="ttdeci">void OnlineAllHosts()</div><div class="ttdoc">Opens all created ServiceHosts </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00210">Server.cs:210</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_ab1a4188b85e8aea3a1ce2f0394007a38"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#ab1a4188b85e8aea3a1ce2f0394007a38">TGS.Server.Server.SetupConfig</a></div><div class="ttdeci">void SetupConfig()</div><div class="ttdoc">Upgrades up the service configuration </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00169">Server.cs:169</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_aca3e4b51f2911f5adab680ee1788075e"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#aca3e4b51f2911f5adab680ee1788075e">TGS.Server.Server.GetInstanceConfigs</a></div><div class="ttdeci">IEnumerable&lt; IInstanceConfig &gt; GetInstanceConfigs()</div><div class="ttdoc">Enumerates configured IInstanceConfigs. Detaches those that fail to load </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00115">Server.cs:115</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_a7939236efbbddb15e9c3684eff4d69a2"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#a7939236efbbddb15e9c3684eff4d69a2">TGS.Server.Server.LockLoggingID</a></div><div class="ttdeci">byte LockLoggingID()</div><div class="ttdoc">Gets and locks a Instance.LoggingID </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00271">Server.cs:271</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_server_html_ac4176ac33c52820ff6179dba92f1b092"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_server.html#ac4176ac33c52820ff6179dba92f1b092">TGS.Server.Server.Server</a></div><div class="ttdeci">Server(string[] args, ILogger logger)</div><div class="ttdoc">Construct a Server </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_server_8cs_source.html#l00091">Server.cs:91</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
